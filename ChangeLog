2009-11-10  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#143815 - Input field (text entry) widget for desktop widgets
	not defocusing in all required use cases

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Focus
	the desktop window in case we move to TASK_NAV, HOME_EDIT, or LAUNCHER
	modes to unfocus any applet.

	A fix related to NB#143426, this makes HD-emitted button events
	identical to those sent when HD is not running.

	* src/home/hd-home.c (hd_home_applet_emit_button_release_event,
	hd_home_applet_emit_button_press_event): Translate coordinates as long
	as subwindows are found.

2009-11-09  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.116-1

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_is_non_composited): Blacklist
	Chess and Mahjong based on their WM_CLASS.
	* src/mb/hd-app.h: Add force_composited member to avoid reading
	WM_CLASS all the time.

	Release 2.2.115-1

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_is_non_composited): Don't take
	stackable leaders as non-composited either, since later there could be
	sliding transition from the leader to a secondary.

2009-11-06  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Even more fixes to the compositing logic.	

	* src/mb/hd-comp-mgr.[ch]: hd_comp_mgr_client_prefers_compositing and
	hd_comp_mgr_is_non_composited are now static.
	(hd_comp_mgr_client_property_changed): Don't go
	to non-composited mode during rotation.
	* src/mb/hd-wm.c (hd_wm_activate_zoomed_client): Don't consider
	transition to non-composited mode here, it's done later.

2009-10-29  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add X-Maemo-Prestarted-Ignore-Load flag to desktop files. If true,
	prestart the app as soon as possible without regards to load or memory
	limits.
	Fixes: NB#145331

	* src/launcher/hd-app-mgr.c
	* src/launcher/hd-launcher-app.c
	* src/launcher/hd-launcher-app.h

2009-11-06  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#145154 - Too many XSyncs in window manager causes slowdowns
	                   (Along with libmatchbox changes)
	                   
	* debian/control: depend on new libmatchbox (> .98)
	* src/main.c: Initialise the new libmatchbox error handler	                   
	* src/home/hd-home.c
	* src/home/hd-render-manager.c
	* src/home/hd-task-navigator.c
	* src/mb/hd-comp-mgr.c
	* src/mb/hd-decor.c
	* src/mb/hd-note.c
	* src/mb/hd-wm.c
	* src/util/hd-util.c: Modify calls to XSync and
	  mb_wm_util_[un]trap to use mb_wm_util_async_[un]trap instead where
	  it is possible. 

2009-11-06  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#145639 - Non-composite mode should be used for all
	fullscreen applications

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_is_non_composited): Consider
	fullscreen applications that are not secondary stackable windows as OK
	to non-composite, too.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect): Call
	hd_comp_mgr_reconsider_compositing for some missing cases where we
	don't have a transition that would call it later.

	Add a global variable for some important debug printing. This is
	mostly needed for verifying compositing mode transitions.

	* src/main.c (dump_debug_info_sighand): Toggle new global variable
	hd_debug_mode_set.
	* src/home/hd-render-manager.c (hd_render_manager_set_state): If
	hd_debug_mode_set is TRUE, use g_warning to print out the state
	transition, otherwise the old g_debug.

	Fix the rotation transition in non-composited mode.

	* src/home/hd-render-manager.c (hd_render_manager_set_state_portrait,
	hd_render_manager_set_state_unportrait): Make rotation transition in
	composited mode to keep it nice.
	* src/util/hd-transition.c (hd_transition_rotating_fsm): Call
	hd_comp_mgr_reconsider_compositing when the animation is done.

	More fixes to the compositing logic.

	* src/mb/hd-comp-mgr.c: Add mb_wm_client_is_map_confirmed call to all
	compositing inspection code.
	(hd_comp_mgr_client_needs_compositing): Renamed
	to hd_comp_mgr_client_prefers_compositing and now includes call to
	hd_comp_mgr_client_looks_better_composited.
	* src/mb/hd-wm.c (hd_wm_activate_zoomed_client): Add call to
	mb_wm_client_is_map_confirmed, since unmapped clients don't count.

2009-11-05  Laszlo Pere  <lpere@blumsoft.eu>

	* src/mb/hd-comp-mgr.c: Handling a special case for the stackable
	  window. Part of the fix for NB#134010.

2009-11-05  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#145418 - Backlight stays on indefinitely after using Screen
	calibration

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_restack): Check the DND flag also
	when bailing out in the beginning of the function.
	(hd_comp_mgr_check_do_not_disturb_flag): Optimise a bit.

	Release 2.2.114-1

2009-11-04  Gordon Williams <gordon.williams@collabora.co.uk>

	Regression fix: Task launcher subview should return to the top every
	                time it is viewed.

	* src/launcher/hd-launcher-grid.c: Set H and V adjustments to 0 at the
	  start of a transition that first shows a launcher page.

2009-11-05  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#142324 - UI freezes with HildonAppMenu opened and Close
	non-responsive dialog appearing

	* src/mb/hd-wm.c (hd_wm_client_hang): Store XID of the hung dialog.
	* src/mb/hd-note.c (hd_note_stacking_layer): If the hung dialog is
	being stacked and there is an application menu, stack it above the
	menu.
	* src/mb/hd-wm.[ch] (hd_wm_get_hung_client_dialog_xid): New accessor
	for XID of the hung dialog.

2009-11-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Make the launcher tree population visually quicker.

	* src/launcher/hd-launcher.c (hd_launcher_lazy_traverse_tree):
	  Add the tiles in 15-item batches.  When booting this cuts the
	  tree traversal from >20s to 10-17s (97 .desktop files).
	  When the device is unloaded the time drop from 10s to 2.6s,
	  which is useful when hacking the launcher.

2009-11-04  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#143521 - Task launcher (and switcher) panning is broken
	
	* src/tidy/tidy-finger-scroll.c: Deal with the fact that a 
	  clutter-timeline may skip frames, and make sure we multiply our
	  movement to overcome this.

	Fixes: NB#141640 - Multiple taps not handled during application launch

	* src/home/hd-render-manager.c: Make sure we don't fade out the launch
	  screenshot unless we're going to the APP state (otherwise remove it
	  instantly)
	* src/launcher/hd-launcher.c: Add a 10 second timeout to the loading
	  window - If that app still hasn't started after that return to home
	  or switcher. Now ignore taps on the loading screen, rather than 
	  using them to remove it.

	Fixes: NB#144761 - Transition tweaks
	
	* data/transitions.ini: Added MartinG's tweaked transition values

2009-11-04  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.113-1

2009-11-04  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#144265 - Dialog titles disappear when closing
	* src/mb/hd-decor.c: Just unref actors when the decor is destroyed
	  rather than destroying them. They will be destroyed when the
	  CompMgrClutterClient's actor is finally unreffed.

	Minor regression fix for NB#143482 - Software selection
	(Clutter Warning and lack of 'No Items' label in launcher)
	* src/launcher/hd-launcher-page.c: Replace set_parent with
	  container_add_actor (and remove other needless set_parent)

2009-11-04  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#142332 - [ncfs] No notification previews available in full
	screen mode
	Fixes: NB#142140 - [non composite mode] Ugly flickering when opening
	dialogs in full screen
	Fixes: NB#142322 - [ncfs] No transitions in full screen mode

	* src/home/hd-render-manager.h: Don't discard preview notes in
	non-composited mode.
	* hd-comp-mgr.[ch] (hd_comp_mgr_reconsider_compositing): New function
	for compositing mode policy.
	(hd_comp_mgr_unmap_notify): Move compositing mode policy code away
	from here to hd_comp_mgr_reconsider_compositing.
	(hd_comp_mgr_map_notify): Remove some unredirecting code.
	(hd_comp_mgr_client_looks_better_composited): New function to detect
	clients that look prettier in composited mode.
	(hd_comp_mgr_client_needs_compositing): Preview notes are now
	requiring compositing.
	* src/mb/hd-note.c (hd_note_init, hd_note_request_geometry): No
	special treatment for non-composited modes anymore.
	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Clear the
	overlay window before exiting to prevent its contents staying on the
	root window.
	* src/util/hd-transition.c (hd_transition_completed): Call
	hd_comp_mgr_reconsider_compositing when transition has completed.

	Release 2.2.112-1

2009-11-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#138100 Adding fade effect for notifications in task switcher

	* src/home/hd-task-navigator:
	  Made adopt_notification(), orphane_notification(), free_thumb()
	  and layout() animate notifications if necessary.
	* data/transitions.ini (notifade_in, notifade_out):
	  New properties for the effect.

2009-11-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Make the panning indicator disappear immedeately when leaving the
	launcher subview.  Keep it shown for a while when you're finished
	scrolling.

	* src/tidy/tidy-finger-scroll.c (button_release_event_cb):
	  Wait a second before hiding the indicators.
	* src/tidy/tidy-finger-scroll.h:
	  New function tidy_finger_scroll_hide_scrollbars_now().
	* src/launcher/hd-launcher-page.c (hd_launcher_page_transition):
	  Use it when the transition is either HD_LAUNCHER_PAGE_TRANSITION_OUT
	  or HD_LAUNCHER_PAGE_TRANSITION_OUT_SUB.

2009-11-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/launcher/hd-launcher-grid.c (hd_launcher_grid_refresh_v_adjustment):
	  Add HD_LAUNCHER_PAGE_YMARGIN pixels worth of margin at the bottom
	  of the subview.  Martin asked for it in NB#142968 but couldn't
	  wait for it.

2009-11-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.[ch], src/util/hd-dbus.c: Remove
	hd_comp_mgr_tklocked function and use the global variable instead.

2009-11-02  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#143482 - Software selection implementation for Clutter
	
	* debian/control: depend on new Clutter
	* src/main.c: enable software selection on startup	
	* src/home/hd-scrollable-group.c: Use set_anchor point instead of
	  cogl_translate (so actor positions actually correspond to their
	  screen positions).
	* src/launcher/hd-launcher-grid.c
	* src/launcher/hd-launcher-grid.h: Turn into a ClutterGroup, don't
	  allocate but instead just set actor positions using
	  hd_launcher_grid_layout (also use set_anchor instead of 
	  cogl_translate).
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h: Turn into ClutterGroup
	* src/tidy/tidy-scroll-view.c: Remove set_clip, as this isn't needed,
	  slows down drawing and also doesn't work with the new scrolling 
	  implelemtation.

2009-11-02  Jan Arne Petersen  <jpetersen@openismus.com>

	Part of fix for NB#131297 and NB#142916.

	* src/hildon-desktop.conf: Backup thumbnails for home bookmark
	shortcuts.

2009-11-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-home-applet.c (hd_home_applet_init): XFree the applet_id
	property also if the string is not proper.

	Release 2.2.111-1

	* src/util/hd-util.c (hd_util_set_screen_size_properties): Use
	hidden_window for the _MAEMO_SCREEN_SIZE property.

2009-10-29  Gordon Williams <gordon.williams@collabora.co.uk>

	Tweaks to help with NB#126626,NB#144294

	* src/home/hd-render-manager.c: Don't reset full-width flag on the
	  title bar. There is no need as it is set by 
	  hd_title_bar_set_window_visibilities. This helps get rid of a
	  redraw that happens sometimes when going from fullscreen to
	  windowed.

	Fixes: NB#144294 - h-d moves/resizes windows when fullscreening and 
	                   going to uncomposited mode.
	                   
	* src/home/hd-render-manager.c: stop moving SA offscreen horizontally
	  as Adam has already done it vertically.
	* src/mb/hd-comp-mgr.c: Instead of setting window shape to do
	  non-compositing, remove the overlay window completely. Add checks for
	  non-existing overlay window.
	* src/util/hd-util.c: Add checks for non-existing overlay window.
	* debian/control: Add depends on new libmatchbox and clutter

2009-10-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-util.c, src/mb/hd-atoms.[ch]: Add _MAEMO_SCREEN_SIZE for
	future use.

2009-10-29  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	For: NB#143390, Fremantle PR1.1 app menu customization

2009-10-28  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#143757 - Support disabling of transition effects for
	application windows

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect): Bail out in the beginning
	if the window does not want transitions.
	* tests/test-no-gtk.c: Add example code for disabling compositor's
	transitions.

	Release 2.2.110-1

2009-10-27  Laszlo Pere  <lpere@blumsoft.eu>
	
	* src/mb/hd-note.c, src/mb/hd-wm.[ch]: Closing only the modal blocker
	  menus when clicked on a note. A better solution for the NB#131835.

2009-10-26  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Build fix for shared libmatchbox on x86.

	* src/export.map:
	  Export hd_dbus_tklock_on, which is referenced by libmatchbox now.

2009-10-26  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#131835 - Not able to open the notifications when the app 
	menu is up.
	* src/mb/hd-note.c, src/mb/hd-wm.[ch]: Closing the menu when clicked on
	  a HdNote.

2009-10-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Add a global
	variable hd_dbus_tklock_on for libmatchbox2 (you need also recent MB2
	for the whole bug fix). Related to NB#137523 - Browser causes X damage
	events when not visible - tk unlock case

	Patch from Laszlo to plug a leak when discarding infobanners in DND.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): XFree the DND
	property when discarding an infobanner.

	Release 2.2.109-1

	* src/util/hd-transition.c (on_close_timeline_new_frame): Fix a
	Coverity warning.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unmap_notify): Fix 'break' in
	wrong line in the possibly-move-back-to-non-composited-mode branch,
	spotted by Coverity.

2009-10-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-home.c (root_window_client_message): Don't create the
	screenshot if it's already there. This is the intended semantics as
	applications can use the libhildon API to remove the screenshot when
	they need to refresh it.

2009-10-23 Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#144076 - Home View Panning unresponsive
	* src/home/hd-home-view-container.c: Allow the home view to be dragged
	  while an animation for view panning is in progress.

2009-10-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Regression fix.

	* src/util/hd-transition.c:
	  Automatically reload transitions.ini whenever it changes again.

2009-10-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Plug.

	* src/launcher/hd-launcher-grid.c (hd_launcher_grid_allocate,
	  hd_launcher_grid_dispose): Do not only dispose $blockers
	  but also unparent them, which drops the refcount to 0.

2009-10-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.108-1

2009-10-21 Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-sub-texture.c: use ref_sink, not ref, to fix unreffing
	  issues when we do tidy_sub_texture_new(clutter_texture_new(...))

2009-10-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/launcher/hd-launcher.c (hd_launcher_transition_app_start):
	  Don't leak $app_image.

2009-10-21  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes memory leak when opening and closing task launcher.

	* src/tidy/tidy-finger-scroll.c (tidy_finger_scroll_dispose,
	  show_scrollbars): Use g_signal_emit_by_name (timeline, "completed")
	  instead of clutter_timeline_stop (timeline); g_object_unref
	  (timeline) to not leak memory inside the effect.

2009-10-20 Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#142511 - Increse in memory usage of hildon-desktop while 
	                   playing games.
	Memory leaks in h-d caused by GetOverlayWindow without a Release.
	* src/mb/hd-comp-mgr.c
	* src/util/hd-util.c: Now use the variable for the overlay window
	  we always had in comp_mgr_clutter->priv
	* debian/control: Depends on new libmatchbox that allows us to
	  get at the overlay window

	Reverted NB#131081 again (causes issues with rotation)
	* src/home/hd-render-manager.c
	* src/mb/hd-comp-mgr.c

2009-10-20  Jan Arne Petersen  <jpetersen@openismus.com>

	Implement swipe gesture in home edit mode to pan between views.

	Fixes: NB#142940 - Changing desktop view while in the layout mode

	* src/home/hd-home-view.c (_HdHomeViewPrivate::pan_gesture_start_x,
	  _HdHomeViewPrivate::pan_gesture_start_y, hd_home_view_shown,
	  hd_home_view_hidden, is_button_press_in_gesture_start_area,
	  pan_gesture_motion, stop_pan_gesture, pressed_on_view,
	  hd_home_view_constructed): Add support for swipe gesture.
	* src/home/hd-home.c (EDGE_INDICATION_OPACITY_INVISIBLE,
	  create_edge_indicator, _hd_home_do_edit_layout,
	  update_edge_indication_visibility, hd_home_hide_edge_indication):
	  Only show edge indication when widget is dragged.

2009-10-19  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#142940 - Changing desktop view while in the layout mode

	* src/home/hd-home.c (EdgeIndicationOpacity,
	  EDGE_INDICATION_OPACITY_DEFAULT,
	  EDGE_INDICATION_OPACITY_WIDGET_MOVING,
	  EDGE_INDICATION_OPACITY_WIDGET_OVER, HdHomeDrag,
	  hd_home_create_edit_button, edge_indication_pressed,
	  create_edge_indicator, hd_home_constructed, _hd_home_do_edit_layout,
	  hd_home_set_operator_applet, update_edge_indication_visibility,
	  hd_home_show_edge_indication, hd_home_hide_edge_indication,
	  hd_home_highlight_edge_indication): Add another mode of edge
	  indication which less opacity which is shown in edit mode by
	  default. Add pressing edge indication pans to other view in edit
	  mode. Simplify edge indication code.

2009-10-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.107-1

2009-10-19  Gordon Williams <gordon.williams@collabora.co.uk>


	Fixes: NB#131081 - Class 0 SMS not shown full screen when switched from
	portrait to landscape mode (Applies to fullscreen notes too)

	* src/home/hd-render-manager.c: When we set visibility for the title 
	  bar, do it based on window size rather than fullscreen flag, which
	  matches the way we do stacking.
	* src/mb/hd-comp-mgr.c: Make sure we sync stacking on window resize

	Fixes: NB#136255 - Task Launcher summon animation overshoot a bit rough
	                   (Also added per-theme transitions.ini)

	* src/mb/hd-theme.c: Make sure we reload transitions.ini on theme 
	  change
	* src/launcher/hd-launcher-grid.c: Now load and work from lists of
	  keyframes if we're doing a 'sequenced' launcher transition.
	* src/util/hd-transition.h
	* src/util/hd-transition.c: Utility functions for loading strings and
	  keyframes from transitions.ini. Load from /etc/hildon/theme if a 
	  transitions.ini exists there, removed inotify as I can't get this
	  working correctly with multiple transitions.ini, and the same effect
	  can be had by just changing theme now.	
	* src/util/hd-util.h
	* src/util/hd-util.c: Keyframe parsing+interpolation code	
	* data/transitions.ini: Added lists of keyframes for launcher in/out
	  transitions.

2009-10-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#131169 - Erronous "animation actor destoyed while in use"
	message

	* src/mb/hd-animation-actor.c: Remove the callback with g_warning()
	from clutter actor "destroy" callback.  Patch from Artem Egorkine. 

	Fixes: NB#140086 - Backup needs to clear the .cache/launch directory
	before it reboots after restore

	* src/hildon-desktop-restore.sh: Remove old loading screens from
	.cache/launch/.

2009-10-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Use a weak pointer to the clicked tile when launching an app, avoid
	crashes if the tile is destroyed.
	Fixes: NB#141757

	* src/launcher/hd-launcher.c:

2009-10-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.106-1

2009-10-16  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.c (hd_render_manager_set_input_viewport):
	Disable status menu portrait mode.

2009-10-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-wm.c (hd_wm_current_app_is): Update _MB_CURRENT_APP_WINDOW
	on the application window as well. Related to NB#140339 - Unnecessary
	wake-ups in application due to XAtoms. Original patch from Alban Crequy.

	Release 2.2.105-1

2009-10-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-desktop.c (hd_desktop_init): Give input focus to the newly
	mapped desktop window because in the startup case we don't do it.

2009-10-15  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#142941 - Snap to grid for Home applets/shortcuts

	* data/transitions.ini: Add snap to grid key/values.

	* src/home/hd-home-view.c (snap_coordinate_to_grid,
	snap_widget_to_grid): Add snap to grid support.

	* debian/changelog: update

2009-10-15  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#137452 - Remove nice task launcher animation
	
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h
	* src/launcher/hd-launcher-grid.c
	* src/launcher/hd-launcher-grid.h: Move transition_depth from function
	  call into the grid's private data. Also load the 'sequenced' flag,
	  and disable the nice sequencing of the task launcher animation if it
	  is not set.
	* data/transitions.ini: Set sequenced to 0 for the two launcher 
	  transitions, and speed them up to the same amount as everything else.

2009-10-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#140246 - Input method support to desktop

	* tests/test-applet.c: Updated to have a GtkEntry that can be used for
	Home applet focus testing.
	* src/home/hd-home.c (hd_home_desktop_do_motion): Unfocus any applet
	if we start panning.
	(hd_home_desktop_do_press): Don't send the press event to applet that
	will be transferred the input focus.
	(do_applet_release): Focus the applet if it does not have focus and
	wants it, otherwise just send the release event.
	(hd_home_client_owns_or_child_xwindow): New function to check if a
	client owns a certain X window or has that as its child.

2009-10-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Allow keypresses to CallUI and Contacts only in HDRM_STATE_HOME.
	For: NB#141019

	* src/home/hd-home.c:
	* src/home/hd-render-manager.h:

2009-10-15  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Small tweak for last fix. Make sure
	  the status area can't be clicked if a dialog is up and it is blurred
	  (in portrait mode).

2009-10-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-home-applet.c (hd_home_applet_init): If an applet does not
	have the applet id, use "hd-applet-no-id" as fallback. Avoids a crash.

2009-10-14  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#142949 - Active status area also in portrait

	* src/home/hd-render-manager.c (hd_render_manager_set_input_viewport):
	Support active status area also in portrait mode.

2009-10-14  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#130803 - Possible to Pann in the layout mode and also able
	to come out of the layout mode without actually tapping on the Done
	button

	* src/home/hd-home-view.c:
	* src/home/hd-home.c (root_window_client_message):
	* src/home/hd-switcher.c (hd_switcher_constructed):
	* src/mb/hd-comp-mgr.c: Remove unneeded button pressed signal.

2009-10-14  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-note.c (hd_note_init): Add portrait non-comp. mode to the
	check.
	* src/mb/hd-note.c (hd_note_request_geometry): Add portrait non-comp.
	mode to the check.

	Release 2.2.104-1

2009-10-13  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#129810 - Home shortcuts backedup in one home view are
	restored in another view in a scenario

	* src/hildon-desktop-post-backup.sh:
	* src/Makefile.am: Add post backup script to remove temporary files.

	* src/hildon-desktop-restore.sh:
	* src/hildon-desktop.conf:
	* src/hildon-desktop.prebackup.sh: Fix case if default shortcuts are
	backed up.

2009-10-13  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/hildon-desktop-restore.sh: Fix restore script. Restart
	hildon-home.

	* src/home/hd-home.c (hd_home_add_applet): Empty GConfClient cache to
	make sure no old values are read.

2009-10-13  Jan Arne Petersen  <jpetersen@openismus.com>

	Make sure home.plugins is restored after GConf values are restored.

	Fixes: NB#129810 - Home shortcuts backedup in one home view are
	restored in another view in a scenario

	* src/hildon-desktop-restore.sh: Restore home.plugins-backup to
	home.plugins

	* src/hildon-desktop.conf: Backup home.plugins-backup

	* src/hildon-desktop.prebackup.sh: Copy home.plugins to
	home.plugins-backup.

	* src/Makefile.am: Add new restore script.

2009-10-13  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes NB#141441 - Screenshot texture re-allocated on rotation
	Note: requires clutter 0.8.2-0maemo54
	
	* src/tidy/tidy-cached-group.c: Use similar idea to tidy-blur-group,
	  where we keep the texture allocated at 800x480, but just rotate
	  it by 90 degrees if we have to.
	* debian/control: Depend on clutter 0.8.2-0maemo54

2009-10-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Don't process key presses when showing loading screen.
	Fixes: NB#141019

	* src/home/hd-render-manager.h:

2009-10-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Stuck in p-mode when a portrait_on_map client disappears before
	hd would have started to really manage it.  An example could be
	an incoming call that terminates very early while we're in the
	progress of rotation.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client):
	  Rotate back to landscape if the client we started rotation for
	  disappears without being ever mapped.
	* src/home/hd-task-navigator.c (create_appthumb):
	  Added X error traps that were previously though to be unnecessary.

2009-10-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Match windows on PID even if they don't have a correct WM_CLASS.
	Fixes: NB#135143

	* src/mb/hd-comp-mgr.c:

2009-10-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Send all keypresses in the same time interval to the same application.
	Fixes: NB#133392

	* src/home/hd-home.c:

2009-10-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Allow notifications in task launcher.
	Fixes: NB#132630

	* src/home/hd-render-manager.h:

2009-10-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#140066 corrected.

	* src/util/hd-transition.c (on_notification_timeline_new_frame):
	  Align the notification to the tasks button.

2009-10-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.103-1

2009-10-12  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#140558 - Menu indicator not shown in home view edit mode

	* src/home/hd-title-bar.c (hd_title_bar_set_for_edit_mode): Show menu
	indicator in edit mode.

2009-10-12  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#129810 - Home shortcuts backedup in one home view are
	restored in another view in a scenario

	* src/home/hd-home.c (hd_home_add_applet): Do not store view id to
	GConf when the view is currently not active.

2009-10-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Revert the revert of NB#134488, this isn't going anywhere.

2009-10-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#140066 [PR1.1 proposal] In portrait mode, preview notification
		  should minimize into task button

	* src/util/hd-transition.c (on_notification_timeline_new_frame):
	  Enhanced the landscape code to be usable in p-mode.
	* data/transitions.ini:
	  Added parameter to chose between the two transitions.

2009-10-09  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#134488 Emergency call made from lock code entry dialog in fold
		  closed mode does not show correctly on UI

	"Still window not drawn properly. End call button is half visible."
	Was known (also in SR) but thought to be wontfixable.

	* src/mb/hd-dialog.c (hd_dialog_request_geometry):
	  Reverted the last fix or workaround or whatever to this function
	  as it doesn't seem to be necessary anymore and just causes trouble.

2009-10-09  Gordon Williams <gordon.williams@collabora.co.uk>

	Reverted: NB#131081 - Class 0 SMS not shown full screen when switched 
	                      from portrait to landscape mode
	* src/home/hd-render-manager.h	
	* src/home/hd-render-manager.c
	* src/home/hd-home.h	  
	* src/home/hd-home.c
	* src/home/hd-title-bar.c
	* src/mb/hd-comp-mgr.c
	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c
	* src/mb/hd-status-area.c
	* src/util/hd-transition.c

2009-10-09  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#136911 [PR1.1 proposal] Windows is-topmost property is TRUE
		  for a second after call ui closes

	* src/util/hd-transition.c (hd_transition_rotation_will_change_state):
	  Account for the new fsm states.

2009-10-09  Gordon Williams <gordon.williams@collabora.co.uk>

	Regression fix (on 102): Fullscreen app -> Ctrl-BS -> TaskNav -> Home
	                         Leaves title bar invisible.
	* src/home/hd-render-manager.c: Add check for task_nav in 
	  set_visibilities. It turns out the voodoo did something after all...

	Fixes: NB#141246 - Task launcher glow does not work well for some icons

	* src/launcher/hd-launcher-tile.h: Increased HD_LAUNCHER_TILE_ICON_SIZE
	  to allow for a transparent border, added REAL_SIZE to determine the
	  size of icon we load from disk.
	* src/launcher/hd-launcher-tile.c: Now load the task launcher icons
	  with a 1px transparent border, which stops the strange effects.
	  (Previously all icons had this border, but recent ones have started
	  using the entire 64x64px area)

2009-10-09  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.102-1

	Patch from Adam for
	Fixes: NB#141838 - Able to access application menu from home and also
	panning from right to left not possible

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_reset_overlay_shape): Do not alter
	the shape of the desktop window.

2009-10-08  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#141881 - HIldon desktop crashed one time while closing and
	opening RSS applet in layout mode.

	* src/home/hd-home.c (hd_home_unregister_applet): Reset pressed widget
	when it is removed.
	* src/home/hd-home.h (hd_home_unregister_applet): Add new function.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Call
	hd_home_unregister_applet when a widget is removed.

2009-10-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Don't create a desktop window 480x800 if we're started with
	rotated screen after a crash in portrait mode because we don't
	reconfigure it ever.

	* src/home/hd-home.c (hd_home_constructed)
	* src/mb/hd-desktop.c (hd_desktop_init):
	  Create and keep the desktop window 800x800.

2009-10-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/launcher/hd-launcher.c (_hd_launcher_clear_page):
	  Reverted g_objecect_unref(page), it still crashes.

2009-10-08  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#128161 - Background is visible after receiving first message
	                   when device is locked - in layout mode
	
	* src/home/hd-render-manager.c: Ensure that we don't accidentally 
	  cancel the blurring by changing state.

	Fixes: NB#138341 - Progress indicator is not visible if too long title 
	                   set to window

	* src/mb/hd-decor.c: If a dialog has a progress indicator, and the
	  title is too long, clip the title to fit and still leave the
	  progress indicator showing.

	Fixes: NB#138369 - When zooming from app to task switcher, background
	                   does not scale
	
	* src/home/hd-render-manager.c: When moving from app to ask nav, ensure
	  that while blurring stops, the zooming still continues.

	Fixes: NB#140723 - Task Launcher background should not un-blur and 
	                   un-dim when launching new app
	                   
	* src/home/hd-render-manager.h: As we're blurring the background now,
	  don't include buttons in the blurring for the loading screen.
	* src/home/hd-render-manager.c: Make sure that for the loading screen
	  we don't force the blur group to be updated, as we know that it 
	  will soon be covered with the loading animation.	                   

	Fixes: NB#131081 - Class 0 SMS not shown full screen when switched 
	                   from portrait to landscape mode

	* src/home/hd-render-manager.h	
	* src/home/hd-render-manager.c: Removed Button handling code (it is all
	  handled in HdTitleBar now). Now do hdrm_restack/set_visibilities on
	  an idle callback. Replaced actor visible checks with
	  hd_render_manager_actor_is_visible, which is safer. Now check for
	  fullscreen-ness via size instead of by Window Flag (tallies with
	  how HDRM does visibility, and works for fullscreen notes, which
	  don't have the flag).
	* src/home/hd-home.h	  
	* src/home/hd-home.c: Fixed hd_home_edit_button_move_completed callback
	  and moved show/hide code back in, allowing HDRM button code to be
	  removed. Also removed hd_home_back_button_clicked, as this was 
	  already handled in HdTitleBar.
	* src/home/hd-title-bar.c: Removed HDRM button code, and moved call
	  of hd_launcher_back_button_clicked, in case it ever gets re-added.
	* src/mb/hd-comp-mgr.c: Make sure we re-sync visibilities if windows
	  have resized.
	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c: Removed parameters to
	  hd_launcher_back_button_clicked, as they are all ignored anyway.
	* src/mb/hd-status-area.c: Update to use the same visibility checks
	  as hdrm_place_titlebar_elements (more portrait-mode compatible).
	* src/util/hd-transition.c: Now call hdrm_queue_sync instead of
	  restacking directly.	

2009-10-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.101-1

2009-10-08  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Changed clutter_actor_destroy to g_object_unref.

	* src/launcher/hd-launcher.c:

2009-10-08  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Fix leak when recreating the launcher pages.

	* src/launcher/hd-launcher.c:

2009-10-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/launcher/hd-launcher-grid.c (hd_launcher_grid_remove): Refresh
	the adjustments also here.

2009-10-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Crash fix when you move .desktop files around, overlapping with
	each other.

	* src/launcher/hd-launcher.c (hd_launcher_populate_tree_starting,
	    hd_launcher_populate_tree_finished,
	    hd_launcher_populate_tree_finished):
	  Stop hd_launcher_lazy_traverse_tree() by source id rather than
	  by user data.  When you add the idle callback with
	  clutter_threads_add_idle_full() you can't really know
	  the user data.

2009-10-07  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes NB#142006: CallUI doesn't update orientation when screen is off

	* src/mb/hd-comp-mgr.c: Make sure we set allow_redraw(FALSE) on the
	  arena (so new windows don't trigger a redraw). Also added missing
	  unref.
	* src/tidy/tidy-blur-group.c: Remove hd_dbus_display_is_off check, as
	  it is not needed and means we can't use the file outside of h-d.
	* src/util/hd-dbus.c: Don't use clutter_stage_set_shaped_mode to stop
	  redraw, as this unfortunately stops the window's actor being updated
	  and causes the above bug. Instead use actor_hide and allow_redraw on
	  ths stage.
	  Tested and does not regress 139928.
	* src/util/hd-transition.c: Added comment about allow_redraw in order
	  to give hints to future developers.
	* debian/control: now depend on clutter 0.8.2-0maemo52, as this has
	  the fix for allow_redraw on the stage.	  

2009-10-06  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Deal with repeated, fast changes to menu files.
	Fixes: NB#141702

	* src/launcher/hd-app-mgr.c: Added debug function to dump list of known
	launcher items.
	* src/launcher/hd-app-mgr.h:
	* src/launcher/hd-launcher-tree.c: Repeat the walking every time libmenu
	notifies a change, and discard all walkings except the last one.
	* src/launcher/hd-launcher.c: If showing launcher when reloading the menus,
	go to home.

2009-10-06  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#139928 - Accessing the screen unlocking view reveals the
	underlying applications

	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Make a
	blocking redraw of the stage when the screen is lit again. This
	ensures we draw any new visible windows first.

2009-10-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#141642 [REGU]Applications are shown in portrait mode during call
		  rejections or missed calls

	Not specific to rotation, the unmap transition was skipped for all
	fullscreen dialogs if there was an application behind.  This is
	because fullscreen dialogs are in the home_blur group and when
	the dialog is unmapped and hdrm is restacked the dialog is hidden
	by the next client.

	* src/util/hd-transition.c (hd_transition_popup):
	  When playing the unmap transition for fullscreen dialogs move them
	  to the app_top container in order to prevent stacking and visibility
	  detecting interfering with us.

2009-10-05  Aapo Kojo  <aapo.kojo@nokia.com>

	Tweaked rotation values in transitions.ini.

2009-10-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#141614 Unnecessary rotations on image viewer if phone application
		  open in switcher

	2nd try

	* src/mb/hd-wm.c (hd_wm_determine_current_app):
	  Sometimes the to-be-current-app-win is not map_notified yet...

2009-10-02  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#141417 - Hildon Status Menu completely unusable after a
	scenario

	* src/home/hd-home.c (is_status_menu_dialog,
	hd_is_hildon_home_dialog): Do not close hildon-status-menu dialogs or
	confirmation notes when leaving edit mode.

2009-10-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#141380 - [ncfs] downloads dialog is not displayed in full
	screen - browser stops responding instead of showing it

	* src/mb/hd-wm.c (hd_wm_activate_zoomed_client): Check if there is a
	window above that needs compositing.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_needs_compositing): New
	function to identify a client that requires compositing.
	(hd_comp_mgr_client_property_changed): Check if there is a window
	above that needs compositing before going to non-composited mode.
	(hd_comp_mgr_is_non_composited): Return FALSE if someone calls this
	with non-application window.
	(hd_comp_mgr_map_notify): Use hd_comp_mgr_client_needs_compositing
	in the first check for returning to composited mode and handle
	non-composited portrait mode correctly as well.  Unredirect info
	banners and notes in non-composited mode.  Before going to
	non-composited mode because of application window, check that there is
	not a window that requires compositing above it (this is needed
	especially when HD starts with existing application windows).
	(hd_comp_mgr_unmap_notify): Check if there is a window above that
	needs compositing before going to non-composited mode.  Improve the
	logic when going back to composited mode.

2009-10-01  Gordon Williams <gordon.williams@collabora.co.uk>

	Regression fix: Map -> Switcher -> Map = Switcher button stops working
	                (input grab/button visibility mismatch)

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h: hd_render_manager_set_input_viewport
	  now exported for use by hd-title-bar. Added a few FIXME for possible
	  optimisations.
	* src/home/hd-title-bar.c: Call hd_render_manager_set_input_viewport
	  when title bar is updated.	

	* data/transitions.ini: Modified screenshot timeouts to remove flicker
	  with games.

2009-10-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#140567 - [ncfs] Find dropdown list cannot be expanded in
	full screen mode

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Unredirect
	override-redirect windows in non-composited mode.
	(hd_comp_mgr_unmap_notify): Do not go back to composited mode if
	override-redirect window is unmapped in non-composited mode.

2009-10-01  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	  Don't freak out Superman with rotated desktop.

	* src/main.c (main):
	  Switch to landscape initially and unconditionally.
	  If we need to rotate we will rotate with the transition.

2009-10-01  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Watch exec'd (not dbus activated) children and deal with their deaths.
	Fixes: NB#141211

	* src/launcher/hd-app-mgr.c:

2009-10-01  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#140681 - Title bar of the call UI disappears while closing 
	       from portrait mode.

	* src/home/hd-title-bar.c
	* src/home/hd-title-bar.h: Now do updates with an idle callback. Added
	  more pleasant way of setting the title for the loading screen.	
	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h: hd_render_manager_get_previous_state
	  added, and made place_titlebar_elements work off of titlebar state
	  rather than actor visibility.	  
	* src/home/hd-switcher.c
	* src/launcher/hd-launcher.c: Now use hd_title_bar_set_loading_title,
	  rather than attempting to set the title text directly.
	* src/mb/hd-comp-mgr.c
	* src/util/hd-transition.c
	* src/util/hd-transition.h: hd_transition_close_app_before_rotate and
	  related code removed as no longer needed. Quick mod to remove status 
	  area when launching portrait app from launcher.

2009-09-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Actor and timeline leak fixes.

	* src/util/hd-transition.c:
	  hd_transition_popup: keep the filler in the actor container always
	  on_popup_timeline_new_frame: don't remove and readd the filler
	    and don't leak it
	  hd_transition_fade_out_loading_screen: don't leak the timeline
	  hd_transition_rotating_fsm: do free the effects_waiting list
	    from the head

2009-09-29  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#141029 A small square-like UI glitch is oberved while opening the
		  conversation by tapping the preview in portrait mode.

	* src/home/hd-render-manager.c (hd_render_manager_allow_dbus_launch_transition):
	  Disallow the appstart transition in portrait mode. The launched
	  application will likely want landscape and we won't be able to
	  finish this transition while rotating.

2009-09-29  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#140965 The UI blurs and distorts for fraction of time before
		  switching to portrait or landscape mode in Phone app.

	* src/tidy/tidy-cached-group.h (tidy_cached_group_set_downsampling_factor):
	  Make it configurable how large the offscreen buffer should be.
	* src/tidy/tidy-cached-group.c (tidy_cached_group_paint):
	  Take it into account.
	* src/util/hd-transition.c (hd_transition_rotating_fsm):
	  Tell HdRenderManager to render to an fbo with the same size
	  rather than scaling down to 1/4th.

2009-09-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#134893 - 'scanning' control panel plugins have negative
	use-time behaviour

	* src/util/hd-transition.c (on_close_timeline_new_frame): Don't do the
	particle animation if the screen is off.
	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Set Clutter
	to shaped mode when the screen is off. This avoids drawing to screen
	in maemo50 and newer Clutter versions.

2009-09-29  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#140969 - Widgets using CPU after screen blanking
	(is-on-current-desktop property)

	* src/mb/hd-comp-mgr.c
	(hd_comp_mgr_update_applets_on_current_desktop_property): Only set on
	current desktop property for widgets when display is switched on.

	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Update
	widgets on current desktop property if display switches on/off.

2009-09-29  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c:
	  Don't leave dangling ClutterTimeline:s behind.
	  Saves 72 bytes per transition.

2009-09-28  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add Ovi Store entry to hard-coded apps list and ordering.
	Fixes: NB#139681

	* data/menu/hildon.menu:
	* src/launcher/hd-launcher-item.c:

2009-09-28  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fix a memory leak spotted by Mathias Hasselmann.

	* src/home/hd-home.c (root_window_client_message): Don't return
	without freeing 'filename'.

	Memory leak fixes from Laszlo.

	* src/home/hd-home-view.c (hd_home_view_applet_press): Free
	modified_key.
	* src/home/hd-home.c (hd_home_desktop_do_motion): Free list->data.
	* src/launcher/hd-app-mgr.c (hd_app_mgr_populate_tree_finished): Free
	the right list pointers.

2009-09-25  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#140788 - Compositor updating the entire screen 
	                   when not required
	This lets progress indicators and the switcher button update only the
	area of the screen that has changed - not everything.

	* src/util/hd-util.c
	* src/util/hd-util.h: Added function hd_util_partial_redraw_if_possible
	  to work out if a partial redraw is possible for an actor, and if so,
	  to queue it.
	* src/util/hd-transition.c: use hd_util_partial_redraw_if_possible
	  when updating the progress indicator on decor.	  
	* src/home/hd-title-bar.c: use hd_util_partial_redraw_if_possible
	  when updating the pulsing task switcher button.
	* src/home/hd-render-manager.h
	* src/mb/hd-comp-mgr.c: Now use hd_util_partial_redraw_if_possible
	  instead of the old in-lined approach. The new function allows us
	  to cope with scaled actors, so there is no longer any reason not
	  to enable partial redraws for the task navigator and launcher
	  (hence removed STATE_DO_PARTIAL_REDRAW define).
	* tests/pvr-viewer.c (Added): Simple viewer app for .pvr texture files

2009-09-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#140378 - ctrl + backspace leaves the switcher black

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Call
	hd_render_manager_restack when we go back to composited mode.

2009-09-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#140674 - bad banner removal

	* src/home/hd-switcher.c (hd_switcher_loading_fail): Do not show the
	banner.
	* src/mb/hd-wm.c (hd_wm_client_responding): Do not show the banner.

2009-09-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Further fixes to avoid unseen animations.
	Fixes: NB#134893 - 'scanning' control panel plugins have negative
	use-time behaviour

	* src/home/hd-title-bar.c (hd_title_bar_init): Toggle on
	visibility_detect for the progress indicator.
	(on_switcher_timeline_new_frame): Skip the animation if the display is
	off.
	* src/home/hd-render-manager.c (hd_render_manager_actor_is_visible):
	Make public. Renamed to this from actor_is_visible.
	* src/tidy/tidy-blur-group.c (tidy_blur_group_paint): Don't paint if
	the display is off.
	* src/util/hd-transition.c (on_decor_progress_timeline_new_frame):
	Don't animate progress indicator if it's not visible.
	(on_fade_timeline_new_frame): Don't animate if the display is off.
	(on_notification_timeline_new_frame): Don't animate if the display is
	off.
	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Redraw the
	Clutter stage when the display is back on.

2009-09-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Merge of the newrot branch.

	* src/home/hd-render-manager.c:
	  When looking at a client's geometry try to guess its orientation
	  and map to the screen's current one if they disagree, making all
	  clients appears as if they were in the same orientation so we can
	  reason about visibility better.
	* src/mb/hd-comp-mgr.c:
	  Revert ``Fix of the "[r]egression fix for last change"''.
	* src/util/hd-transition.c:
	  Revert ``[r]egression fix for last change''.
	* src/util/hd-util.h
	* src/util/hd-util.c:
	  Some refactoring, hd_util_rotate_geometry() added.

2009-09-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* data/transitions.ini (rotate, popup, subview):
	  Tuning times and angles per UK request.

2009-09-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Fix of fix of NB#134488 which broke some dialogs causing
	button overlaps.

	* src/mb/hd-dialog.c (hd_dialog_request_geometry):
	  HdDialog::requested_height is frame height.

2009-09-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#134893 - 'scanning' control panel plugins have negative
	use-time behaviour

	* src/util/hd-transition.c (on_decor_progress_timeline_new_frame):
	Don't animate when the display is off.

2009-09-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes: NB#139902 - Desktop updates screen although screen has blanked

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_texture_update_area): Return
	without doing anything if the display is off.
	* src/launcher/hd-app-mgr.c (hd_app_mgr_mce_activate_accel): Do not
	touch the MCE_DISPLAY_SIG signal D-Bus matches, that's always needed.
	* src/util/hd-dbus.c (hd_dbus_init): Add match for MCE_DISPLAY_SIG.

2009-09-23  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#140332 - smooth fade out to the loading screen screenshot

	* src/util/hd-transition.c
	* src/util/hd-transition.h: added hd_transition_fade_out_loading_screen
	  to fade out the loading screen, also extra checks to  
	* data/transitions.ini: added duration_out to launcher_launch for
	  setting duration of the fade out.	
	* src/home/hd-render-manager.c: Now ensure that we call 
	  hd_transtion_fade_out on the loading screen, to make it fade out
	  slowly.	  

2009-09-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Speed up building and package creation, for bifh user's pleasure.

	* debian/rules:
	  autogen.sh only if ./configure doesn't exist yet.
	* Makefile.am:
	  Don't build the test programs.
	* src/home/Makefile.am:
	  Remove trailing whitespace, who knows what did it cause.

2009-09-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Plug in memory leaks.

	* src/home/hd-render-manager.c (hd_render_manager_append_geo_cb):
	  First decide we need @geo then allocate memory for it.
	* src/util/hd-volume-profile.c (hd_volume_profile_is_silent):
	  free() strings returned by libprofile.

2009-09-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#139357 hildon-desktop-A730-11-1167 crash after random using
		  and then rebooting the device.

	We got a shutdown request from DSME and exit()ed.  This triggered
	clutter's atexit() callback which started to clean up, which
	HdTaskNavigator didn't like because it was in the middle of
	some operations.

	* src/util/hd-util.c (hd_dbus_system_bus_signal_handler):
	  Exit but don't run clutter's clean up code.  This may also
	  help with shutdown performace.

2009-09-22  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#139906 - All (non-portrait) dialogs are resized on rotation
	
	* src/mb/hd-dialog.c: Add check to stop resizes in portrait mode.

2009-09-22  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Ensure correct creation of texture in hd_launcher_tile_set_icon_name.
	This was alluded to in NB#139357.

	* src/launcher/hd-launcher-tile.c:

2009-09-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (on_notification_timeline_new_frame):
	  Align notifications to the narrower tasks button and use easing.

2009-09-21  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#140044 - When trying to start panning the desktop over a
	widget it is too easy to start the widget instead

	* src/home/hd-home.c (HdHomeDrag, hd_home_desktop_motion,
	  hd_home_desktop_release, hd_home_desktop_press, hd_home_applet_press,
	  hd_home_applet_release, do_home_applet_motion,
	  hd_home_applet_motion): Use the release event coordinates for a
	  simulated motion event before handle the release.

2009-09-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-home.c: Remove hd_home_applet_press and
	hd_home_applet_release g_warning spam.

2009-09-21  Gordon Williams <gordon.williams@collabora.co.uk>

	Applying Marc's patch:
	Fixes: NB#138800 (S3,crash) Desktop crashed.
	* src/launcher/hd-launcher.c
	* src/launcher/hd-app-mgr.c: When traversing over tree items, make
	  a copy of the list of items rather than using it directly. 
	* src/hildon-desktop.h: Allow reading of HD_NOTHREADS, but only
	  in debug of x86 mode

2009-09-21  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#139904 (S3) Non-comp exiting from full screen makes browser
	                      title overlapping status bar
	* src/home/hd-render-manager.c: Re-evaluate where title bar elements
	  are placed immediately after we make status area visible (after it
	  has been invisible). 

2009-09-21  Gordon Williams <gordon.williams@collabora.co.uk>

	Another fix for new portrait transition. Make sure no apps are
	resized in the background.
	* src/util/hd-transition.c
	* src/util/hd-transition.h: add hd_transition_is_rotating_to_portrait
	* src/mb/hd-app.c: Now check for hd_transition_is_rotating_to_portrait
	  before resizing an app, as we may not be in portrait mode yet, but
	  we're be resizing before we change state.

2009-09-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Fix of the "[r]egression fix for last change".

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_restack):
	  Don't hdrm_restack() and check for portrsit if we're rotating.
	  We may get it wrong and the rotating fsm will restack anyway.
	* src/util/hd-transition.c (hd_transition_rotating_fsm):
	  hdrm_restack() in FADE_IN not eariler.

	Let's see if we'll have fix of the fix of the fix.

2009-09-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-dialog.c (hd_dialog_request_geometry):
	  Now really do bottom-align dialogs.

2009-09-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-transition.c (hd_transition_close_app): Don't leak the
	timeline object, it's enough to have one reference count for it. 
	Related to NB#134230 and NB#98132.

2009-09-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	139325 [S3 Proposal] Device turns to Portrait mode completely

	We were too optimistinc and turned to portrait even if there was
	a non-portrait capable system dialog.  This caused us to land in 
	APP state but turned to portrait and when the app exited we went
	back to HOME and didn't rotate back to landscape.  This is what
	one gets when he add performance hacks to a stable logic.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_portrait_forecast):
	  Be more careful about starting the rotation transition.
	  Now only do that if we are idling in landscape and no
	  sysmodal dialogs are in the way.
	* src/util/hd-transition.c (hd_transition_is_rotating):
	  Added.

2009-09-18  Gordon Williams <gordon.williams@collabora.co.uk>

	Regression fix for last change (getting stuck in landscape mode). 
	* src/util/hd-transition.c: Extra call to restack sets visibilities
	  correctly in case of very quick l->p->l transition, and allows
	  callui to request portrait mode again.

2009-09-17  Gordon Williams <gordon.williams@collabora.co.uk>
	
	Code to improve screen rotation speed
	Related to NB#139504
	Also fixes NB#139522 - another tuneup
	
	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h: Make this descend from TidyCachedGroup,
	  which allows us to take a screenshot of the whole screen before 
	  rotate.
	* src/util/hd-transition.c: Use hd_util_set_screen_size_properties
	  before rotation (and restore after). Add TRANS_START state to help
	  remove jittery transition. Use MBWindowManagerFlagLayoutRotated to
	  lay windows out before rotate too. Also take screenshot of the
	  screen using TidyCachedGroup for the first half of the anim.
	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h: HD_ATOM_MAEMO_SCREEN_WIDTH/HEIGHT for hd-util	  
	* src/util/hd-util.c
	* src/util/hd-util.h: Add hd_util_set_screen_size_properties, which
	  tells GdkScreen to send a resize event before the screen has
	  actually resized.
	* data/transitions.ini: Make durations 250 each, fix angle - as now
	  fade-out isn't complete, it was obviously broken.
	* debian/control: Increase libmatchbox dependency

2009-09-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Add a Gtk-free test/example program for various window properties.

	* tests/Makefile.am, tests/test-no-gtk.c:

2009-09-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Listen to MCE signals only when rotate-to-callui is enabled.
	For: NB#138990

	* src/launcher/hd-app-mgr.c:

2009-09-16  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#138895 - progress indicator not shown sometimes
	
	* src/mb/hd-comp-mgr.c: Regression for after app menu indicator 
	changes. Thoughtless tidying on my part had removed code that
	updated dialog titles when the progress indicator changed.

2009-09-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Disable MCE's accelerometer signals when not needed.
	Fixes: NB#138990

	* debian/control:
	* src/launcher/hd-app-mgr.c:

2009-09-15  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#138831 Operator logo is laid out under Status Area after changing
		  the device profile

	* src/home/hd-render-manager.c (hd_render_manager_set_status_area):
	  Act when the SA's width is changed, not when its geometry is
	  allocated.  Changing geometry during allocation does not seem
	  to be effectualized until the next allocation cycle.

2009-09-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#134488 Emergency call made from lock code entry dialog in fold
		  closed mode does not show correctly on UI

	911 fix.  Try to honor dialogs height request better.

	* src/mb/hd-dialog.h:
	  Added HdDialog::requested_height to track the last height
	  requested by the client.
	* src/mb/hd-dialog.c (hd_dialog_request_geometry):
	  If the request was made by the layout manager see if we can
	  satisfy the client's earlier request.  If the resulting
	  y+h > xdpy_height try reducing y instead of h.

2009-09-11  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Stack dialogs with no transient_for correctly. (Adam's patch)
	Fixes: NB#131703

	* src/mb/hd-wm.c:

2009-09-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_rotating_fsm):
	  Consider WAIT_FOR_ROOT_CONFIG done when notify::width
	  as opposed to notify::allocation -- the former is called
	  right when the stage is resized, the latter is later,
	  when geometry is actually allocated, which is too late
	  for our purposes.
	* src/util/hd-util.c (hd_util_change_screen_orientation):
	  Unbreak _MAEMO_SUPPRESS_ROOT_RECONFIGURATION.

2009-09-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-util.c (hd_util_change_screen_orientation):
	  Delete _MAEMO_SUPPRESS_ROOT_RECONFIGURATION right after xrr,
	  defeating its purpose because it seemed to have cause lost
	  damages.

2009-09-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#134557 Rotation suffers from too early mapping

	This is nivea2g.

	* src/home/hd-render-manager.c:
	  Make blur_front not shown when reparented, because
	  we may need to reparent it when it's hidden.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_portrait_forecast):
	  Listen to MBWindowManagerSignalPortraitForecast and start rotating
	  when we get one.
	* src/util/hd-transition.c (hd_transition_rotating_fsm):
	  - use hptimer instead of g_timeout_add()
	  - understand damage_timeout_plus
	  - WAIT_FOR_ROOT_CONFIG phase added
	* src/util/hd-util.h
	* src/util/hd-util.c (hd_util_root_window_configured):
	  Reworked to be called by the rotating fsm instead of mb signal.
	* src/mb/hd-wm.c:
	  Removed handling of MBWindowManagerSignalRootConfigure.
	* data/transitions.ini:
	  - changed the animation time to 250/250
	  - added damage_timeout_plus

2009-09-10  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#137524 - Task Launcher animation stutters when launching app
	                   And task launcher animation from top-left corner

	* src/launcher/hd-launcher.c: Now move the launcher window using its
	  anchor point rather than its actual position. This means it doesn't
	  conflict with other parts of hildon-desktop which set the position.

2009-09-09  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#119749 - Redundant exposure causing glitches on rotation
	
	* debian/control: Make hildon-desktop depend on newer libmatchbox
	* src/util/hd-util.h
	* src/util/hd-util.c: Remove deleting of the ROOT_RECONFIGURATION
	  property until hd_util_root_window_configured is called.
	* src/util/hd-transition.c: Stop anything from causing hildon-desktop
	  to redraw the screen during the blanking period.
	* src/mb/hd-wm.c: On root reconfiguration, call the function
	  hd_util_root_window_configured to remove the RECONFIGURATION atom.

2009-09-09  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Delay launching timeout depending on loadavg, Thomas Thurman's patch.
	Fixes: NB#134696

	* data/transitions.ini:
	* src/launcher/hd-app-mgr.c:

2009-09-09  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#137793 - Indicator for view menu in app title area
	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h: Added menu indicator atom	
	* src/mb/hd-theme.h: Add #defines for new theme image
	* src/mb/hd-decor.c
	* src/mb/hd-decor.h: Added function to check for presence of menu
	  indicator atom.	
	* src/home/hd-title-bar.c
	* src/home/hd-title-bar.h: Added code to load and show menu indicator
	  atom.
	* src/home/hd-home.c
	* src/mb/hd-comp-mgr.c: Simplified title bar progress indicator code,
	  and moved into hd-comp-mgr's property listener, removing a whole
	  extra property listener function. Also added listener for menu
	  indicator atom.

2009-09-08  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#137601 - Cannot add 5 contacts on a row to desktop
	
	* src/home/hd-home-view-layout.c: reduced padding from 16px to 13px

2009-09-08  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#135059 - (S3)Home view panning slower over applets than
	                       desktop
	
	* control: Requires clutter maemo49, so updated
	* src/home/hd-home.c: use clutter_grab_pointer_without_pick to let us
	grab clutter input without having clutter do costly selection for us
	each frame.

2009-09-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Apply patch from Phil Carmody to add X Terminal keyboard shortcut.

	* src/main.c: "<shift><ctrl>x" causes execution of osso-xterm.
	Fixes: NB#136949 - Feature/Info request - new 'magic keys' on the

2009-09-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#136031 [PATCH] The window closing tone is played twice on closing
		  an app from the switcher

	* src/home/hd-task-navigator.c (turnoff_effect):
	  Don't make redundant noise as it is made by hd_comp_mgr_effect() now.

2009-09-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#135948 [PATCH] 'Zombie window' seen in email

	* src/home/hd-task-navigator.c (add_nothumb):
	  Reset the new nothumb's opacity as it may have been orphaned
	  when it was transparent.

2009-09-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#137478 [S3 PROPOSAL]Switcher becomes non responding on opening
		  power menu while on switcher view.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Go HOME again if an application menu is mapped.  This is for the
	  pwk menu -- ordinary appmenus are not supposed to be mapped when
	  the application is not in the foreground (ie. we're not in APP
	  state).

2009-09-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#136911 [PR1.1 proposal] Windows is-topmost property is TRUE
		  for a second after call ui closes

	* src/util/hd-transition.h
	* src/util/hd-transition.c (hd_transition_rotating_will_change_state):
	  Added function to tell whether the rotating fsm is known to be
	  changing state...
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_restack):
	  ...in which case don't set CURRENT_APP_WIN and don't play with
	  hibernation either.

2009-09-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#132220 [PATCH] Empty title bar in a particular scenario

	* src/home/hd-task-navigator.c (appthumb_clicked,
	  appthumb_close_clicked, nothumb_clicked):
	  Ignore clicks in inappropriate states.  The previous assumption
	  was that those callbacks won't be activated if we're not in
	  TASK_NAV state, but it turns out to be a dream.

2009-09-04  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.100

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unmap_notify): Do not leak dialogs
	that went from transient to intransient in task navigator.
	Fixes: NB#133517 - possible memory leak in libosso-abook

2009-09-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fix a memory leak. Related to NB#98132 and NB#134230

	* src/mb/hd-theme.c (back_button_press_handler): Reference the button
	if we put a new timeout handler.
	(construct_buttons): Do not reference the button for press handler,
	because it's not called if the button is destroyed.
	(back_button_release_handler): Unreference the button to destroy it.

2009-09-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.99

	* src/home/hd-render-manager.[ch], src/mb/hd-comp-mgr.c: Add a new
	HDRM state HDRM_STATE_NON_COMP_PORT for non-composited portrait
	applications.
	Fixes: NB#135261 - Switching to portrait mode does not work in MicroB

2009-09-01  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	reverting NB#134557

2009-08-31  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.98

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Show menus and HSM
	unredirected if we're in the non-composited mode.

2009-08-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  Begin to rotate when we get a MBWindowManagerSignalPortraitForecast.
	* src/util/hd-transition.c:
	  Don't spin the main-main loop until the FADE_OUT phase of the
	  rotation transition is over.
	* data/transitions.ini:
	  Changed damage_timeout to 120.

	svn up clutter libmatchbox

2009-08-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Do not switch away
	from non-composited mode if a mere banner is mapped.

2009-08-28  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.97

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Redirect
	all unredirected clients.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unredirect_topmost_client):
	Centralise unredirecting here.
	(hd_comp_mgr_map_notify): Unredirect new non-composited clients when
	we are in the non-composited mode.

	Release 2.2.96

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Check
	that the client selected for unredirection is fullscreen. This avoids
	selecting e.g. the tklock window for unredirection...
	Fixes: NB#135542 - Browser in full screen mode displays only blank
	screen after going out from idle state

2009-08-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.95

2009-08-27  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#134348 - SMS notifications in non-composited mode. Other
	                   issues as reported by testers.
	* src/mb/hd-comp-mgr.c: When checking for non-composited mode on 
	unmap, ignore banners and incoming event notes.
	* src/mb/hd-note.c: Now position incoming event windows off of the
	screen, as there was never any need for them to be visible (and
	they cause flicker on the very first event received in non-composited
	mode).	  	

2009-08-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-home.c (hd_home_remove_dialogs): Close transients (such
	as drop down menus) of dialogs as well.
	Fixes: NB#135459 - Unable to use home layout mode once camera is
	launched after opening settings of rss

	* src/util/hd-transition.c (hd_transition_play_sound): Tell Canberra
	to use whatever volume is specified for system sounds.
	Fixes: NB#129527 - Application opening and closing sound is same at
	Level 1 and Level 2

2009-08-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.94

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Switch back to
	composited mode before trying to create a Clutter texture.
	* src/home/hd-render-manager.c (hd_render_manager_set_state): When
	going to the non-composited mode, unredirect only the topmost
	application window, not all windows. Same for damage tracking.
	Fixes: NB#126626 - Switching between non/composite modes, make screen
	blank for short time  (partial fix)

2009-08-26  Gordon Williams <gordon.williams@collabora.co.uk>

	Regression fix for crash in malloc from tidy-sub-texture, core
	  627a29d3507b7c8634fae14048968855801030da.
	
	* src/tidy/tidy-sub-texture.c: Better check for width and height of
	0, and also avoid mallocing 0 bytes if the sub-texture has a width or
	height of 0.

	Fixes: NB#134962 - Device gets stuck showing rotated image
	
	* src/util/hd-transition.c: Make sure we reset the rotation values
	  after the transition, as it seems in some strange cases, 
	  clutter-timeline may not execute the final element in the timeline,
	  leaving the screen slightly (or very!) rotated.

2009-08-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.93

2009-08-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#135094 Infonote and banner tuneups phase 3

	* src/util/hd-transition.c (hd_transition_fade,
	on_fade_timeline_new_frame):
	  Changed the transition for info notes and banners to slide them
	  from/to the top.

2009-08-25  Gordon Williams <gordon.williams@collabora.co.uk>

	Release 2.2.92

	Fixes: NB#134958 - Task switcher button in portrait mode is the wrong 
	                   size
	* src/home/hd-title-bar.c: Now set left_width to the actual button
	  width, rather than the width of the button image.

	Fixes: NB#134348 - black rectangle flickers for notifications in
	                   non-composited mode
	* src/mb/hd-note.c: Now move notifications off the screen if created
	  in non-composited mode. See the comments next to the changes as to 
	  why changing stacking order does not work.

	Fixes: NB#134956 - infonote + banner tuneups
	* data/transitions.ini: Changed transparency of infonotes and banners
	  from 20% from 15%

2009-08-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.91

2009-08-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-title-bar (hd_title_bar_init):
	  Minor typo correction just to commit something today.

2009-08-21  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#134286 - can't switch from maps using onscreen button
	* src/home/hd-render-manager.c: Now we check the whole clutter tree
	  for visibility before setting the input mask for an button. This
	  is more robust, as any actor up the tree that is invisible can
	  mean that the input mask should not be set.

	Added small title bar buttons for portrait mode.
	
	* src/home/hd-render-manager.c: Set HDTB_VIS_SMALL_BUTTONS when in
	  portrait mode.
	* src/home/hd-title-bar.c
	* src/home/hd-title-bar.h: Added hd_title_bar_get_button_width and
	  HDTB_VIS_SMALL_BUTTONS, and reposition icons accordingly when
	  the state flag is set.
	* src/mb/hd-status-area.c: Added comment about positioning

2009-08-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.90

2009-08-21  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#132154 - USE-TIME F-MEDIA PLAYER: UI components visibility
	when device is dimmed

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Update
	the on_current_desktop window property if the applet shown state
	changes.

	* src/mb/hd-desktop.c (hd_desktop_stack): Extract function to update
	on_current_desktop window property.

	* src/mb/hd-comp-mgr.c
	(hd_comp_mgr_update_applets_on_current_desktop_property):
	* src/mb/hd-comp-mgr.h: Move function to update applets
	on_current_desktop window property to here. Only set the property if
	the applets are shown state is set.

	* debian/changelog: update.

2009-08-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.89

	* src/hildon-desktop-views.schemas: Default value for
	disable_phone_gesture is now true. Fixes: NB#134396

	Release 2.2.88

2009-08-20  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#134110: Need to dither backgrounds down to device's 
	                  capabilities
	* src/home/hd-home-view.c: Dither png files down to 16 bits. This makes
	  a better quality image than letting GLES dither to 16 bits, and 
	  increases performance and decreases memory usage.

	We now set the _MAEMO_ROTATION_TRANSITION property to show if we are
	currently doing a rotation transition or not.

	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h: added _MAEMO_ROTATION_TRANSITION	
	* src/util/hd-util.c
	* src/util/hd-util.h: added hd_util_set_rotating_property to set the
	  _MAEMO_ROTATION_TRANSITION property
	* src/util/hd-transition.c: call hd_util_set_rotating_property
	  before and after the transition

2009-08-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Task navigation in p-mode.

	* src/home/hd-render-manager.c:
	  Show the Tasks button in p-mode.
	* src/home/hd-switcher.c:
	  Make long pressing the Tasks button work in p-mode.

	If you begin complaining about the unsmooth transition
	i'll slaughter you.

2009-08-20  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: hildon-desktop's half of 133950 (transparency), the other
	       half is in hildon-widgets.
	       
	* src/util/hd-transition.c: Code to only fade certain notes in
	  and out to the alpha values given in data/transitions.ini	  
	* data/transitions.ini: added banner_note_alpha/info_note_alpha

2009-08-20  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.87

2009-08-20  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add desktop file option X-Maemo-Ignore-Lowmem to allow apps to start
	even in lowmem condition. Also, show correct message when unable to
	start app.
	Fixes: NB#132749

	* src/home/hd-switcher.c:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher-app.c:
	* src/launcher/hd-launcher-app.h:

2009-08-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/tidy/tidy_blur_group.c:
	  NULL pointer checks.

2009-08-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Don't create a texture for notification windows,
	  we don't use it for anything.

2009-08-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/tidy/tidy_blur_group.c:
	  Don't check for TIDY_IS_BLUR_GROUP().  This is done literally
	  a hundred times during an innocent map and we should be grown
	  up enough not to need it anymore.

2009-08-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Little performance improvements, one by one so it'll be easy to revert.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect):
	  Now don't hd_transition_fade(a_notification) even when the thing
	  is being unmapped.

2009-08-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/main.c:
	  Make sure "built with libmatchbox2 ..." remains
	  in the hildon-desktop executable.

2009-08-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.86

2009-08-19  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#133432 - long press to go to edit mode

	* src/home/hd-home.c (LONG_PRESS_DUR, _HdHomePrivate::long_press,
	  _HdHomePrivate::press_timeout, _HdHomePrivate::pressed_applet,
	  HdHomeDrag, hd_home_desktop_do_motion, hd_home_desktop_motion,
	  hd_home_desktop_do_release, press_timeout_cb,
	  hd_home_desktop_do_press, hd_home_desktop_release,
	  hd_home_desktop_press, hd_home_dispose, hd_home_applet_press,
	  do_applet_release, hd_home_applet_release, hd_home_applet_motion):
	  Implement long press to go to edit mode.

	* debian/changelog: update.

2009-08-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Apply patch from Laszlo Pere for NB#127974.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_property_changed): Track
	changes to HILDON_NON_COMPOSITED_WINDOW property.
	(hd_comp_mgr_is_non_composited): Add argument to force re-reading the
	property.
	* src/mb/hd-wm.c: Use the new calling convention for
	hd_comp_mgr_is_non_composited.

2009-08-19  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-app-mgr.c (hd_app_mgr_execute): Fix memory leak
	caused by removal of warning without removal of preceding
	"if" statement.

2009-08-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.85

2009-08-18  Gordon Williams <gordon.williams@collabora.co.uk>

	More improvements for NB#113278
	* src/mb/hd-comp-mgr.c: Make sure hd_transition fade is not called
	  for incoming event notes (which go straight into switcher anyway).
	  This saves a few redraws the very first time a notification appears.

2009-08-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.84

2009-08-18  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#113278 - Choppy playback when receiving notification
	                   Not 100% fixed, but massively improved.
	* src/home/hd-render-manager.c: No longer hide task nav button,
	  as it will be done by hiding blur_front. Button vis should be 
	  handled by hd_tb_set_state anyway.
	* src/home/hd-title-bar.c: Now check visibility state of the
	  title bar before allowing redraws to be queued for the flashing
	  task navigator button.
	* debian/control: Set depends on new clutter (maemo45) with 
	  the redraw improvements
	
2009-08-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.83

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_property_changed): Make
	sure the client is HdApp before calling hd_comp_mgr_is_non_composited
	for it.

2009-08-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.82

	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): Update a
	global variable when the display goes on/off.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_texture_update_area): New commented
	out code for detecting actors that are updated when the display is
	off.

	Apply additional patch from Laszlo for NB#128223.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unmap_notify): Switch back to
	composited mode if non-composited window was unmapped and the next
	window in the stack does not request non-composited mode.

	Release 2.2.81

2009-08-14  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Apply a patch from Laszlo Pere for NB#128223.

	* src/mb/hd-app.c (hd_app_detransitise): New detransitise handler
	that stores the window ID we were transient for.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Add application
	windows to transient list as well.
	(hd_comp_mgr_unregister_client): Go to switcher only if the
	application window wasn't transient.
	(hd_comp_mgr_client_property_changed): Handle fullscreen property
	change properly when the non-composited mode is involved.

	* src/tidy/tidy-scroll-bar.c (adjustment_changed_cb): Use
	CLUTTER_PRIORITY_REDRAW to make panning smoother in launcher.

2009-08-14  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Don't tell HdAppMgr that an app has closed until all windows have really
	closed. The previous behavior created problems in apps with multiple
	windows.
	Fixes: NB#114733

	* src/mb/hd-comp-mgr.c:

2009-08-14  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#132718 - Home screen fn+ctrl mode keypresses do not open
	contacts as they should

	* src/home/hd-home.c (hd_home_desktop_key_press,
	  hd_home_desktop_key_release): Handle FN key reset also when
	  call-ui/contacts are not started.

2009-08-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Restore launching sound for apps with no loading screen.
	Fixes: NB#131160

	* src/launcher/hd-launcher.c:

2009-08-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.80

2009-08-12  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#132456 - Status menu should not grab pointer

	* src/mb/hd-status-menu.c (hd_status_menu_class_init,
	  hd_status_menu_destroy, hd_status_menu_class_type,
	  hd_status_menu_new, hd_status_menu_realize):
	* src/mb/hd-status-menu.h (HdStatusMenu::parent,
	  HdStatusMenu::release_cb_id): Use a modal blocker window for the
	  status menu to be able to remove the pointer grab.

	* debian/changelog: update.

2009-08-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.79

	Fix some Coverity issues.

	* src/home/hd-clutter-cache.c (hd_clutter_cache_get_real_texture): Add
	NULL checks for g_malloc calls.
	* src/util/hd-transition.c (transitions_ini_changed): Check the return
	status of g_io_channel_read_chars.

2009-08-12  Gordon Williams <gordon.williams@collabora.co.uk>

	Corrects one of the scenarios for the wrong closing animation,
	bug 131647
	* src/mb/hd-comp-mgr.c: Add check for desktop as window type that
	can cover an application and stop the closing animation.

	Fixes: NB#131502 - When moving from app to Switcher, background 
	                   flickers
	* src/home/hd-render-manager.c: When changing from APP to TASK_NAV
	  state, stop the transition of the background brightness/blur at
	  its final values immediately. This makes sure that as soon as
	  the background is visible, it is darkened (rather than slowly
	  becoming darkened as before).

2009-08-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.78

2009-08-11  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#131647 - Able see the camera closing transition on top of 
	                   the lock code dialog (S2)

	* src/mb/hd-comp-mgr.c: If we have an app or dialog on top of a window
	  that is closing, skip the close animation (but still play the sound).
	  Remove FIXME comment I added before, as not required.
	
	Added extra test for when a window is opened via hildon_uri_open  
	* tests/test-app-launch.c: Added hildon_uri_open button
	* tests/Makefile.am: added libhildonmime for test-app-launch

2009-08-10  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.77

	Apply a patch from Thomas Thurman for different banner stacking.

	* src/mb/hd-note.c (hd_note_stack): New stacking function to override
	the default behaviour of raising the window that a banner is transient
	for even if the window belongs to a background application.
	Fixes: NB#122930, NB#129485

2009-08-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.76

2009-08-07  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#117646 - hildon-desktop rewrites applet related GConf keys
	during bootup

	* src/home/hd-home-view.c (hd_home_view_store_applet_position,
	  hd_home_view_applet_release, hd_home_view_load_applet_position,
	  hd_home_view_add_applet): Do not store position key if they are not
	  changed.

	* debian/changelog: update.

2009-08-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.75

2009-08-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#127962 [AF Checked] [S3 proposal] [Erik no S3] Incoming chat
		  notification NOT shown in potrait mode in a scenario 

	Then show them with a new nice transition.

	* src/home/hd-render-manager.h (STATE_DISCARD_PREVIEW_NOTE):
	  Don't discard notif previews in APP_PORTRAIT state.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait_ignoring):
	  Assume portrait-capability of notif previews.
	* src/util/hd-transition.c (on_notification_timeline_new_frame):
	  New transition for notif previews in portrait.

2009-08-06  Gordon Williams <gordon.williams@collabora.co.uk>

	Release 2.2.74

	Fixes: NB#128009 - Opening a new message takes two minutes during 
	                   yuotube playback
	* src/home/hd-render-manager.c: Increase delay to 1000ms from 250ms,
	  because dbus is often so amazingly slow that the 'window open' 
	  message arrives over 250ms after the window that was supposed to
	  be opening has appeared.

	* src/mb/hd-animation-actor.c: Made some debug prints that spam syslog
	during image viewer #defined.

2009-08-06  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.73

2009-08-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#128667 [AF Checked] No "window close" sound when >= 2 windows open

	* src/home/hd-task-navigator.c (turnoff_effect):
	  Play the window-closed sound at the beginning of the effect.
	* src/util/hd-transition.c (hd_transition_close_app_before_rotate):
	  Same for the case when a portrait app is closed.
	* src/util/hd-transition.h (HDCM_WINDOW_OPENED_SOUND,
	  HDCM_WINDOW_CLOSED_SOUND):
	  Added #define:s for the sound file paths.
	* src/launcher/hd-launcher.c (hd_launcher_transition_app_start):
	  Use them.

	Enjoy the hundreds of milliseconds delays.

2009-08-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#130530 Still in task switch view after closing camera lens cover

	At the point of coming back from portrait mode we didn't find
	Camera as current application and confused the hdrm state.

	* src/mb/hd-comp-mgr.h (hd_comp_mgr_client_is_maximized):
	  So be smarter and find it.

2009-08-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#129745 [AF Checked] [REGF] Incoming call UI is not coming in
		  Portrait mode when device is locked from layout view

	* src/home/hd-render-manager.h (STATE_IS_PORTRAIT_CAPABLE):
	  Mark HOME_EDIT state as one which we can switch to portrait mode from.

	Happy atomic explosion anniversary.

2009-08-05  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-util.c (hd_util_modal_blocker_release_handler): Before
	sending delete to the client, check that the client's actor is not on
	top of the place where the ButtonRelease is reported, because that
	means that the ButtonRelease is just reported for the blocker window
	because the corresponding ButtonPress was reported to the blocker (X
	server always sends the press and release events to the same window).
	Fixes: NB#131259 - HildonAppMenu getting extra
	mb_wm_client_deliver_delete() calls

2009-08-05  Gordon Williams <gordon.williams@collabora.co.uk>

	* data/transitions.ini: Modified damage_timeout value to their
	  original (pre-2.2.69) state. If kept at the 40/40 ms values
	  dialpad -> show menu -> rotate displays a black background,
	  and often the rotation transition coming back from blanking
	  does not appear.

	* src/home/hd-render-manager.c: Now treat applet zoom amount as a 
	  separate value, and add that to transitions.ini.
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-grid.c
	* src/launcher/hd-launcher-grid.h: Moved 'depth' parameters for the
	  launcher transitions into transitions.ini
	* data/transitions.ini: Added zoom_applets value, launcher depth 
	  values. Added more comments.

2009-08-05  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.72

2009-08-04  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Optimise Clutter's mutex so that we do the real locking only when
	we have multiple threads using Clutter, i.e. during scanning of
	.desktop files.

	* src/main.c (hd_mutex_enable): New function to toggle mutex
	functionality on/off.
	(hd_mutex_lock, hd_mutex_unlock): Lock/unlock functions for the mutex.
	(hd_mutex_init): Called in startup to override Clutter's default
	locking functions.
	* src/launcher/hd-launcher-tree.c
	(hd_launcher_tree_handle_tree_changed): Activate the mutex before
	going multi threaded.
	(walk_thread_done_idle): Deactivate the mutex.

2009-08-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.71

	Patch from Oliver McFadden to add damage timeouts to transitions.ini
	and to change the rotation angle from 70 to 90.

	* src/util/hd-transition.c (hd_transition_rotating_fsm): Read damage
	timeouts from transitions.ini.
	* data/transitions.ini: Change rotation angle to 90.

2009-07-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Performance improvement.

	* src/util/hd-transition.c (hd_transition_get_keyfile):
	  Don't reload transitions.ini every time we need something
	  but only after it has changed.

2009-07-31  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.70

	* src/util/hd-transition.c: Cut the waiting time between landscape and
	portrait transitions to 40 ms. Shorter time sometimes skips or cuts
	the fade out transition. Fixes: NB#130870

2009-07-30  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.69

2009-07-29  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-home.c (hd_home_desktop_key_press,
		hd_home_desktop_key_release):
	  Some g_debug(), may come handy some time.

2009-07-29  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Applied Gordon's patch for updating blur area on rotation.
	Fixes: NB#125749

	* src/tidy/tidy-blur-group.c:

2009-07-28  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.68

2009-07-28  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-util.c (hd_util_change_screen_orientation):
	  Use XChangeProperty()/XDeleteProperty() to communicate
	  SUPPRESS_ROOT_RECONFIGURATION to the X server rather than
	  setting and clearing the property.  Requires newer libmatchbox2
	  and Xorg.

2009-07-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.h (STATE_DISCARD_PREVIEW_NOTE):
	  Don't show notification previews in launcher view.

2009-07-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* data/transitions.ini
	* src/util/hd-transition.c (on_notification_timeline_new_frame):
	  Reworked the closing part of the notification preview transition
	  to be cooler (and more comprehensible at the same time).

2009-07-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.67

2009-07-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c:
	  Adding missing <sys/time.h>

2009-07-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-note.c: reverting, it's incomplete (doesn't cover
	dialogs) and it breaks system-modal notes in application view.

2009-07-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Do not restack the parent windows of notes when the notes map.
	Fixes NB#121341.

	* src/mb/hd-note.c:

2009-07-24  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Prevent a race condition when reloading the apps menu.
	Is a solution for: NB#129747

	* src/launcher/hd-launcher.c:

2009-07-24  Gordon Williams <gordon.williams@collabora.co.uk>

	Resolves 129741 - Confirmation note getting closed by tapping on 
	                  status area. 
	Regression caused by 128086's fix. Re-implemented in a better way
	by sending an X event to the existing blocker window.
	* src/util/hd-util.c
	* src/util/hd-util.h: removed hd_util_client_has_blocker
	* src/home/hd-render-manager.c: Now check xwin_modal_blocker to see
	if the window has a blocker, and if so, send a fake button release
	event to it.
	
2009-07-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#103753 Dialpad comes up on when FN and a number key is pressed
		  simultaneously.

	* src/mb/hd-comp-mgr.c
	* src/home/hd-home.c:
	  Track FN-key pressing.

	Make sure to update libmatchbox.

2009-07-23  Gordon Williams <gordon.williams@collabora.co.uk>

	This resolves 127320 - home screen panning gets stuck in middle
	* src/home/hd-home.c: Added lots of debug messages with a DRAG_DEBUG 
	  define. Fixed drag to middle of screen bug by ignoring motion events
	  (which clutter has delayed) after the stylus is released.

2009-07-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-volume-profile.c (hd_volume_profile_init): Add a
	profile_tracker_init() call, makes the notifications work.
	Fixes: NB#129227 

2009-07-23  Gordon Williams <gordon.williams@collabora.co.uk>

	This resolves 129404 - redrawing title bar text too often
	* src/home/hd-title-bar.c: Set visibility detection on individual
	  title bar elements, so that even when status area is being updated,
	  text and buttons can be left unrendered. Also had to explicitly set
	  the group size, as it appeared to be being set to 800x480 at some
	  point.

2009-07-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.66

2009-07-22  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added setting for disabling launch transition for NB#128881.
	Use X-App-Loading-Image=none in desktop file to disable.

	* src/launcher/hd-launcher.c:
	* src/launcher/hd-launcher.h:

2009-07-22  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#121519 - A blank frame like window with out any title is 
	                   shown on the desktop.

	* src/mb/hd-comp-mgr.c: Handling the old leader that has followers
	  become a follower case.

2009-07-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Laszlo Pere for NB#123486.

	* src/home/hd-clutter-cache.c (hd_clutter_cache_get_real_texture):
	Recover from a broken theme by falling back to the default theme.

2009-07-21  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#129084 - Transition from Call UI to Desktop not according to
	                   spec

	* src/home/hd-render-manager.c: Now really leave window actors alone
	  if they are in the middle of a transition.
	* src/home/hd-title-bar.h
	* src/home/hd-title-bar.c	
	* src/home/hd-task-navigator.c: Modified hd_title_bar_create_fake to
	  not take an HdTitleBar as an argument (which was set to NULL?) but
	  to instead take the required width.
	* src/util/hd-transition.c
	* src/util/hd-transition.h: Added hd_transition_close_app_before_rotate
	  which keeps the app visible until the screen rotates. Also tweaked
	  the rotate animation to ensure that home applets weren't shown in the
	  portrait->landscape transition.	                   
	* src/mb/hd-comp-mgr.c: Call hd_transition_close_app_before_rotate when
	  an app closes that will cause the portrait->landscape transition.


	Fixes: NB#127016 - Background shows edges when scaled back to 
	                   full-screen
	* src/tidy/tidy-blur-group.c: If we are zoomed outwards and unblurring,
	  draw the edges by rendering the background 8 times more to mirror it 
	  around the edges. Only happens when unblurring so this is not such a
	  big speed problem. Also fix the vignette effect so it goes completely
	  to the edges of the screen.

	Fixes: NB#126970 - Conversation view opening animation could be better
	* src/home/hd-render-manager.h 	
	* src/home/hd-render-manager.c: added STATE_LOADING_SUBWIN for loading
	  windows over the top of an existing app. This is safer than just
	  disabling restacking during STATE_LOADING. Added STATE_IS_LOADING to
	  provide a nice way of checking for loading screen presence.
	* src/home/hd-title-bar.c
	* src/home/hd-switcher.c: Changes to use STATE_IS_LOADING rather than
	  explicit checks for STATE_LOADING.  
	* src/launcher/hd-launcher.c: Use STATE_LOADING_SUBWIN if we are 
	  triggering a loading screen while showing an application. This allows
	  the previous app to stay shown in the background during the loading
	  animation.
	  
	* src/home/hd-home.c: minor home panning tweaks to make it more
	  responsive.	

2009-07-20  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#128086 - Tapping blurred status area doesn't dismiss dialogs
	* src/util/hd-util.c
	* src/util/hd-util.h: added hd_util_client_has_blocker to return true
	  if a client should have a blocker window behind it. Also minor
	  change to randr code datatype to make Oliver happy.
	* src/home/hd-render-manager.c: Added handler for status area being 
	  clicked to dismiss the topmost window with a blocker (as if the
	  blocker itself were clicked). Ideally the status area would be
	  stacked below the blocker at these times, but unfortunately this 
	  isn't easily possible so instead we use this method (the input 
	  viewport over status area was grabbed previously anyway).

2009-07-20  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.65

	* src/home/hd-home.c (hd_home_constructed): Check gethostname's return
	value.
	* src/launcher/hd-app-mgr.c (hd_app_mgr_check_loadavg): Use signed
	variable for read()'s return value to catch negative values.
	* src/home/hd-task-navigator.c (layout_notwin): Initialise some local
	variables to quiesce Coverity.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Don't check for NULL
	when getting the transient because it makes Coverity complain.
	* src/hildon-desktop-views.schemas: boolean -> bool

	Patch from Artem for NB#126898.

	* src/home/hd-render-manager.c: Ignore animation actors when
	considering visibility and stacking order.

2009-07-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add a GConf setting to disable showing CallUI in portrait.
	Fixes: NB#128657

	* src/hildon-desktop-views.schemas:
	* src/launcher/hd-app-mgr.c: Also re-check conditions when the 1s
	delay has passed.

2009-07-17  Aapo Kojo  <aapo.kojo@nokia.com>

	Release 2.2.64

2009-07-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#128647 Desktop crashed when continuously tap the incoming
		  notification above a system modal dialog

	Maybe he hit it just in wrong time.

	* src/mb/hd-note.h
	* src/mb/hd-note.c (hd_note_clicked):
	  Be more robust and don't act if the client is gone.

2009-07-16  Aapo Kojo  <aapo.kojo@nokia.com>

	Release 2.2.63

2009-07-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-volume-profile.c:
	  Don't use deprecated functions from libprofile-dev.
	* debian/control:
	  Set libprofile-dev version.

2009-07-15  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#120636 [REGU]Phone application is opened in the background
		  if tapped on missed call notification when flash message
		  is displayed

	Make incoming event previews insensitive if there's a sysmodal.

	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_map_notify:
	    let the cmgr decide whether the note is clicked or not
	  hd_comp_mgr_setup_input_viewport:
	    for this grab the input area of incoming event notifs
	    unconditionally
	* src/mb/hd-note.h
	* src/mb/hd-note.c (hd_note_clicked):
	  make the decision here and if there's no sysmodals in sight...
	* src/util/hd-util.h
	* src/util/hd-util.c (hd_util_clicked):
	  ...synthetize a ButtonPress
	* src/home/hd-switcher.c (hd_switcher_notification_clicked):
	  which was factored out from here

2009-07-14  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (NOTE_SEPARATOR_PADDING):
	  Make the separator line in notif thumbnails edge-to-edge.

2009-07-14  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* data/transition.ini:
	  Tuned home::zoom and task_nav::zoom to make Martin happy.

2009-07-13  Laszlo Pere  <lpere@blumsoft.eu>

	* src/mb/hd-comp-mgr.c: A glitch has been fixed by handling the 'old
	  leader become a follower' use case. It fixes the media player first
	  start when the main view was previously shown in the background.

2009-07-10  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: #NB121519 A blank frame like window with out any title is shown
	                 on the desktop.

        * src/mb/hd-comp-mgr.c: Adding the window to the task switcher when 
	it is removed from a stack and it is no more a stacked window.

2009-07-08  Aapo Kojo <aapo.kojo@nokia.com>

	Release 2.2.62

2009-07-08  Laszlo Pere  <lpere@blumsoft.eu>

	NB#125920 [REGF]Device is unlocked without lock code from active call
	          in Layout mode

	* src/home/hd-home.c: Not closing dialogs above the stacking layer 0
	  when going back from layout mode, thus not closing the 'Enter lock
	  code' dialog.

2009-07-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#121351 task switcher maximises applications instead of just panning

	* src/home/hd-task-navigator.c (within_grid):
	  we calculated the top of the grid incorrectly, didn't take
	  panning into account

2009-07-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#125361 Incoming call Dialog:Reject Button is Not shown
		  in certain scenario

	* src/home/hd-task-navigator.c (hd_task_navigator_replace_window):
	  Remember the replaced windows, grab them and hide them when the
	  navigator is activated...
	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  ...so hdrm needn't worry about hiding them itself.

	The problem was that when the incoming call dialog was mapped and
	hdrm sorted out the visibilities, it decided to hide the dialog,
	because we were in tasw view.  Since the dialog was hidden,
	the hd_comp_mgr_should_be_in_portrait() ignored it.

	The problem wouldn't have been apparent with non-fullscreen dialogs
	or with normal application windows.  Only the damned incoming call
	dialog.

2009-07-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#126456 launcher transitions are not fast enough.

	* data/transitions.ini:
	  launcher_in -> 500ms, launcher_in_sub -> 500ms
	  Requested by the ***************** product management.
	  (no offense)

2009-07-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h:
	  Moved the SUPPRESS_ROOT_RECONFIG atom to libmb.
	* src/util/hd-util.c:
	  Updated for that.

	This requires new libmatchbox binary & headers.

2009-07-02  Aapo Kojo <aapo.kojo@nokia.com>

	Release 2.2.61

2009-07-02  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Reinstated maemo-launcher support, this time with the correct exports so that
	the a11y module can be loaded.
	Fixes: NB#101031

	* debian/rules:
	* src/Makefile.am:
	* src/export.map:

2009-07-01  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#121519 - A blank frame like windows is shown on the desktop
	                   (Turns out there were 2 bugs)
	* src/home/hd-render-manager.c: Ensure that calling set_loading_image
	  twice will not leave an otherwise unreferenced actor on the
	  stage. Minor refactoring to avoid code duplication.

	Fixes: NB#121519 - A blank frame like windows is shown on the desktop
	* src/home/hd-render-manager.c: Now only reparent to home if an actor
	  had a parent previously. If it didn't, it was almost certainly left
	  over after the MBWMCompMgrClutterClient was destroyed.

	More tweaks for MartinG
	* data/transitions.ini: Zoom the background less
	* src/launcher/hd-launcher-grid.c: Zoom out icons on the subview the
	  same amount as for the main view.	

2009-07-01  Aapo Kojo <aapo.kojo@nokia.com>

	Release 2.2.60

2009-07-01  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* debian/rules:
	  Disabled --enable-launcher until we sort out what to do with hail.
	* src/Makefile.am:
	  Reverted $(UNWANTED) filtering.
	  Clearly nobody understands what's libtool doing.

2009-07-01  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home.c: Fix minor bug that meant home panning wasn't
	  as responsive as it should have been.

2009-07-01  Aapo Kojo <aapo.kojo@nokia.com>

	Add maemo-launcher build dependency
	* debian/control:

2009-06-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add maemo-launcher support and exports map. Initial patch by Dafydd Harries.
	Fixes: NB#101031

	* configure.ac:
	* debian/hildon-desktop.launcher:
	* debian/rules:
	* src/Makefile.am:
	* src/export.map:

2009-06-30  Gordon Williams <gordon.williams@collabora.co.uk>

	Speed improvements for TidyFingerScroll
	* src/tidy/tidy-finger-scroll.c: use clutter_set_motion_events_enabled
	  to stop clutter redrawing the screen for picking after every motion
	  event. This really improves launcher subview scrolling performance.

2009-06-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#125534 No 'X' button to close the application

	* src/mb/hd-app.c (hd_app_request_geometry):
	  Do not discard the geometry request if the client is just
	  being mapped as then its frame window creation may silently
	  fail, causing all sort of funny effects.

2009-06-30  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/data/transitions.ini: Made task launcher initial transitions
	  1/3rd slower.

	Fixes: NB#106433 - Detect XVideo Overlays and don't blur if so

	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h: added _OMAP_VIDEO_OVERLAY atom
	* src/util/hd-util.c
	* src/util/hd-util.h: added hd_util_client_has_video_overlay	
	* src/tidy/tidy-blur-group.c
	* src/tidy/tidy-blur-group.h: added tidy_blur_group_set_chequer to
	  allow us to put a black chequer pattern over everything in the 
	  blur group.
	* src/home/hd-render-manager.c: If we are about to blur a window,
	  check that what we are blurring doesn't have a video overlay. If
	  so, use tidy_blur_group_set_chequer to use a chequer pattern for
	  dimming.

2009-06-30  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#125453 - Unable to add more than 3 shortcuts on a row
	Fixes: NB#124885 - Merged contact's  shortcut avatar is not
	proper(i.e. overlapped)
	Fixes: NB#112246 - Hildon status menu disappearing while sharing
	images using BT

	* src/home/hd-home-view-layout.c (PADDING): Decrease the padding
	slightly so 4 bookmark shotcuts fit a row.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Do not close status
	menu if an override-redirect window is mapped.

	* debian/changelog: update.

2009-06-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Increased minimum loadavg for prestarting to 1.0.
	Fixes: NB#125697

	* src/launcher/hd-app-mgr.c:

2009-06-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Moved loading_image to blur_front so that power key menu appears on top.
	Fixes: NB#123990

	* src/home/hd-render-manager.c:

2009-06-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#121704 ss application menu displayed on top of "select connection "
		  dialog then disappeared after sometime

	Delete GtkMenu:s as well as HildonAppMenu:s.

	* src/mb/hd-atoms.h
	* src/mb/hd-atoms.c:
	  Added _GTK_DELETE_TEMPORARIES for GtkMenu:s.
	* src/mb/hd-wm.h
	* src/mb/hd-wm.c (hd_wm_delete_temporaries):
	  Factored out of hd-dialog.c and enhanved with legacy menu deletion.
	* src/mb/hd-dialog.c:
	  Use it.

2009-06-30  Laszlo Pere  <lpere@blumsoft.eu>

	NB#125137: Highlight stays on widget in some cases.
	NB#109932: Panning over widgets.

	* src/home/hd-home.c: Modified the signal handling logic to fix the 
	  bug.
	* src/home/hd-home.c: Sending an enter event before the button press
	  event so that the GtkButtons inside the applets will work again.

2009-06-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#121351 task switcher maximises applications instead of just panning
	NB#125263 Icons in task switcher are not responsive enough, need to
		  tap them more than once to activate them

	Tune the responsiveness.

	* src/home/hd-scrollable-group.c (hd_scrollable_group_is_scrolled):
	  Consider the position of the viewport, not the mouse coordinates.
	* src/home/hd-task-navigator.c:
	  Generic filter for non-clicks.
	  Consider also the press and release widget when deciding about
	  clicking.

2009-06-29  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Applied Mox's patch to add a 1s delay before launching CallUI.
	Fixes: NB#124321

	* src/launcher/hd-app-mgr.c:

2009-06-26  Laszlo Pere  <lpere@blumsoft.eu>

	NB#124242: Can not select any option in the 'device swicth" dialog 
	           when new hildon meny is displayed on application and tapped 

	* src/mb/hd-app-menu.c: Closing all the menus when a new menu is
	  initialized. The same as found in the hd-app.c

2009-06-29  Aapo Kojo <aapo.kojo@nokia.com>

	Release 2.2.59

2009-06-26  Gordon Williams <gordon.williams@collabora.co.uk>

	Some good performance improvements from reducing the amount of
	times blurring is recalculated. Also fixes NB#123272, NB#124708
	(Wrong background is blurred) - hopefully pending S3 status

	* src/home/hd-render-manager.c: Ensure that set_blur sets the values
	  correctly for the very next frame. Also set whether to blur a bit
	  more carefully.
	* src/tidy/tidy-blur-group.c: Get rid of slight artefacts on vignette
	  effect. Fix problem with needless redraw at the end of the blur,
	  and only do one redraw per frame (as it looks like we may have an SGX
	  bug).
	  
	* src/home/hd-home.c: Get rid of the small 'jump' as the user drags
	  mode than HDH_PAN_THRESHOLD	  

2009-06-26  Laszlo Pere  <lpere@blumsoft.eu>

	NB#119136: Memory leaks found while traversing from main view ti sub 
	           view in task launcher.

	* src/launcher/hd-launcher-tree.c, src/tidy/tidy-style.c, 
	  src/tidy/tidy-scroll-view.c: Memory leaks has been fixed.

2009-06-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Laszlo Pere for NB#121902.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_handle_stackable): Do not get
	confused by stackable windows that are in the stack but have not
	received MapNotify yet. Uses new API from libmatchbox2.
	Fixes: NB#121902

2009-06-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Better fix for NB#120368 and unbreaks banners not shown in fullscreen.

	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  Don't play hiding game with ->front, but...
	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler):
	  ...listen to MCE to know when the tklock is active ...
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  ...and discard the preview if it is.
	* src/mb/hd-comp-mgr.h

2009-06-26  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-util.c: Modifications for 122222 to use XA_CARDINAL,32
	  for _MAEMO_SUPPRESS_ROOT_RECONFIGURATION property

2009-06-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#118959 Task Switcher thumbnails not scaled when entering
		  task switcher from the desktop 

	Zoom the tasw when entering from/leaving for home.

	* data/transitions.ini (task_nav):
	  Added "zoom_for_home".
	* src/home/hd-render-manager.c:
	  hd_render_manager_set_blur():
	    Recognize HDRM_ZOOM_FOR_HOME to zoom task_nav by that much.
	  hd_render_manager_sync_clutter_before():
	    Use the flag when going HDRM_STATE_HOME.

2009-06-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Mox Soini for NB#124643.

	* src/main.c (take_screenshot): New function to save a screen shot.
	(key_binding_func): Add enum for screen shot shortcut.
	(main): shift+ctrl+p takes a screen shot.

2009-06-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_set_state):
	  Discard notification previews if we're going to
	  STATE_DISCARD_PREVIEW_NOTE().
	* src/util/hd-util.c (hd_util_client_has_modal_blocker):
	  Don't consider notification previews modal blockers.
	  This allow the tasks button not to be blocked while
	  they're showing.

	* src/mb/hd-note.c (hd_note_init)
	* src/util/hd-transition.c (on_notification_timeline_new_frame)

	Place notification preview windows where they're supposed to be
	ie. right to the tasks button.

2009-06-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/a11y/home/hda-home.c (_hda_home_next_home_action,
	_hda_home_previous_home_action): Add 0 argument as velocity for
	hd_home_view_container_scroll_to_next/previous to fix compilation.

2009-06-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (calc_layout):
	  If we have >12 thumbnails position the grid so that the titles of
	  the fourth row can be seen clearly.

	* src/tidy/tidy-scroll-view.c (tidy_scroll_view_init):
	  Force transparent background on the indicators.
	  Maybe it could have been done more elegantly.

	* src/home/hd-task-navigator.c (layout_notwin):
	  Show only the first 3-2 lines of the secondary text.

2009-06-24  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes NB#122222 - X sends a large number of unnecessary Expose events 
	                  on screen rotation to all applications
	* src/mb/hd-atoms.h
	* src/mb/hd-atoms.c: Added _MAEMO_SUPPRESS_ROOT_RECONFIGURATION atom
	* src/util/hd-util.c: Set atom above to 1 around the XRandR calls to 
	  allow fbdev to supress the extra redraw that happens on windows 
	  when rotating the screen.

	* src/home/hd-home.c
	* src/home/hd-home-view-container.c: Misc tweaks to home panning

	Home view kinetic panning

	* src/home/hd-home-view.c
	* src/home/hd-home-view-container.c
	* src/home/hd-home-view-container.h: Added velocity parameter to 
	  _scroll functions, and made them pay attention to it.
	* src/home/hd-home.c: Store the last few mouse drag events and use
	  them to work out an average finger velocity.	
	* data/transitions.ini: Slowed down launcher subview showing transition
	  at MartinG's request

2009-06-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Laszlo Pere for NB#117797.

	* src/home/hd-switcher.c (hd_switcher_waking_fail,
	hd_switcher_wakeup_timeout, hd_switcher_render_manager_notify_state):
	New functions to detect an application that fails to wake up from its
	hibernation.
	(hd_switcher_zoom_in_complete): Set up a timeout before waking up the
	application.

	Release 2.2.58

2009-06-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#124405 New contact dialog appears in portrait mode.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  After hdrm_restack() decide about portraitification.

2009-06-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (layout_notwin):
	  Make sure no line fragments are drawn in midsized notif thumbnails.

2009-06-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-title-bar.c (hd_title_bar_set_for_edit_mode): Set title
	after setting the state, not before.  Fixes: NB#124294

2009-06-24  Laszlo Pere  <lpere@blumsoft.eu>

	NB#117318: Able to pan between home views in layout mode.

	* src/mb/hd-app-menu.[ch]: Added a modal blocker window to the
	  HildonAppmenu class. The grab can be removed from the 
	  hildon-app-menu.c of the Hildon1 library.

2009-06-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Laszlo Pere for NB#109932.

	* src/home/hd-home.c (hd_home_desktop_do_motion,
	hd_home_desktop_do_release, hd_home_applet_emit_button_release_event, 
	hd_home_applet_emit_button_press_event): Allow starting of Home panning
	on top of applets as well and synthesize input events to the applets
	when needed.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_setup_input_viewport): Catch input
	events for Home applet windows.

2009-06-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.57

	Really fix NB#122719 now.

	* src/home/hd-render-manager.[ch]
	(hd_render_manager_get_status_area_client): New function to access the
	status area client.
	* src/home/hd-title-bar.c (status_area_is_visible): Check coordinates
	of the SA client, not the Clutter client because it might not be
	updated yet.

2009-06-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#124133 No potrait mode when there is an incoming event preview
		  in switcher view.

	Naturally, if the poor, otherwise useless client is standing on the
	top of the window stack.

	* src/mb/hd-note.c:
	  Override MBWMClientDialog::stacking_layer() for incoming event
	  notifs.

2009-06-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.c
	(hd_render_manager_sync_clutter_before): Don't call hd_title_bar_update
	after hd_render_manager_place_titlebar_elements has already done it.

	Release 2.2.56

2009-06-22  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	NB#122710 Weird screen appearing after closing the camera application
	
	* src/home/hd-home.c: We should set WM_CLIENT_MACHINE and _NET_WM_PID
	on the desktop window.

2009-06-22  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	NB#121966 Banners displayed even when Do not Disturb flag is enabled.

	* src/mb/hd-comp-mgr.c: Banner notes are only discarded during DND
	if either they don't have a parent window or their parent window
	is not uppermost.  (The previous code checked whether the banner
	itself was uppermost.)

2009-06-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	  Make scroll indicators MLG 2.3 compilant.

	* src/tidy/tidy-scroll-view.c:
	  Set default indicator width/height 8 pixels.
	  Set a 8 pixel right-padding by default.

2009-06-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	  Clean up the mess.

	* src/mb/hd-note.c (hd_note_init):
	  Rather than stacking low move HdNoteIncomingEvent:s off the screen.

2009-06-22  Gordon Williams <gordon.williams@collabora.co.uk>

	* tests/Makefile.am
	* tests/test-large-note.c (Added): Test for NB#117673
	* src/mb/hd-comp-mgr.c: Remove old fix for NB#117673 as it breaks
	                        stacking.
	* src/home/hd-render-manager.c: New fix for NB#117673, which fixes
	  other bug where any fullscreen window of a type not covered in 
	  update_blur_state would be blurred regardless of whether it
	  should have been or not.

2009-06-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-note.c (hd_note_stacking_layer): Revert Thomas' fix using
	Hildon stacking layers. Reopens NB#115408.

2009-06-22  Gordon Williams <gordon.williams@collabora.co.uk>

	Hildon Desktop part of fix for NB#123285 - No window animation for
	                                           SMS Conversation View
	* tests/test-app-launch.c (Added)
	* tests/Makefile.am: Test app to show how to use launch animation                                          
	* src/launcher/hd-launcher.c: Allowed launch anim to work without
	  a service specified.
	* src/mb/hd-comp-mgr.c
	* src/mb/hd-comp-mgr.h: Store the time that the last window was mapped, 
	  and provide hd_comp_mgr_time_since_last_map to access it.	  
	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h: Provide _allow_dbus_launch_transition
	  (which looks to see if it is likely that a window has been mapped 
	  before its 'launch' dbus message arrives).
	* src/launcher/hd-app-mgr.c: If hd_app_mgr_dbus_launch_app is called
	  without an argument, assume that just the launch transition is
	  required.

	NB#122210 - ROTATION:Screen corruption with horizontal lines
	
	* src/util/hd-util.c: Added call to glFinish to wait until OpenGL
	  has finished drawing before calling randr for screen rotate.

2009-06-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (navigator_shown):
	  Flash the scrollbar when entering.

2009-06-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Unzoom the background when zooming in in switcher view.

	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c:
	  Added hd_render_manager_unzoom_background() just for that.
	* src/home/hd-task-navigator.c (hd_task_navigator_zoom_in):
	  Use it.

2009-06-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#123736 Window thumbnail shows hidden part of the window

	* src/home/hd-task-navigator.c (create_appthumb):
	  Clip.  Necessary because of the animation actors
	  because they are not regulated by the cmgr.
	* src/mb/hd-comp-mgr.c (dump_clutter_actor_tree):
	  Print the actors anchor point as well.

2009-06-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#120267

	* src/mb/hd-wm.c (hd_wm_client_activate):
	  Junk to avoid a warning.

2009-06-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.55

2009-06-21  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	NB#115408 Cannot snooze/stop an alarm playing over 'Switch off
	device?' confirmation note

	* src/mb/hd-note.c: Certain kinds of notes are put into the front
	group by hd_comp_mgr_map_notify().  It is possible (by manipulating
	a window's Hildon layer) to put a note below another window in the
	X stacking order, whereupon it will be shown on top anyway because
	it's in the front group.  So for these kinds of notes, stack them
	on top in the X stacking order as well.

2009-06-19  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#122091 - Wrong color in layout mode when moving widgets from
	one desktop to another

	* src/home/hd-home.c (hd_home_constructed, hd_home_remove_dialogs,
	  hd_home_theme_changed): 
	* src/home/hd-home.h: Add hd_home_theme_changed method to update edge
	color.

	* src/mb/hd-theme.c (hd_theme_init): Call hd_home_theme_changed when
	the theme is changed.

	* debian/changelog: update.

2009-06-19  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#120171 - Part of all contacts view is shown in background of
	                   switcher view in a mentioned scenario.

	* src/util/hd-transition.c
	* src/util/hd-transition.h: Added hd_transition_stop to stop subview
	  transitions immediately and place windows correctly at their 
	  endpoints.
	* src/home/hd-render-manager.c: Call hd_transition_stop on active 
	  client before entering the task nav. The task nav doesn't handle
	  subview sliding properly (It only grabs the frontmost win, and also
	  it doesn't clip now for performance reasons). 

2009-06-19  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-util.c
	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h: Applied Daniel Stone's patch to use RandR 1.3
	  for screen rotation.

2009-06-19  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Allow scrolling in rows between launcher icons.
	Fixes: NB#121814

	* src/launcher/hd-launcher-grid.c:

2009-06-18  Gordon Williams <gordon.williams@collabora.co.uk>

	NB#122051 - Touch screen unlocking view is blurred in layout mode

	* src/home/hd-render-manager.c: Now restack after changing state to
	  HOME_EDIT_DLG - this forces blur state to be set correctly for the
	  fullscreen unlock dialog.

2009-06-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-status-area.c (hd_status_area_class_type):
	  Inherit from the base client rather than Note.
	  This is to avoid dialogs' (dialogues') smart stacking
	  which would override ours errornously.  And makes
	  the status area clickable again.

2009-06-18  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Avoid closing transition only if app is really hibernating.

	* src/mb/hd-comp-mgr.c:

2009-06-18  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add oom_adj option to dsmetool invocation.
	Fixes: NB#87433

	* debian/hildon-desktop.xsession:

2009-06-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fix couple of Coverity issues.
	* src/launcher/hd-launcher.c (hd_launcher_transition_app_start): Bail
	out if NULL is passed.
	* src/home/hd-render-manager.c (hd_render_manager_restack): Initialise
	'geo' before using it.

2009-06-18  Gordon Williams <gordon.williams@collabora.co.uk>

	Work towards fixing NB#122051 (Touch screen unlocking view is blurred
	in layout mode) - Now works fine apart from first attempt.
	
	* src/home/hd-render-manager.c: Use HDRM_BLUR_BACKGROUND for
	  STATE_HOME_EDIT_DLG, as HDRM_BLUR_BACKGROUND is overridden by
	  hdrm_update_blur_state and this allows full-screen dialogs to be
	  displayed correctly if mapped while in HOME_EDIT_DLG state.

2009-06-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c
	* data/transitions.ini:
	  Read ZOOM_EFFECT_DURATION and FLY_EFFECT_DURATION from
	  transitions.ini.  Once.  At startup.

2009-06-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (hd_task_navigator_zoom_out):
	  Hide the prison at the end if the application had a notification.

2009-06-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (on_notification_timeline_new_frame):
	  Fly to the right of the tasks button rather than covering it.

2009-06-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#120368 Notification displayed top of touch screen unlocking view

	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  Hide/show the front group together with blur_front when we sense
	  fullscreens or not.  This is to hide the notification previews
	  which sit in the front group.

2009-06-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_dump_debug_info):
	  Print information about HildonWindowStack:s.

2009-06-17  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	NB#119560 Hiding a window affects the visibility of
	other transient windows

	* src/mb/hd-comp-mgr.c: If we are leaving app mode, and there are
	modal blockers, don't go to the switcher.  Go to the desktop,
	instead.

2009-06-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-util.c (hd_util_modal_blocker_realize): Add argument for
	saying that only ping is desired, not delete event.
	* src/mb/hd-note.c: Create modal blocker for confirmation notes, too,
	but do not delete them, just ping them to detect a jammed application.
	Fixes: NB#112165

2009-06-17  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#120157 - applets on the deactivated home are some times
	appearing on the present active home for a small instance of time.

	* src/home/hd-home-view.c (close_applet): Hide clutter actor when
	closing.

2009-06-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#122941 App window need information about state when it is visible
		  in task-switcher and not visible at all

	* src/home/hd-render-manager.c (hd_rener_manager_set_state):
	  Change _MB_WM_CURRENT_APP_WIN such that 0xFFFFFFFF indicates
	  we're in tasw.

2009-06-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Improved waking up hibernated apps, for NB#121512.

	* src/home/hd-switcher.c: If still loading, go to switcher or home when	the
	loading fail appears.
	* src/launcher/hd-app-mgr.c:
	  - Time waking up, send loading-fail if app doesn't appear.
	  - Retry waking up if app closes after trying to wake up, in case the user
	  switches back to it really fast.
	  - Listen to d-bus name changes for loading and waking apps (thanks, Adam!).
	* src/launcher/hd-running-app.c:
	* src/launcher/hd-running-app.h: New state HD_APP_STATE_WAKING.
	* src/mb/hd-comp-mgr.c:

2009-06-17  Laszlo Pere  <lpere@blumsoft.eu>

	NB#114610: ROTATION: Misplaced status area separator in portrait mode.

	* src/home/hd-title-bar.c: Fixed separator placement.

2009-06-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#123246 hildon-desktop crashed.

	(crash != abort)

	* src/mb/hd-note.c:
	  mb_wm_util_trap_x_errors()

2009-06-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator (hd_task_navigator_zoom_in):
	  Handle the situation gracefully and keep the targetting the window
	  if it happens to move away while we're zooming, for example because
	  a thumbnail was added or removed during the animation.

2009-06-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Move SA
	offscreen when going to the non-composited mode. Fixes: NB#123112.

	* src/home/hd-title-bar.c (status_area_is_visible): Check x coordinate
	as well (SA is moved offscreen in x-axis). Fixes: NB#122719.

2009-06-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#121351 task switcher maximises applications instead of just panning

	Take UX Guidelines seriously.
	Also implrement correct (to specs) panning and dismissal areas.

	* src/tidy/tidy-finger-scroll.c:
	  Make the capture callback a class signal handler in order
	  to be overridable somehow.
	* src/home/hd-scrollable-group.c (hd_scrollable_group_is_clicked):
	  Allow max. 15 pixels of drift and also consider the time.
	* src/home/hd-task-navigator.c

2009-06-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/main.c: Remove old keyboard shortcuts and add ctrl+backspace
	and shift+ctrl+n shortcuts. These require a recent libmatchbox2 to
	work.

2009-06-16  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#117748 - Transition while switching to and from portrait mode
	                   is not proper (dial pad)
	* src/util/hd-transition.c
	* src/util/hd-transition.h: Added hd_transition_rotate_ignore_damage,
	  which returns whether or not the compositor should ignore damage
	  events (because the screen is blanked). Use calls to this to
	  prolong the time we spend in the blanking state.
	* src/mb/hd-comp-mgr.c: consult hd_transition_rotate_ignore_damage
	  before we queue a redraw for the screen.
	* data/transitions.ini: removed duration_blanking item as it is no
	  longer required

2009-06-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added missing D-Bus signal matches for lock and screen status.
	For: NB#122221

	* src/launcher/hd-app-mgr.c:

2009-06-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.54

2009-06-15  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Avoid resizing the textures used for
	  blurring and instead rotate the image by 90 degrees if the aspect
	  ratio is wrong. This saves us vital time in the middle of a rotate
	  transition. Done to help with NB#117748.

2009-06-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Avoid crash in
	case of weird internal inconsistency. Fixes: NB#122802

2009-06-15  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#119149 - Title graphics should not be scaled

	* src/tidy/tidy-sub-texture.c
	* src/tidy/tidy-sub-texture.h: Added tidy_sub_texture_set_tiled and
	  relevant code to tile the image in GLES.
	* src/home/hd-clutter-cache.c: Set textures to be tiled when they
	  would previously have been stretched.
	* src/home/hd-title-bar.c: Now ensure that we use a tidy_sub_texture
	  for the title bar background, and make sure that when it is 
	  stretched it tiles the image.

2009-06-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* tests/test-speed.c: Make window property setting functions more
	suitable as example for Rovio guys.

	Release 2.2.53

2009-06-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Notification visualisation update.  Needs new graphics.

	* src/home/hd-task-navigator.c:
	  Also don't show the close button if the application still
	  has a dialog (and cannot be closed).
	* debian/control: updated Depends: on hildon-theme-devel.

2009-06-12  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#119406 - blurring not working when camera brought to top
	                   using button.
	General attempt to clean up the stacking/update_blur code a little.

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h: Make hdrm_update_blur_state static,
	  and call it on restack (when window order has changed). update_blur
	  has no need for sync_stacking any more, as we make sure we stack
	  when the window order changes. Also remove 'ignore' parameter from
	  update_blur as there is no need for it now.
	* src/util/hd-transition.c: call hdrm_restack rather than update_blur
	  explicitly.
	* src/mb/hd-comp-mgr.c: Remove calls to update_blur_state, and
	  instead call restack after mbwmcmc_map_notify (which adds a new
	  clutter actor which required a restack).

	* src/tidy/tidy-blur-group.c: Fix annoying low-quality flicker that
	sometimes happens at the end of blurring. Slight speed increase too.

2009-06-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Show empty categories in task launcher.
	Fixes: NB#121803

	* src/launcher/hd-launcher-tree.c:

2009-06-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-cached-group.c: Tweaks to improve cached-group 
	performance. Not used currently, but may well be used in
	rotation transition.

2009-06-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Put confirmation note
	to the front group. Fixes: NB#117673

2009-06-11  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Order applications by ctime if not hard-coded in position.
	Fixes: NB#116215

	* src/launcher/hd-launcher-item.c: Added more hard-coded apps.
	* src/launcher/hd-launcher-item.h:
	* src/launcher/hd-launcher-tree.c:

2009-06-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (turnoff_fun, turnoff_effect_frame):
	  Streamlined with the other effect (again).

2009-06-11  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-dbus.c (hd_dbus_prevent_display_blanking): New function
	to send display blanking prevention message to MCE.
	(hd_dbus_disable_display_blanking): New function to switch display
	blanking prevention on/off.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_check_do_not_disturb_flag): Call
	hd_dbus_disable_display_blanking when we are in DnD mode.
	Fixes: NB#118192

2009-06-11  Laszlo Pere  <lpere@blumsoft.eu>

	* src/mb/hd-animation-actor.c: Fixed GLib warnings.

2009-06-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#120847 Text of time in notification goes out of box window
	NB#121060 Indication is done on top of Tasks button, with an
		  animation and highlight for every one min even when
		  there is no new event.
	NB#121584 Missed call notification text comes outside of the window
	(and NB#120626 Number of notifications is not coming in task
	 switcher but that's not complete)

	Bring ourselfves closed to tana lagu 2.3.

	* src/home/hd-task-navigator.c:
	  * layout_notwin(): implemented the new layout
	  * check_and_resize(): we couldn't cancel an already running effect
	  * FLY_EFFECT_DURATION, ZOOM_EFFECT_DURATION: changed to 250ms
	* src/util/hd-gtk-style.c (hd_gtk_style_resolve_logical_color):
	  Return white for unknown colors, much more readable.
	* src/mb/hd-atoms.h
	* src/mb/hd-atoms.c
	* src/mb/hd-note.h
	* src/mb/hd-note.c: Make _HILDON_INCOMING_EVENT_NOTIFICATION_AMOUNT
	  accessible.
	* TODO: new TODOs

2009-06-11  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-volume-profile.[ch]: Add hd_volume_profile_set_silent.
	* src/util/hd-dbus.c (hd_dbus_system_bus_signal_handler): New function
	to catch signals on the D-Bus system bus. Sends TERM to applications
	and exits hildon-desktop when receiving shutdown_ind from DSME.
	(hd_dbus_init): Start listening to DSME signals.

2009-06-11  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Another set of changes to prestarting:
	- Check loadavg before prestarting.
	- Ensure apps are prestarted sequentally.
	Hopefully this Fixes: NB#100819

	* src/launcher/hd-app-mgr.c:
	hd_app_mgr_init: Start a timeout in case init_done is never received.
	hd_app_mgr_prestart: Disable prestarting while we wait for an app to
	  prestart.
	hd_app_mgr_can_prestart: Check loadavg is low (<= 0.50) before
	prestarting.
	hd_app_mgr_dbus_app_died: Don't report crashes of unknown apps.

2009-06-09  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Retry waking up hibernated apps if not shown in 10s.
	Fixes: NB#121512

	* src/launcher/hd-app-mgr.c: Separated part of hd_app_mgr_launch into
	a new method hd_app_mgr_activate for when we already have the
	HdRunningApp.
	Don't immediately close apps when killing them, wait for their dbus
	service or windows to close.
	* src/launcher/hd-app-mgr.h:
	* src/mb/hd-comp-mgr.c: Use the new hd_app_mgr_activate when waking up
	apps so it will be retried if failed.

2009-06-09  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-cached-group.h: Fixed copy/paste #define bug

2009-06-09  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	When an app is marked hibernatable, check if we need to bgkill it
	immediately.
	Fixes: NB#121487

	* src/launcher/hd-app-mgr.c:

2009-06-09  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: regression fix for recent changes - 
	  ensure that open app -> close app doesn't hide the applets, by
	  making sure that even if we don't have to animate the values,
	  we still make sure that actors are set correctly.

2009-06-09  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#121066 Even when conversation window of a particular contact is open,
		  a separate notification is shown in switcher

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_property_changed):
	  Take notice of changes to _HILDON_NOTIFICATION_THREAD
	  and tell tasw about it.
	* src/home/hd-task-navigator.h
	* src/home/hd-task-navigator.c
	(hd_task_navigator_notification_thread_changed):
	  Handle it.
	  Also changed FLY_EFFECT_DURATION to 250 ms.
	* TODO: reality check

2009-06-08  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Remove dithering code from blur class.
	  With clutter >= 0.8.2-0maemo36, blurring is turned on for everything
	  by default - and GLES/SGX does a better job than the pixel shader.

	* src/home/hd-render-manager.c: Ensure that applets fade out, but 
	  don't fade in. Doing fade as well as fade back from blur meant that
	  applets seemed to just be made visible immediately previously.

	General speed optimisation
	* src/home/hd-home-view.c: Ensure that when a home view isn't visible,
	  the container for the applets on it isn't visible either.
	* src/home/hd-home-view-container.c: Ensure that home views that are
	  not onscreen are clutter_actor_hidden.	  

	Fixes: NB#120492 - Unparented animation actors are displayed.
	
	* src/home/hd-render-manager.c: Added hd_render_manager_should_hide
	which checks MBWMCompMgrClutterClientDontShow. This is then used
	when setting visibility of actors.

2009-06-08  Laszlo Pere  <lpere@blumsoft.eu>
	NB#120612 Unwanted activation of the task launcher/switcher button

	* src/home/hd-switcher.c: Handling the 'pressed' state for the button.

2009-06-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.52

2009-06-08  Laszlo Pere  <lpere@blumsoft.eu>

	NB#120955 Memory leaks in window manager.

	* src/launcher/hd-launcher-tree.c: The last leak of the bug report has 
	  been fixed by calling the g_key_file_free() function.

2009-06-05  Laszlo Pere  <lpere@blumsoft.eu>

	NB#119709 Device freezes if camera lens cover is opened while in 
	          change background image dialog

	* src/home/hd-home.c: When removing removing hd-home dialogs remove
	  the transients of the hd-home dialogs too.

2009-06-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#120571 ROTATION: Call idle view is not completely Displayed
		  in certain scenario
	NB#120066 ROTATION: Cannot go back to home view after closing
		  phone application

	When the layout manager requests new geometry in portrait mode
	do not touch clients which don't support it, but reconfigure
	all other.  This way we don't resize clients that needn't be
	but resize the ones that need to be.

	* src/mb/hd-comp-mgr.h (hd_comp_mgr_is_portrait):
	  New utility function.  Oh, sorry, typesafe macro.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_supports_portrait):
	  New utility function.
	* src/util/hd-transition.c:
	  Replace get_current_screen_width/height() with is_portrait().
	* src/mb/hd-app.c (hd_app_request_geometry):
	  Ignore the layout manager's request if we're in portrait
	  but the client doesn't support it.  When we leave portrait
	  it will be reconfigured properly anyway.

2009-06-05  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Clip titlebar's text when showing the progress indicator.
	Fixes: NB#120342

	* src/home/hd-switcher.c:
	* src/home/hd-title-bar.c:
	* src/home/hd-title-bar.h: Set the text and progress indicator in the
	same call, so we can calculate the correct clipping.
	* src/launcher/hd-launcher.c:

2009-06-05  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-home-view.c (hd_home_view_applet_release): Prepare for
	NULL return value from hd_home_view_container_get_next/previous_view.
	Fixes: NB#120248 - observed a hildon-desktop crash. Also, cut some
	overlong lines...

	Fix inline functions to actually be inlined.

	* src/main.c (hd_mb_wm): Global MBWindowManager pointer for the
	inlined functions.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_init): Initialise hd_mb_wm here.
	(hd_comp_mgr_get_current_screen_width,
	hd_comp_mgr_get_current_screen_height,
	hd_comp_mgr_client_is_maximized): Moved to hd-comp-mgr.h.
	* src/mb/Makefile.am: Use libmb.la instead of libmb.a similarly to
	other subdirectories (home, launcher,...).

2009-06-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#116272 ROTATION: Incoming call dialog does not rotate
		  if not on the home view

	Recognize PORTRAIT_MODE_REQUEST=2 as a demand for switching,
	whether other clients are comfortable with it or not.

	* src/home/hd-render-manager.c (hd_render_manager_clip_geo):
	  Respect the screen's right and bottom boundaries as well.
	  Visibility checking after rotation has been broken for a
	  few weeks because now we don't reconfigure windows that
	  are completely covered by other windows.  As a result now
	  we may have 800x480 geometries on a 480x800 screen.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_property_changed,
	    hd_comp_mgr_client_init, hd_comp_mgr_should_be_portrait):
	  Understand REQUEST=2.

2009-06-04  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#120722 - Scaled background image shows dark lines at edges
	* src/tidy/tidy-blur-group.c
	* src/tidy/tidy-cached-group.c: Modified pixel offset for rendering,
	  so bottom/right edges of the background were rendered correctly.

	* src/util/hd-transition.c: Modify timings in app_close transition
	  to allow more time for sparkles, and to shrink their size over
	  time.
	* data/transitions.ini: Increase app_close transition length to
	  include extra time for sparkles

2009-06-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#116566 Device hangs completely after disconnecting call when
		  device lock is active

	Don't go to HDRM_STATE_TASK_NAV if we have modals.

	* src/mb/hd-wm.h
	* src/mb/hd-wm.c (hd_wm_has_modal_blockers):
	  Factored out the code in hd_comp_mgr_setup_input_viewport()
	  to see if we have any modals.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect):
	  Do an ordinary hd_transition_close_app() in this case.
	* src/home/hd-render-manager.c (hd_render_manager_set_state):
	  Don't go to see tasw if we have modals, go to HOME instead.
	* src/util/hd-transition.c (hd_transition_rotate_screen):
	  Don't reset goto_state, it may be set before we're called.

2009-06-04  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home-view-container.c: Moved away from using ClutterUnit
	  (this is removed in Clutter > 0.9), and added code to handle easing
	  on home view panning.

	Fixes: NB#118976 - Transition speed mismatch when dismissing the applications-submenu
	* data/transitions.ini: modified transition durations at Martin 
	  Gimpl's request. Also fixed strange character that was stopping
	  g_key_file reading the [launcher_forward]duration key.
	* src/launcher/hd-launcher-grid.c: Reduce zoom on launcher subview
	  in/out transitions.
	* src/util/hd-transition.c: lowered overshoot on dialog transitions,
	  actually print a warning message if the transitions file couldn't 
	  be loaded. 	  

	* src/mb/hd-comp-mgr.c: Regression fix: it seems since ~W13 we have
	not been updating areas of the screen except for dialogs and full-
	screen windows.

2009-06-03  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Fixes: NB#120044 Top-most application banners are blocked
	with DND flag set
	
	* src/mb/hd-comp-mgr.c: Apps can always show banners if they're
	topmost, even if they have do-not-disturb set.  Also, atoms are
	atoms, not booleans.

2009-06-03  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Use the new HDRM_STATE_LOADING for waking up hibernated apps.
	Fixes: NB#118215

	* src/home/hd-render-manager.c: Keep track of the loading screen parent,
	if present, to return it there later.
	* src/home/hd-switcher.c:
	* src/launcher/hd-launcher.c:

2009-06-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Return
	the g_debug print about state change back. When restarting damage
	tracking, do it from top to down.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Switch to composited
	mode if application, Status Menu, or a dialog appears in non-composited
	mode.
	(hd_comp_mgr_unmap_notify): Switch back to non-composited mode if the
	next window in the stack is non-composited.
	* tests/test-speed.c: Make the window fullscreen in non-composited
	mode.

2009-06-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c (backgrounds_dir_changed):
	* src/home/hd-home-view.c (CACHED_BACKGROUND_IMAGE_FILE_PNG,
	  CACHED_BACKGROUND_IMAGE_FILE_PVR, load_background_idle): Add support
	  for background-[1..4].png cached files.

2009-06-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/launcher/hd-launcher-tile.c (hd_launcher_tile_set_icon_name):
	Free old priv->icon_glow before setting the new one.

2009-06-03  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/Makefile.am
	* src/tidy/tidy-cached-group.c (Added)
	* src/tidy/tidy-cached-group.h (Added): New Clutter group that can 
	  draw its children onto a (currently half-size) texture (for use
	  with hibernated apps).

2009-06-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_play_sound):
	  Carelessness fix: undisable sounds

2009-06-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c: Modified screen rotation transition to
	Martin Gimpl's latest idea.
	* data/transitions.ini: Modified rotation angle for new transition

2009-06-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#17944 Part of thumbnail in switcher view is shown above
		 the task switcher button in the mentioned scenario.

	* src/home/hd-render-manager.c (hd_render_manager_update_blur_state):
	  Patched it not to mess up what sync_clutter_before() did
	  and leave HdTitleBar::foreground in the front in tasw view.

2009-06-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-title-bar.c (hd_title_bar_create_fake):
	  Always create 800-pixel-width fake titlebars.
	* src/mb/hd-wm.c (hd_wm_client_activate): comment

2009-06-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111840 Camera contains two close icons in minimized state
		  in full screen mode
	NB#118305 Application is remains in fullscreen in task switcher area
		  in mentioned scenario

	* src/home/hd-task-navigator.c:
	  Don't treat fullscreen applications any different.
	  Also in preparation for the new UI specs, show the entire
	  notification in place of an application thumbnail.
	  + regression fix: revering Kimmo's changes to always take
	    the LANDSCAPE dimensions of the screen
	  + bugfix: reset the opacity of the fake title bar when zooming out
	  + refactoring: a lot

2009-06-02  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Show CallUI from the desktop when device is rotated to portrait.
	Fixes: NB#119691

	* src/home/hd-render-manager.h: Added STATE_SHOW_CALLUI to mark states
	where CallUI should be shown if rotated.
	* src/launcher/hd-app-mgr.c: Track the necessary MCE signals and GConf
	settings to know when CallUI should be shown.

2009-06-02  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#120118 - Observed GLIB CRITICAL - clutter_actor_destroy
	
	* src/launcher/hd-launcher.c: Replaced clutter_actor_destroy with
	  g_object_ref/unref

2009-06-02  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#119249 - Found hildon desktop crash for missed call alert
	
	* src/util/hd-transition.c: Added g_object_ref/unref for actors used
	  in transitions. Made sure the filler actor in the popup animation 
	  is added *inside* the CompMgrClient's actor, which avoids it getting
	  accidentally freed if actor was started inside a clutter group that
	  is freed during the transition.

2009-06-02  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#119446 - Media player shortcut applet is movable in all
	homes

	* src/home/hd-home.c (hd_home_add_applet): Do not add applets to
	inactive views.

2009-06-02  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#116276 - In the left corner of the title area, there should
	be alayout mode icon.

	* src/home/hd-title-bar.c (BTN_FILENAMES, BTN_LABELS,
	  hd_title_bar_set_for_edit_mode): Use edit icon in layout mode
	  titlebar.

2009-06-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	HD_COMP_MGR_SCREEN_WIDTH/HEIGHT, SCREEN_WIDTH/HEIGHT,
	HD_COMP_MGR_CLIENT_IS_MAXIMIZED are now replaced with honest inlined
	functions.

	* src/launcher/hd-launcher-page.c (hd_launcher_page_finalize): Set
	actors NULL after destroying.
	* src/launcher/hd-launcher.c (hd_launcher_transition_app_start): Set
	actors NULL after destroying.
	* src/home/hd-title-bar.c (hd_title_bar_dispose): Set NULL after
	destroying.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_is_maximized): New function
	to replace HD_COMP_MGR_CLIENT_IS_MAXIMIZED.
	(the_hd_comp_mgr): New static variable for HdCompMgr singleton. Safely
	used from hd_comp_mgr_get_current_screen_width/height because the
	parent is ready before we init HdCompMgr.

2009-06-01  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#119082 - Information notes missing the blur/dim effect

	* src/home/hd-render-manager.c: Added HD_IS_INFO_NOTE to check
	  for whether to blur background or not.

2009-06-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.c (hd_render_manager_set_state): Call
	mb_wm_comp_mgr_clutter_client_track_damage to toggle damage event
	handling on/off when dealing with the non-composited mode.

2009-06-01  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#119381 - Status area to be dimmed when UI dialog shown

	* src/home/hd-title-bar.c: Don't leave space for the status area
	  when in 'foreground' mode, and make sure the foreground group
	  sits below status area when not in foregrounbd mode (so status
	  area is not overlapped when visible)
	* src/home/hd-render-manager.c: Don't add status area to the 
	  'foreground' part of the title bar - as we want it blurred
	  when foreground is visible. Also make sure that VIS_FOREGROUND
	  flag is either set or cleared on state change -> fixes unreliable
	  behaviour.

2009-06-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* tests/test-speed.c: Add support for running the test in the
	non-composited mode.

	Release 2.2.51

2009-05-29  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added a new state, HRDM_STATE_LOADING, showing the loading screen with
	a waiting titlebar.
	Fixes: NB#114248

	* src/home/hd-render-manager.c:
	* src/home/hd-render-manager.h: Added new state and a method to set the
	loading image.
	* src/home/hd-title-bar.c:
	* src/home/hd-title-bar.h: Added methods to allow setting the title and
	the waiting state independently of having a real MBWindowClient.
	* src/launcher/hd-launcher.c:

2009-05-29  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#115969 Task switcher view doesn't respond in a mentioned scenario.

	The input shape remained 480x800.  The changes will make the
	transition from portrait to tasw smoother (looks cooler if
	you slow down the transitions).

	* src/util/hd-util.c:
	  Update the input shape when rotating the screen.
	* src/util/hd-transition.h:
	  New interface to tell the transition FSM to go to the specified state.
	* src/util/hd-transition.c:
	  Moved all rotation-transition-related-things here.  Documentation.
	* src/home/hd-render-manager.c:
	  If we'd go from portrait mode to TASK_NAV state go to HOME first,
	  wait until we fade out then go to tasw.
	* src/home/hd-task-navigator.c:
	  Cosmetics.
	* src/mb/hd-comp-mgr.h
	* src/mb/hd-comp-mgr.c:
	  Refactored hd_comp_mgr_setup_input_viewport() to be usable
	  from hd-util.c.

2009-05-29  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#116375, NB#104558 - multiple clicks before home edit menu 
	appears cause all kinds of problems.
	N.B. This does NOT fix NB#117318, so repeated clicking still causes
	the modal blocker to be removed. I am currently investigating this.
	
	* src/home/hd-render-manager.h	
	* src/home/hd-render-manager.c: Add hd_render_manager_*_input_blocker.
	  This blocks all input to the device temporarily (with a timeout in
	  case).
	* src/home/hd-switcher.c: When launching home edit menu, use
	  hd_render_manager_add_input_blocker to block input until hd-home
	  is able to create its window. Also do the same when an app is
	  launched, to fix the problem with multiple taps on the launcher.
	* src/mb/hd-comp-mgr.c: Remove the input blocker when a window is 
	  mapped.

2009-05-29  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#110737 : hd_home_update_layout warning
	
	* src/home/hd-home.c: Added extra clause to switch statement to cope
	  with the HOME_EDIT_DLG case.

2009-05-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* tests/Makefile.am: Added test-non-compositing.
	* tests/test-non-compositing.c: Fix compilation warnings.

2009-05-28  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Initial non-compositing mode implementation.

	* src/home/hd-render-manager.[ch]: Add new render manager state
	HDRM_STATE_NON_COMPOSITED.
	(hd_render_manager_set_state): Add transition to and from
	HDRM_STATE_NON_COMPOSITED.
	(hd_render_manager_set_visibilities): Shortcut for the mode.
	(hd_render_manager_is_client_visible): Shortcut for the mode.
	* src/mb/hd-wm.c (hd_wm_activate_zoomed_client): Go to the
	non-composited mode if the client requests it with the property.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_setup_input_viewport): Do not
	set the shape of the compositing overlay window if we are in
	non-composited mode.
	(hd_comp_mgr_texture_update_area): Some optimisations and
	simplifications to avoid Gobject type checking.
	(hd_comp_mgr_reset_overlay_shape): New function to shape compositor's
	windows for the non-composited mode.
	(hd_comp_mgr_is_non_composited): New function to check the window
	property _HILDON_NON_COMPOSITED_WINDOW. Caches the value of the
	property after reading it once.
	(hd_comp_mgr_map_notify): Go to HDRM_STATE_NON_COMPOSITED if the
	client requests that.
	* src/mb/hd-atoms.[ch]: Add new atom _HILDON_NON_COMPOSITED_WINDOW.
	* src/mb/hd-app.h: Add members for caching the composited property.
	* tests/test-non-compositing.c: Test program for trying out the
	non-composited mode.

2009-05-28  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#118969 - Background scaling eventually shows background
	borders 
	
	* src/tidy/tidy-blur-group.c: Made sure the tiled vignette stretches
	  correctly to the edges of the screen. Modified dithering parameters
	  to work better when the background is zoomed out fully.
	* tests/test-speed.c: Modifications to render at a solid 25fps to
	  allow system usage to be seen.

	Fixes: NB#117092 - 'Critical' message on screen lock
	
	* src/home/hd-render-manager.c: Removed 'Critical' message when home
	  view was not visible in HOME state. There are a few cases like
	  screensaver mode when this is actually perfectly valid.
	* src/tidy/tidy-blur-group.c: Added simple dithering to blurred image,
	  to try and reduce banding effect. Also revert to RGB565 textures now
	  we are 16 bit as these take up less memory, are faster, and due to 
	  some SGX magic actually look better too.
	* tests/Makefile.am
	* tests/test-speed.c (added): Added very simple gtk test app that
	  renders as fast as it can to the screen.
	* src/mb/hd-theme.c: Now set up TidyStyle to the colours set in the
	  current theme. This makes sure that the scrollbars in Launcher/Task
	  Navigator are the correct colour.

	Fixes: NB#119129 - Memory leaks in hd-clutter-cache

	* src/util/hd-gtk-style.c: Added check for potential segfault if 
	  function is called too early.
	* src/home/hd-clutter-cache.c
	* src/home/hd-title-bar.c: Added call to parent class's dispose 
	  method.

2009-05-27  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#115387 - No initial scrollbar shown in applications menu

	* src/tidy/tidy-finger-scroll.h
	* src/tidy/tidy-finger-scroll.c: added the function
	tidy_finger_scroll_show_scrollbars, which shows scrollbars for a
	second and then fades them away again.
	* src/launcher/hd-launcher-page.c: call the new function
	tidy_finger_scroll_show_scrollbars when the page is shown

2009-05-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#115310 after reading the mail also in task switcher the notification
		  symptoms are showing still

	As a side effect gtk_window_present() will smoothly zoom in
	if called in the switcher view.

	* src/home/hd-task-navigator.c (appthumb_clicked, appthumb_close_clicked):
	  If a thumbnail has a notification behave like one: clear it
	  when the thumbnail is clicked or close it when the thumbnail
	  is closed and DO NOT DO ANYTHING ELSE.  Leave the action up
	  to the notification.  If it decides to top the underlaying
	  application we'll do it, but not on our own.
	  Also ignore concurrent zoom attempts.
	* src/mb/hd-wm.h (hd_wm_activate_zoomed_client):
	  New function for the switcher to use rather than the regular
	  client activation when zooming is done.
	* src/mb/hd-wm.c (hd_wm_client_activate):
	  In switcher view zoom in the client which is to be activated.
	* src/home/hd-switcher.h
	* src/home/hd-switcher.c:
	  Use hd_wm_activate_zoomed_client().

2009-05-27  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-tile.c
	* src/home/hd-home-view.c
	* src/home/hd-title-bar.c: Added explicit enable of visibility 
	detection to clutter actors that require it in readiness for clutter
	0.8.2-0maemo33 which will have detection off by default.
	Note: There may be partial screen updates, in which case it helps to
	have actors with visibility detection even if they may always have 
	been rendered previously.

2009-05-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Redid the keep-thumbnail-titles-up-to-date feature "properly"
	  (for some value of "proper").
	* TODO: updated

2009-05-26  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Fixes: NB#116866 (redux)

	* src/home/hd-render-manager.c: Update blur state if we
	move from the switcher to the app state.
	* src/home/hd-switcher.c: Don't update blur state, because
	that's done by the render manager now.

2009-05-26  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#118521 One hand unlock slider rotates if phone UI is open

	Due to earlier bad experiences we tended to ignore the screensaver
	window, which in this case enabled the call ui to rotate the
	screen.  Since systemui windows seem to behave well now probably
	it's safe not to ignore them anymore.

	* src/home/hd-render-manager.c
	* src/mb/hd-comp-mgr.c
	* src/mb/hd-comp-mgr.h:
	  Removed hd_comp_mgr_is_client_screensaver()
	  and hd_comp_mgr_ignore_window().

2009-05-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.h, src/mb/hd-comp-mgr.c,
	src/home/hd-render-manager.c: Rename STATE_NEED_GRAB to
	STATE_NEED_WHOLE_SCREEN_INPUT to make it more descriptive.

2009-05-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* configure.ac, src/util/Makefile.am, src/util/hd-volume-profile.[ch]:
	New code for tracking device profiles and volume level for system
	sounds.
	* src/util/hd-transition.c (hd_transition_play_sound): Check the
	profile before playing a sound. Remove unneeded 'is_playing' tracking,
	libcanberra handles that for us. Fixes: NB#96619

	* src/mb/hd-wm.c (hd_wm_determine_current_app): Avoid using
	g_return_val_if_fail by using the for loop's condition.

	Release 2.2.50

	Revert Thomas' fix for NB#116866 because it hides Tasks button when
	going from fullscreen to non-fullscreen.

2009-05-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Plug a leak spotted by Valgrind.

	* src/home/hd-task-navigator.c (create_appthumb): Do not connect the
	win_changed callback here because it's now done in reset_thumb_title.
	(free_thumb): Disconnect possible win_changed callback.
	(reset_thumb_title): Reset win_changed callback.

	Patch from Laszlo Pere to fix NB#114750.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Check the
	render manager state when a window is unmapped. If we are in
	STATE_IS_APP() and the current app is the desktop we have to go to
	HDRM_STATE_TASK_NAV.

2009-05-20  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-title-bar.c:  Treat fullscreen windows as though
	they had no decor for the purposes of figuring out button
	visibility.  Also, hide the switcher button if we're dealing
	with an ordinary client (rather than, say, the desktop).
	Fixes NB#116866.

2009-05-20  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#117109 - Contact list background visible in portrait mode

	* src/util/hd-util.c: Update blur state after the screen rotation in
	order to make sure that the windows that were blurred previously are
	still blurred. In this case the background will be white during the 
	screen rotation transition unless clutter >= 0.8.2-0maemo32 is used.
	The new clutter will also fix the white rects during screen rotation
	issue.

2009-05-20  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait): Stop going
	through the stack after a window covering the whole screen was
	encountered. This fixes a bogus rotation from portrait to landscape
	when e.g. Calculator is behind Call UI and you open the dialpad.

2009-05-20  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-title-bar.c: Added a static function to determine
	whether the status area is visible, since it can be hidden in
	many ways.  Partial fix for NB#116866.

2009-05-20  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home-view.c: Modified parallax applet panning method to
	  something that looks a lot better.

2009-05-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.49

2009-05-18  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#103823 - Unable to restore home applets from backup and
	restore application.

	* src/Makefile.am:
	* src/hildon-desktop.prebackup.sh (added): Add prebackup script which
	copies the system plugins config to user config if that not exist yet.

2009-05-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Apply patch from Alejandro Pineiro for NB#110763.
	* src/a11y/hildon-desktop-a11y.c: Load a11y support as modules if
	available.

	* src/mb/hd-app.c (delete_open_menus): New. Close menus when new
	application appears. This is in preparation for fixing NB#116326.

2009-05-15  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#114467 - Not updating titles of minimized applications.
	Fixes: NB#113266 - In the task switcher, name of the application and 
	name of the file is missing in certain scenarios.

	* src/home/hd-task-navigator.c: Connecting to a signal to sense when
	  the window title has been changed.
	* src/home/hd-task-navigator.c: Handling the title markup.

2009-05-14  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Order non-positioned task launcher entries case-insensitively.

	* src/launcher/hd-launcher-tree.c:

2009-05-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Order task launcher entries alphabetically if they don't have a
	position. Fixes: NB#116215

	* src/launcher/hd-launcher-item.c: Add hard-coded positions for default
	apps in 'Applications' subgroup.
	* src/launcher/hd-launcher-tree.c:

2009-05-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* data/transitions.ini: X now blanks for less time so have shortened
	  the blanking time in the transition to the planned 300ms 
	* src/util/hd-transition.h
	* src/util/hd-transition.c: Made functions for animation curves public
	* src/launcher/hd-launcher.c: Now don't use easing in, only ease out
	  when doing launch animation. This makes it smoother given the small
	  time period allowed for it.

2009-05-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-util.c
	* src/util/hd-util.h: Added hd_util_get_cursor_position
	* src/launcher/hd-launcher.c: Now make app loading transition
	  start from last mouse press location (for desktop shortcuts and
	  any app not launched from the launcher).

2009-05-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.c: Removed debug print

2009-05-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* configure.ac: added linking to libhildondesktop (It was already
	  required in debian/control)
	* src/home/hd-home.c: Use libhildondesktop to write application
	  screenshots in PVR format instead of PNG (for faster load times)
	* src/launcher/hd-launcher.c: Switch to loading application screenshots
	  in PVR file format (and clipping them to size if required). Also fix
	  for the application launch animation starting from the location of
	  the previously clicked tile - not the currently clicked one.

2009-05-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c
	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c: Removed un-needed queue_redraw code
	and instead just call clutter directly.		

2009-05-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-grid.h
	* src/launcher/hd-launcher-grid.c: Moved tile vertical spacing const
	  into the header file and made it 32px as per the spec	  

2009-05-11  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.c
	(hd_render_manager_sync_clutter_before): Silence Coverity by replacing
	the switch for visible_top_right with a simpler if clause (without
	non-reachable 'default' branch).

	Release 2.2.48

	* src/util/hd-dbus.c (hd_dbus_init): No need to use g_strdup_printf
	for static strings.

2009-05-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#106183 Desktop shortcut moves place after UI has been rotated

	* src/mb/hd-home-applet.c (hd_home_applet_init):
	  Don't allow libmatchbox' layout manager to reposition applets
	  freely whenever it thinks they should be.  In particular when
	  the root window geometry changes, because it thinks they get
	  out of bound, which is fair but then it cannot place them to
	  their original position.

2009-05-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (hd_task_navigator_remove_window):
	  Don't forget to release_win() if the navigator is not active.
	  This has gained significance since now the dialogs are not
	  automatically destroyed along with the application client,
	  and in this case they must be returned to the render manager.
	  This is related with NB#109299.

2009-05-08  Gordon Williams <gordon.williams@collabora.co.uk>

	Changes to allow applets to fade out nicely on state changes rather
	than just disappearing/reappearing.

	* src/home/hd-render-manager.h: Added STATE_TOOLBAR_FOREGROUND to
	  allow the toolbar to be raised above task nav/launcher and set 
	  applets not to be visible in app mode (so applets do not fade
	  out as task nav zooms out)
	* src/home/hd-render-manager.c: Moved STATE_HOME_FRONT code into
	  sync_clutter_before where other clutter ordering code is. Added
	  extra blur/zoom values for applets. Moved blur_front behind
	  task_nav/launcher in order to stop applets fading out from in
	  front of them.

2009-05-08  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home-view.c: Added non-linear panning of the home view
	  applets relative to the background

2009-05-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/main.c (mbver):
	  Add a static variable saying the accompanying libmatchbox version
	  number that you can grep for in the binary.

2009-05-07  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-tile.c: Remove loading of font from gtkrc
	  and instead use hard-coded (slightly larger) value
	* src/home/hd-title-bar.c: Use "SystemFont" for both title bar and
	  home edit mode titles as per UI spec

2009-05-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-title-bar.c (hd_title_bar_set_window), src/mb/hd-decor.c:
	Do not do Pango ellipsation. Fixes: NB#106496
	(hd_title_bar_get_xy): Provide fallback values in case title bar is
	not in good condition.

2009-05-07  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#112411
	* src/mb/hd-comp-mgr.c: Added check for subview transition when the
	main view hasn't been mapped yet (and explanatory comment)

2009-05-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#107676 Status menu should not turn in portrait mode

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Treat the status menu and power menu clients just like the others,
	  which in practice means admit to the fact that they don't support
	  portrait mode.

2009-05-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/main.c:
	  Adding the '-d' command line switch to get a debug info dump
	  from an an already running window manager.

2009-05-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c
	(hd_render_manager_place_titlebar_elements):
	  Make sure the status area actor is moved when it is supposed to.
	  Fixes the problem when the SA was crammed on the top of the tasks
	  button.

2009-05-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Workaround for 'gadget held portrait, launch calculator case'.
	Workaround for 'have calculator on top and receive a call'.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Take current but invisible clients into account again.
	  Make requesting fullscreen clients override.

2009-05-06  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	NB#111652 legacy widget : application menu is not horizontally
	aligned application title text

	* src/home/hd-render-manager.c:
	* src/home/hd-render-manager.h:
	* src/home/hd-title-bar.c:
	* src/home/hd-title-bar.h:
	* src/mb/hd-theme.c:

	Add get_title_xy functions to various classes to retrieve the
	current position of the window title.

2009-05-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Portrait mode switching improvements.
	Fixes the problem with switching from a portrait-requesting client
	to a non-supporting one caused rotation.
	Fixes the problem with accepting call in portrait mode incoming call
	dialog, which left the call application in landscape.

	* src/mb/hd-wm.c (hd_wm_client_activate):
	  Do the real activation and restacking before changing state.
	  As a side effect it appears to fix with giving momentary focus
	  to clients we're switching away from.  It'll be interesting to
	  see how many other things will it break.
	* src/home/hd-switcher.c (hd_switcher_zoom_in_complete):
	  Don't change state, just rely on client activation.
	* src/util/hd-util.c (hd_util_change_screen_orientation):
	  Make the rotation transition more robust.  Previously if mixed up
	  things when attempted in parallel, now it should recover gracefully
	  and orient the screen to the last requested direction.
	* src/home/hd-render-manager.c (hd_render_manager_set_state):
	  debug print

2009-05-06  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Don't send launcher menu loading finished signal if there's nothing
	to load.
	Fixes: NB#105130

	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher-tree.c:

2009-05-06  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#104959, NB#110247 - Multiple layers of launcher visible
	                              at once

	* src/launcher/hd-launcher.c: Fix for the case where there is no
	active launcher page and we are unable to go back.
	* src/launcher/hd-launcher-page.c: Make sure that if an animation is
	started while another is ongoing, we properly stop the current 
	animation first. This should fix the above bugs, but as there are no
	exact steps to reproduce I am unable to be sure.

2009-05-06  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-title-bar.c: Now make sure all items in the title bar
	  use TitleTextColor (makes sure home edit mode text is the correct
	  Colour)

2009-05-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Regression fix.  Information notes weren't added to the switcher
	  thumbnail.

2009-05-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Learn to deal with entirely missing menus.

	* src/launcher/hd-app-mgr.c:
	  hd_app_mgr_get:
	    bug early if somebody tries to get the appmgr object
	    before it's constructed
	  hd_app_mgr_populate_tree_finished:
	    don't start state checking the empty menu.

2009-05-06  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#113582 - Themed title colours
	* src/home/hd-title-bar.c
	* src/mb/hd-decor.c: Now load title bar colours from GTK, using either
	  default foreground colour, or 'TitleTextColor' for the Title Bar

2009-05-06  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-gtk-style.h
	* src/util/hd-gtk-style.c
	* src/home/hd-task-navigator.c: Refactored code to get colours/fonts
	  from GTK Styles into util/hd-gtk-style.c (so HdTitleBar may use it)

2009-05-06  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c: Fixed minor regression that caused flicker
	  in screen rotation transition.

2009-05-06  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Use libgnome-menu to (re)load task launcher contents.
	Fixes: NB#94416, NB#96458, NB#100815

	* configure.ac:
	* data/Makefile.am:
	* data/desktop/Makefile.am:
	* data/desktop/applications.directory:
	* data/menu/Makefile.am:
	* data/menu/hildon.menu:
	* debian/control:
	* debian/hildon-desktop.install:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher-item.c:
	* src/launcher/hd-launcher-item.h:
	* src/launcher/hd-launcher-tree.c:
	* src/launcher/hd-launcher-tree.h:
	* src/launcher/hd-launcher.c:
	* src/launcher/hd-launcher.h:

2009-05-06  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.47

2009-05-05  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#114409 - Launcher and application view dismissible when
	                   tapped inbetween the icons.
	                   	
	* src/launcher/hd-launcher-grid.c: Add an actor to block clicks
	  between rows of icons

2009-05-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Problem fix: when two browser windows are open (say bookmarks
	and a web page) and you close the web page you end up in app
	view with a ghost window (not) showing.

	This is because the browser maps a window while we're in switcher
	view.  Then we go to app view and while the transition between
	states is still ongoing it destroys that window and set_visibilities()
	cannot restore the visibility of the correct actor because the
	task navigator is still showing.

	* src/mb/hd-wm.c (hd_wm_client_activate):
	  Don't animate TASK_NAV -> APP.  Related to NB#111744.

2009-05-05  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c: Re-enabled sounds as NB#105635 appears to
	  have been fixed now. Added easing to opacity in 'fade' transiton,
	  and modified ramp/easing functions to produce the exact values at
	  endpoints (fix for inaccuracies in PI/sin/cos)
	* src/tidy/tidy-highlight.c: Now use alpha value from the colour,
	  which allows [launcher_glow]brightness to work in transitions.ini
	* data/transitions.ini: MartinG's latest transition values

2009-05-05  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/mb/hd-desktop.c:
	* src/mb/hd-desktop.h: Remove update of theme update related code,
	which sets GConf keys for backgrounds. This is handled in hildon-home
	now.

2009-05-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#114411 Sometimes incoming call dialog not shown while device
		  in potrait mode but can hear the sound. also status menu
		  shown empty when this happens

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Another 1-line-change-15-lines-comment fix.  Don't play the
	  unblurring transition when we try to go to home view from switcher
	  view because a maximized dialog, because set_visibilities()
	  refuses to show these kind of actors as long as the switcher
	  is visible in the background.

2009-05-04  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#113689 - Mouse not working in the fullscreen application in
	the upper left corner.

	* src/mb/hd-render-manager.c: Hiding the task navigator button with the
	  blur_front group.

2009-05-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#112824 Task button and status area disappears in a mentioned scenario.

	* src/home/hd-switcher.c (hd_switcher_relaunch_app_callback):
	  Be prepared for interrupted launcher->switcher blurring transition.

2009-05-04  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.46

	* src/home/hd-home.c (hd_home_add_applet): Do not free 'view_key'
	twice, it makes HD abort. 

2009-05-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111183 Random desktop crash observed from task switcher.

	* src/home/hd-switcher.c (hd_switcher_zoom_in_complete):
	  Handle it gracefully if the zoomed in client has been unmanaged.

2009-05-04  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.45

2009-05-01  Gordon Williams <gordon.williams@collabora.co.uk>

	Fix issue where app(with dialog)->switcher->app->switcher->original
	app would remove blur behind the dialog.

	* src/home/hd-render-manager.c
	* src/home/hd-switcher.c: Move call to update blurring from hdrm to
	  switcher, as previous call to update blur state was done before the
	  task navigator had finished zooming in.	

2009-04-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Regression fix.  Rotating back and forth makes the thumbnail titles
	in switcher disappear.

	* src/util/hd-transition.c (on_rotate_screen_timeline_new_frame):
	  At the last frame of the animation rotate hdrm to angle=0.
	  Otherwise it remains slightly tilted.

2009-04-30  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#113685 - Div0 - this fixes a single occurance. There 
	may be others. Fixes will be included in clutter shortly to make
	it produce warnings when scale is set to 0.

	* src/launcher/hd-launcher.c: Modified launching animation to start
	window from a small size rather than 0 size.

2009-04-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Fixes: NB#113825 - Task launcher labels should be hardcoded to white

	* src/launcher/hd-launcher-tile.c:

2009-04-30  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes issue where app launch animation from shortcut was longer than
	animation from launcher.
	* data/transitions.ini: Changed launch animation length to that of the 
	  window opening animation
	* src/launcher/hd-launcher.c: Load window opening animation duration 
	  from [launcher_launch] in transitions.ini

2009-04-30  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes: NB#114008 - Task launcher side margins not big enough

	* src/launcher/hd-launcher.h: Made constant names more obvious
	* src/launcher/hd-launcher-tile.c
	* src/launcher/hd-launcher.c: Now work out when a tile is clicked
	  using a clutter actor for the click area (that is clipped to
	  the launcher margins as per spec).	

2009-04-30  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.44

2009-04-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added AppMgr.Prestart D-Bus API to stop/restart prestarting apps.
	Fixes: NB#114068

	* src/launcher/hd-app-mgr-dbus.xml:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-app-mgr.h:

2009-04-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#114058 Blank status area is shown on the incoming call view in
	          portrait mode.

	Regression fix.  When we received a call in home view & portrait mode
	the status area remained visible.

	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  Search for fullscreen clients not only in app but in home view.
	  We can have fullscreen dialogs (like the incoming call dialog)
	  in home view.

2009-04-29  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Improved matching and handling of windows with unknown applications.

	* src/launcher/hd-app-mgr.c:
	* src/mb/hd-comp-mgr.c:

2009-04-29  Gordon Williams <gordon.williams@collabora.co.uk>
	
	Fixes: NB#113697 - dbus call is able to hide status area and button
	
	* src/home/hd-render-manager.c: We now make sure not to hide HdHome if
	  we're not showing windows (fixes critical message). When we check
	  for fullscreen windows, make sure we only check in app mode, not in
	  all modes.

2009-04-29  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#109022 - Hildon banner gets blurred

	* src/mb/hd-comp-mgr.c: Non confirmation notes put to the top even if
	  they have a transient parent.

2009-04-29  Gordon Williams <gordon.williams@collabora.co.uk>

	Screen rotation transition implementation, and regression fix
	* src/util/hd-transition.h	
	* src/util/hd-transition.c: Added function to rotate and dim the screen
	* src/util/hd-util.c: Now, when rotate is called, do it in 4 steps:
	  rotate transition, XRandr call, wait, final rotate transition. 
	* data/transitions.ini: initial timings for rotate transitions added,
	  and put in a lot of comments
	* src/home/hd-render-manager.c: Fix for regression with stackable 
	  windows if in task navigator. Now we don't make any background 
	  windows visible if the task navigator is active.

2009-04-28  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Added a set_visibilities call if the
	state changes from app mode to non-app mode, to solve problem with
	status menu having been moved off of the screen because it was
	deemed not to be visible. Fixes NB#112996

2009-04-28  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c: Adding helpful debug prints.

2009-04-28  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#112273 - Hildon-home customization features are broken in
	latest CP build.

	* src/hildon-desktop-views.schemas: Enable all four home views.

2009-04-28  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Remove call to 
	  mb_adjust_dialog_title_position (as we never paid attention to 
	  it anyway). This stops theme change which causes dialog title
	  flickering sometimes

2009-04-28  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-home.h
	* src/home/hd-home.c: Partial fix for NB#109445, full fix for 
	  NB#111647, NB#109899, NB#109258. Make sure that when we leave
	  the HOME_EDIT_DLG state, we close any dialogs that might have	  
	  been open in it.
	* src/home/hd-render-manager.h: Now make sure we don't grab the
	  area covered by notifications in the HOME_EDIT_DLG state. This
	  isn't really needed it turns out, but it is good practice.
	* src/tidy/tidy-blur-group.c: Small tweak to allow multiple blur
	  passes each frame (makes unblurring less visible when what is
	  blurred changes)

2009-04-28  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#113103 Desktop crashes when camera application is closed
	NB#111831 zero division crashes in hd-task-navigator.c:layout_thumbs

	* src/home/hd-task-navigator:
	  Behave when someone tries to remove a nonexisting thumbnail.
	  This is a bug somewhere else but we don't crash at least.

	BTW we forgot to celebrate that hd-task-navigator.c
	is over 3000 lines now (and weights more than 100 kilobytes).

2009-04-27  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Handle maemo-launcher ApplicationDied signal, informing the user.
	For NB#101726.

	* src/home/hd-switcher.c:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher-item.c:

2009-04-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111388 Thumb nails in switcher are overlaping.

	* src/home/hd-task-navigator.c:
	  Problem caused by concurrent animation (attempts).
	  Made them more robust, for example the thumbnails
	  can change direction while flying now.

2009-04-27  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#111113, NB#110729 - Settings not stored on restart

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_set_current_view):
	* src/home/hd-home-view.c (hd_home_view_applet_press,
	  hd_home_view_store_applet_position, hd_home_view_move_applet):
	* src/home/hd-home.c (hd_home_add_applet):
	* src/mb/hd-home-applet.c (hd_home_applet_init): Add GConf error
	  handling and sync call.

2009-04-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.43

2009-04-24  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#112368 - crash when hildon-desktop killed

	* src/home/hd-render-manager: A dispose function added.

2009-04-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixed according to Laszlo's investigation:
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_handle_stackable): Refresh window
	theme in both of the 'preceeds a follower' case. Fixes: NB#106208

2009-04-24  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Separated run-time data on applications from HdLauncherApp to
	HdRunningApp, in preparation for libgnome-menu integration.
	Moved handling of loading timeout to HdAppMgr.
	Fixes: NB#111844, NB#112105

	* src/home/hd-home.c:
	* src/home/hd-switcher.c: Added handling of application-loading-fail.
	* src/home/hd-task-navigator.c:
	* src/launcher/Makefile.am:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-app-mgr.h:
	* src/launcher/hd-launcher-app.c: Removed run-time information.
	* src/launcher/hd-launcher-app.h:
	* src/launcher/hd-launcher.c: Removed loading timeout.
	* src/launcher/hd-launcher.h:
	* src/launcher/hd-running-app.c: Created for keeping run-time data on
	applications.
	* src/launcher/hd-running-app.h:
	* src/mb/hd-comp-mgr.c: HdCompMgrClient now points to a HdRunningApp.
	* src/mb/hd-comp-mgr.h:

2009-04-24  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#111290 - Tapping on the center of the title area does not
	opens the Home layout mode menu

	* src/home/hd-title-bar.c (hd_title_bar_init, hd_title_bar_update):
	Also open Home layout mode menu when center of title area is pressed.

2009-04-24  Laszlo Pere  <lpere@blumsoft.eu>

	Fixes: NB#98233 - back button segfault

	* src/mb/hd-theme.c: Adding a reference for the timeout function.

2009-04-23  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#112122 - Edit Button Tweaking

	* src/home/hd-home.c (hd_home_create_edit_button): Reduce the width of
	the edit button.

2009-04-23  Gordon Williams <gordon.williams@collabora.co.uk>

 	* src/launcher/hd-launcher-tile.c: Now load brightness value for tile
	* src/tidy/tidy-highlight.c: Changed blur pattern to smooth out blur
	* src/mb/hd-comp-mgr.h: Adjusted Operator spacing to Spec v2.2
	* data/transitions.ini: Removed unused items, added brightness option,
	  raised saturation back to 0.8 at Martin's request

2009-04-23  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-grid.c: Fix so that un-filled lines
	are left-justified again.

2009-04-23  Gordon Williams <gordon.williams@collabora.co.uk>
	
	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c	
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-grid.c: Fix NB#112743 (launcher icons now
	centred). Remove all the subview blurring code, as apparently we don't
	want to blur now. Also reposition scroller/icons so that now icons do
	not clip against the top 70px when transitioning or scrolling.

2009-04-22  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Fixes NB#107274, NB#111296. Force blur
	group to recalculate if it was ever set to not blur (regardless of
	whether it was rendered or not).

2009-04-22  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#110893 - Dialpad is also opened by '#', '+' and '*' keys

	* src/home/hd-home.c (hd_home_desktop_key_press): Call UI is also
	launched by '#', '+' and '*' keys.

2009-04-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_actor_opaque):
	  Regression fix.  Unbroken subview->mainview transition.
	  Reverting the change which declared actors under effect
	  transparent, hence not blocking, thus showing something
	  inappropriate in that transition.

2009-04-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_subview):
	  Removing MBWMCompMgrClutterClientDontUpdate workaround.
	  (NB. the subview transition was broken already)

2009-04-22  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added Xsession script to wait until h-d is ready, for NB#109797.

	* debian/hildon-desktop-wait:
	* debian/rules:

2009-04-22  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Remove the HdRenderManager::damage-redraw signal.
	Left some comments for Gordon (or whoever feeling adventurous).

	* src/home/hd-render-manager.c:
	  hd_render_manager_queue_delay_redraw(): queue_redraw() directly
	  hd_render_manager_paint_notify(): removed unnecessary check

2009-04-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Dafydd Harries for
	/tmp/hildon-desktop/desktop-started.stamp

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Create
	desktop-started.stamp file for startup sequence optimisations.
	Fixes: NB#109797

2009-04-21  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes NB#109314
	* src/util/hd-transition.c: Removed commented out code
	* src/home/hd-render-manager.c: Modify position of blur_front to place
	it below app_top, where it should have been previously

2009-04-21  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Now treat an actor as non-opaque
	if it is involved in an effect (stops flicker in some transitions)
	* src/util/hd-transition.c: Make popup animation request geometry
	each frame (makes the fill-in fit even if the window is resized)	
	* src/mb/hd-comp-mgr.c: Added popup animation for clients of type
	HdWmClientTypeAppMenu

2009-04-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Make the switcher understand _HILDON_NOTIFICATION_THREAD.

	* src/home/hd-task-navigator.c
	* src/mb/hd-note.c
	* src/util/hd-util.h
	* src/util/hd-util.c (hd_util_get_x_window_string_property):
	  Taken from hd-note.c.
	* src/mb/hd-atoms.h
	* src/mb/hd-atoms.c:
	  Atom added.
	* TODO

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Removed some old-time #if0-d code.  Let's not leave mess behind.
	  This is my mum's birthday.

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Regression fix.  The blue background of notifications came
	  to the foreground, making it impossible to read the message.
	  But at least it's documented now why actor ordering is
	  significant.

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111139 ROTATION: Screen flickers when received chat message in
	          active call

	hd though the 15x15-15-15 tklick window was still visible
	(and it was a dialog) so it decided we should rotate back.

	* src/home/hd-render-manager.c:
	  hd_render_manager_restack(): don't put offscreen windows in app_top
	  hd_render_manager_is_visible(): reject offscreen actors right away

2009-04-20  Gordon Williams <gordon.williams@collabora.co.uk>

	NB#109969 - Maximise animation in task switcher had flickering
	            as the title bar became suddenly visible
	* src/home/hd-title-bar.h
	* src/home/hd-title-bar.c: Added a function to return a copy of the
	title bar that can be used for animations
	* src/home/hd-task-navigator.c: Re-ordered plate and prison clutter
	actors so that we can remove the clipping on the actor prison and
	display a fake title bar in it. Fake title bar is now behind the
	plate as it fades out, to produce a nice transition to the real
	title bar.

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111773 ROTATION:CAll UI is hidden after tapping on status menu

	* src/home/hd-render-manager (hd_render_manager_set_status_area):
	  Block home background when blocking the status area.

2009-04-20  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.42

2009-04-20  Gordon Williams <gordon.williams@collabora.co.uk>
	
	NB#94184 - removing the closing effect particle from hildon-desktop 
	and adding it to the theme
	* src/mb/hd-theme.h: Add #define for CLOSING_PARTICLE
	* src/util/hd-transition.h: Remove old particle #define
	* src/util/hd-transition.c
	* src/home/hd-task-navigator.c: Changes to load closing anim particle
	from the theme.
	* data/white-particle.png (Removed): as we use the particle from the
	theme now	

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111908 Task button doesn't respond when the image viewer is opened
	          for the second time.

	HdLauncher remained visible after launching the app for the second time
	because the launcher's private transition engine thought it's coming
	from subview and didn't hide it end the end of transition.

	* src/launcher/hd-launcher.c (hd_launcher_application_tile_clicked):
	  Don't start a mistaken subview-out transition when the launcher
	  is (to be) hidden. (An appropriate main-out transition is already
	  in progress.)

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#111388 Thumb nails in switcher are overlaping.

	* src/home/hd-task-navigator (navigator_hidden):
	  Don't be confused if a thumbnail is added during zoom+close.

2009-04-20  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-task-navigator.c (hd_task_navigator_remove_notification):
	Fix Coverity issue when thumb->tnote == NULL.
	* src/launcher/hd-launcher-tile.c (hd_launcher_on_glow_frame): Fix
	Coverity issue when priv->icon_glow == NULL.
	* src/mb/hd-theme.c (back_button_timeout): Silence Coverity by
	checking for c == NULL.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_handle_stackable): Silence
	Coverity by checking for flink == NULL in one case.
	* src/home/hd-home.c (hd_home_constructed): Add check for the return
	value of gtk_style_lookup_color to silence Coverity. Also white space
	fixes.
	* src/mb/hd-comp-mgr.c: Do not compile most of the debug dumping code
	if g_debug is not compiled. Again to silence Coverity.
	* src/home/hd-home-view-container.c (backgrounds_dir_changed): Do not
	check whether an unsigned int is negative to silence Coverity. Also
	white space fixes.

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-switcher.c (hd_switcher_something_removed):
	  Exit the switcher if it's become completely empty.
	  Fixes the case when the switcher contains only notifications
	  and you close one of them.

2009-04-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/main.c:
	  Abort early if the compositor wasn't turned on, which hildon-desktop
	  doesn't tolerate, and causes it to fail in the most mysterious ways.
	  This may happen if libmatchbox cannot find its theme (eg. accidentally
	  you configure it with --prefix=/usr/local).
	* TODO

2009-04-17  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes NB#111517 and NB#108862
	* src/util/hd-util.c
	* src/util/hd-util.h: Modify hd_util_is_client_system_modal to instead
	  return true only if the client has a modal blocker. Renamed to 
	  hd_util_client_has_modal_blocker
	* src/home/hd-render-manager.c: Removed un-needed code in set_button,
	  changed for hd-util modifications 	  
	* src/launcher/hd-launcher-tile.c: Remove reactivity on the launcher 
	  tile as it is not required.
	* src/home/hd-title-bar.c: Removed BTN_SWITCHER_FG as it turned out
	  not to be needed. Fixes NB#111517 (Task switcher icon does not use
	  pressed state).
	* src/mb/hd-comp-mgr.c: Removed tasks_button_blockers, and instead
	  move code to setup_input_viewport. Fixes NB#108862
	* src/tidy/tidy-finger-scroll.c: Re-added smooth drag animation in 
	  case this helps with task launcher subview speed at all.	

2009-04-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Align launcher tiles to the left.
	Fixes: NB#111643

	* src/launcher/hd-launcher-grid.c:

2009-04-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.41

2009-04-17  Gordon Williams <gordon.williams@collabora.co.uk>

	Fix for crashes that happen on hildon-desktop exit.
	* src/launcher/hd-launcher-tile.c: Now destroy actors on dispose to
	  avoid problems with clutter destroying children before finalize.

2009-04-17  Gordon Williams <gordon.williams@collabora.co.uk>

	Fix for crashes that happen on hildon-desktop exit.

	* src/home/hd-scrollable-group.c: Fix segfault on exit caused by call
	to clutter_actor_get_size(0)
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-tile.c: Checks for non-NULL before 
	  destroying actors.
	  
2009-04-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.40

	* src/home/hd-title-bar.c (hd_title_bar_init): Do not call
	clutter_label_set_use_markup until we know about the title text.
	(hd_title_bar_set_window): Use Pango markup only if the text has that.
	* src/mb/hd-decor.c (hd_decor_create_actors): Use Pango markup only if
	the text has that. Fixes: NB#108303

2009-04-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_popup):
	  Don't be confused by fullscreen things and pop the bottom.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Removed an older condition that prevented fullscreen dialogs
	  from causing rotation.  As a consequence fullscreen dialogs
	  like the incoming call will be will be able to rotate not only
	  in home view but in app view.  This is in relation with NB#11111.
	  (no kidding i really own that bug)

2009-04-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Changed launcher to UI specs.
	Fixes: NB#109134, 111112

	* src/launcher/hd-launcher-tile.c: Use SmallSystemFont.
	* src/launcher/hd-launcher.c: Don't display title and icon for subpages.

2009-04-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-theme.c (construct_buttons): In case decor is not yet
	created (d == NULL), allow close button for non-stackables and
	secondaries acting as the stack leader.

2009-04-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#108826 during drag and drop or panning , device is getting black
	          screen , reboot is required to use any application
	NB#109753 Tap and hold on any link received in mail - blanks ui
	completely

	* src/home/hd-render-manager.c:
	  hd_render_manager_append_geo_cb():
	    Don't allow blocker rectangles with negative position.
	  hd_render_manager_is_visible():
	    Fix integer propagation mistakes which caused some if()s to fail,
	    thus some clients to block others which it shouldn't thus hiding
	    the application actor behind the 1x1 window thus scaring the hell
	    out of testers.

2009-04-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Handle (= don't crash) clients without STACKING_LAYER properly.

	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_handle_stackable(): error handling improvement
	  hd_comp_mgr_map_notify(): do not give up map_notify(),
	    because then we'd crash in the switcher when the client
	    is gone and Kimmo would be fast to find me.

2009-04-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Centralized showing the loading screen only as a response to the
	HdAppMgr signal.
	Fixes: NB#108072

	* src/home/hd-switcher.c: Added handler for application-launched signal.
	* src/launcher/hd-app-mgr.c: Removed directly showing the loading
	screen when launching from dbus call.
	* src/launcher/hd-launcher.c: Separated launching an app from showing
	the loading screen.
	* src/launcher/hd-launcher.h:

2009-04-14  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.39

2009-04-14  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c: Fix for NB#110685 - launcher spec says
	  it should only close when the edges are tapped - not when the blank
	  space between the icons is tapped.
	* src/home/hd-render-manager.c: Fix for NB#110686 - top-left icon and
	  status area appear over the VKB when using the copy/paste window.

2009-04-09  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.38

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_handle_stackable): Trap X error in
	case XGetWindowProperty returns one and handle it in
	hd_comp_mgr_map_notify.

2009-04-09  Gordon Williams <gordon.williams@collabora.co.uk>

	Fix for NB#110586
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h
	* src/launcher/hd-launcher.c: Now reset the drag distance when the
	user clicks anywhere in the launcher - not just in the launcher-page

2009-04-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_property_changed):
	  Handle undecorated clients.

2009-04-08  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Fix for NB#109907 - blurred background
	  not updating correctly.

2009-04-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.37
	
2009-04-08  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h
	* src/launcher/hd-launcher-tile.c
	* src/launcher/hd-launcher.c: Added back button behaviour nearer
	  the spec - clicking on dimmed areas goes 'back' - rather than
	  to home. fix NB#109392, NB#105358
	* src/home/hd-render-manager.c: removed debug print
	* src/home/hd-task-navigator.c: Now fade out only the title (not
	  the 'plate') so we don't get such a flicker effect when zooming
	  in to an app. fix NB#109969

2009-04-08  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Correctly manage closing applications while they are hibernating.

	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-app-mgr.h:
	* src/mb/hd-comp-mgr.c:

2009-04-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Little clean up: be HdLauncher the launcher group.

	* src/launcher/hd-launcher.c
	* src/launcher/hd-launcher.h
	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c
	* src/mb/hd-comp-mgr.c

2009-04-08  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Close the loading screen and notify the user if launching an app doesn't
	do anything for 10s.
	Fixes: NB#100654

	* src/launcher/hd-launcher.c: Added a timeout after which the loading screen
	will be closed.

2009-04-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (create_thwin):
	  Center thumbnail titles vertically.

2009-04-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#93876 When a currently running application is closed the view
		 is not zooming out to the swicther view.

	* src/home/hd-task-navigator.h:
	  Changed hd_task_navigaotor_is/has_*() not to take $self,
	  so they can be used anywhere.
	* src/launcher/hd-launcher.c (_hd_launcher_transition_clicked):
	  Updated for that.
	* src/home/hd-task-navigator.c:
	  Delay hd_task_navigator_remove_window() until zooming completes.
	  Don't blow up if you try to remove an actor whose cmgrcc is
	  already clear.
	* src/home/hd-render-manager.h:
	  Removed hd_render_manager_has_apps(),
	  use hd_task_navigator_has_apps() instead.
	* src/home/hd-render-manager.c (hd_render_manager_set_state):
	  Now you can safely go to TASK_NAV state anytime,
	  hdrm_set_state() will take you to HOME if the switcher is empty.
	  Also guard the ClutterClient while zooming in.
	* src/home/hd-switcher.h
	* src/home/hd-switcher.c:
	  hd_switcher_remove_window_actor() changed to assure that the
	  CompMgrClutterClient is not destroyed as long as HdTaskNavigator
	  animates (if it chooses to).
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect):
	  Go to TASK_NAV state.

2009-04-07  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Move HdAppMgr initialization to main() so it can know about closing up,
	and then kill all prestarted apps.
	Fixes: NB#105817

	* src/launcher/hd-app-mgr.c: Added hd_app_mgr_stop to stop all prestarted
	apps (and further clean up if necessary).
	* src/launcher/hd-app-mgr.h:
	* src/main.c: Handle SIGTERM, exit gtk's main loop when received.
	* src/mb/hd-comp-mgr.c: Pass the render manager to the app mgr.

2009-04-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.36
	
2009-04-07  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Now do 3 levels of zoom, based on
	  whether we came from switcher or not.
	* src/tidy/tidy-blur-group.c: Fix for 'can't compile vertex shader'
	  in scratchbox

2009-04-07  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Make top-left button unselected
	on state change rather than after the state change.

2009-04-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/main.c (hd_fpu_set_mode): New. Based on Leonid's patch for
	NB#107185.
	(main): Call hd_fpu_set_mode to set CPU for fast float calculations.

2009-04-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#109009 desktop crashed when gridcombobox is launched

	* src/mb/hd-wm.c (hd_wm_client_new):
	  Create HdApp:s from for unknown client types.
	  libmatchbox created MBWMClientApp:s but all of hd expects HdApp:s.

2009-04-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Improved close application animation in tasw.
	Now it should look the same as in maximized case.

	* src/home/hd-task-navigator.c
	* src/util/hd-transition.h:
	  Made the parcile number and file name public.
	* src/util/hd-transition.c

2009-04-06  Gordon Williams <gordon.williams@collabora.co.uk>

	Fix for NB#109714 (highlight on launcher not disappearing)
	* data/transitions.ini: Refactoring, tweaking of transition times 
	  for glow effect
	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c: Make sure transition values are read
	  from transitions.ini
	* src/launcher/hd-launcher-page.c: Check cursor movement while
	  dragging and deselect icon if it exceeds that value
	* src/launcher/hd-launcher-tile.c
	* src/launcher/hd-launcher-tile.h: Move code for detecting cursor
	  movement into hd-launcher-page, increase size of highlight so
	  it no longer clips
	* src/tidy/tidy-highlight.c: Ensure highlight copes with being bigger 
	  than the texture it uses
	* src/home/hd-render-manager.c: Changing names in transitions.ini and
	  prepare for 3 levels of zoom
	* src/tidy/tidy-blur-group.c: ensure that edge of zoomed area fits
	  the edge of the screen
	* src/tidy/tidy-finger-scroll.c: Stop this grabbing events that we 
	  need for hd-launcher-page
	* src/util/hd-transition.c: Change comment to something more useful

2009-04-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* tests/test-large-window-stack.c:
	  New test program to see how hd likes massive window stacking.
	* tests/test-portrait-win.c: Improved.
	* tests/Makefile.am
	* TODO: TODO added

2009-04-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Try to restack less.  Fixes doubly set CURRENT_APP_WINDOW
	(ie. is-topmost) after task switching.

	* src/mb/hd-comp-mgr.c:
	  The unused hd_comp_mgr_sync_stacking() got new meaning
	  to schedule a restack when idle.
	* src/mb/hd-comp-mgr.h:
	  Changed the signature of hd_comp_mgr_restack() to be usable
	  as an idle function.
	* src/home/hd-render-manager.h:
	  Corrected STATE_NEED_TASK_NAV() to not include the launcher.
	* src/home/hd-render-manager.c (hd_render_manager_update_blur_state):
	  Use it.
	* src/home/hd-switcher.c (hd_switcher_zoom_in_complete):
	  Likewise.  We used to restack 3 times.

2009-04-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_set_state):
	  Removed hd_render_manager_return_windows() as it shouldn't be
	  necessary anymore.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Removed a clutter_actor_hide(), set_visibilities() should be
	  smart enough now.

2009-04-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Visibility and subview transition fixes.

	* src/mb/hd-comp-mgr.h:
	  Added HdCompMgrClient::effect for hd-transition.
	* src/util/hd-transition.h:
	  Added hd_transition_actor_will_go_away().
	* src/util/hd-transition.c (hd_transition_subview,
	  hd_transition_completed):
	  If multiple subview transitions would overlap replace the actors.
	  This is necessary when the client maps a lot of stackable windows
	  at once.  In particular, it help keeping visibilities right when
	  we start managing such clients at startup.
	* src/home/hd-render-manager.c:
	  Added visibility-related debug prints.
	  Added workaround not to hide HdHome when it should be shown.
	    This is necessary when a large window stack is pulled down at once.
	  Use hd_transition_actor_will_go_away().

2009-04-03  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Wait until the real app appears before hiding the switcher when waking
	up an hibernated application.
	Fixes: NB#106572

	* src/home/hd-switcher.c:
	* src/home/hd-task-navigator.c:
	* src/launcher/hd-app-mgr.c:

2009-04-03  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-title-bar.c: Fixed copy/paste bug

2009-04-03  Gordon Williams <gordon.williams@collabora.co.uk>

	Changes for NB#107013 - top-left button shouldn't be blurred for
	non-system-modal dialogs

	* src/home/hd-title-bar.h
	* src/home/hd-title-bar.c: Added FOREGROUND state for when we want
	to raise the top-left button above the blur. Refactored a few arrays
	of bools into an array of flags.
	* src/home/hd-render-manager.c:	update_blur now tells the title bar
	if it should render the top-left button above the blur. status area is
	now added to the foreground group of hd-title-bar

2009-04-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (show_edit_button_template,
	  hide_edit_button_template, hd_home_init, hd_home_show_edit_button,
	  hd_home_edit_button_move_completed, hd_home_hide_edit_button): Add
	  a dismissal transition for the edit button. Ease the animation
	  curves.

2009-04-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-wm.c (hd_wm_client_responding): Fix the FIXME about not
	returning anything from the function.

2009-04-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Little spring clean up in the state machine.

	* src/home/hd-render-manager.c:
	  hd_render_manager_create(): removed task_nav_container,
	    manipulate HdTaskNavigator directly.
	  hd_render_manager_sync_clutter_before():
	    Don't show nor animate the showing of tasw (which is otherwise
	    hidden) when switching to APP state.
	  hd_render_manager_set_state():
	    Cleanup to be more readable.
	* src/home/hd-task-navigator.h
	* src/home/hd-task-navigator.c:
	  Removed the _enter() and _exit() functions,
	  _show() and _hide() are enough.

2009-04-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.35

2009-04-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_subview):
	  Don't do this transition effect if not in APP state.
	  Doing it in tasw view is not very nice.

2009-04-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-task-navigator.c: Added missing object_ref
	  for dialogs (original ref may have been in hd-switcher
	  perviously)

2009-04-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (on_subview_timeline_new_frame):
	  Regression fix.  Restored the code that hides the overlayed actor
	  because we don't necessarily restack, thus check the visibilities
	  after the effect.
	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  Don't hide actors which are running an effect.  This fixes flicker
	  when going back to the main view from subview.  Curiously only in
	  scratchbox.

2009-04-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Fixed broken vignette effect

2009-04-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-theme.c (back_button_release_handler):
	  Don't release the button because the caller
	  mb_wm_decor_button_press_handler() does it
	  for us.  NB#109094.

2009-04-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.34

2009-04-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-switcher.c
	* src/mb/hd-comp-mgr.c: Removed un-needed and unmatched g_object_refs
	that caused clutter actors for windows not to be freed.

2009-04-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.33

2009-04-01  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c: Added correct g_object_ref and unref for
	  actors used in the transition.
	* src/mb/hd-theme.c: Added removal of callback if a button was freed 
	  before the timeout happened.

2009-04-01  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-item.c: Fix warning when g_return/etc are
	  turned on
	* src/mb/hd-comp-mgr.c: NB#107883 - subview animations are wrong for
	  stacked windows. Also removed TODO that got done

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c
	* src/home/hd-render-manager.c:
	  Cosmetic changes, just to commit something today.

2009-04-01  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/main.c: Right after initialisation, tell clutter not to mipmap
        fonts. Findings of NB#105969 show this is much faster, and we don't
        need it.
        * debian/control
        * src/mb/hd-comp-mgr.c: Move setting of HD-MBWMCompMgrClutterClient
        in actor to the MBWMCompMgrClutterClient itself - removing the risk
        of a pointer dangling to a destroyed class. Fixed NB#107681

2009-04-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* configure.ac: Move -DG_DISABLE_CHECKS to debian/rules.

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Cleanups in the states.

	* home/hd-title-bar.h
	* home/hd-title-bar.c:
	  Removed empty hd_title_bar_set_show().
	* home/hd-render-manager.h:
	  Removed ineffective STATE_SHOW_TITLE.
	  Removed unused STATE_APP_FULLSCREEN.
	* home/hd-render-manager.c:
	  Updated accordingly.

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Don't show applets in the background in switcher and launcher views.

	* src/home/hd-render-manager.h:
	  Added STATE_SHOW_APPLETS().
	* src/home/hd-render-manager.c (hd_render_manager_set_state,
	  hd_render_manager_sync_clutter_before):
	  Hide/show HdHome's front container (which contains all applet
	  containers).  Also moved the code that moved the front back
	  and forth from sync_clutter to set_state because it seems to
	  have a better place there.

2009-03-31  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/mb/hd-comp-mgr.c: Check that an actor's stage is valid. It may
         not be if it has no parent

2009-03-31  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/tidy/tidy-highlight.c: Now cache the pixel shader so it isn't 
          loaded once per icon
        * src/mb/hd-animation-actor.c
        * src/mb/hd-animation-actor.h: Removed warnings code for NB#107323,
          as it didn't play well with the fix in libmatchbox

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Remove offending g_warning() accidentally left in.

2009-03-31  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-app-menu.c (hd_app_menu_request_geometry):
	honour size and position requests.
	Fixes NB#94957.

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (add_nothumb):
	  Don't forget to set the font of the notification text.

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  Let us entertain ourselves with another change and don't assume
	  portrait mode support by default.

2009-03-31  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#108599 _HILDON_PORTRAIT_MODE_SUPPORT not inherited with transiency

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Inherit the flag even if the parent is not visible.

2009-03-31  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/tidy/tidy-blur-group.c: Changes to fix blank/garbled screen on
        landscape->portrait transition (when background blurred), NB#107951

2009-03-31  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.32

2009-03-30  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Comment to help make code less cryptic
	* src/tidy/tidy-mem-texture.c: Fix covertity finding about unsigned
	numbers that causes 'if' clause to be true.
	* src/home/hd-render-manager.c: Removed un-needed debug printing

2009-03-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_sync_clutter_before):
	  Regression fix.  Don't show the status area in launcher view.
	  Nor in any other states it's not supposed to be there.

2009-03-30  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/mb/hd-desktop.c (hd_desktop_stack): Set
	_HILDON_APPLET_ON_CURRENT_DESKTOP property only when desktop is really
	visible. Fixes: NB#108527

2009-03-30  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-transition.c, src/mb/hd-comp-mgr.c,
	src/util/hd-transition.c, src/home/hd-switcher.c,
	src/home/hd-render-manager.c: Adjust behaviour for the new
	mb_wm_comp_mgr_clutter_client_get_actor semantics (no reference).
	* src/mb/hd-comp-mgr.[ch] (hd_comp_mgr_client_get_actor): Removed as
	unused.

2009-03-30  Alejandro Pinheiro <apinheiro@igalia.com>

	* src/a11y/launcher/Makefile.am
	* src/a11y/home/Makefile.am
	Added MB2_CFLAGS, required to compile a11y support after 2009-03-23
	configure.ac changes

2009-03-30  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/mb/hd-decor.c: Handle X errors in hd_decor_window_is_waiting
        in case Window happens to be invalid. Fixed NB#108480
        * src/home/hd-render-manager.c (hd_render_manager_actor_opaque): 
        Extra checks to attempt to avoid NB#107681 (we have no clear way to
        reproduce, so can't test)
        * src/tidy/tidy-blur-group.c: avoided coverity error with hard-coded
        cap on size of variable
        * src/mb/hd-animation-actor.h
        * src/mb/hd-animation-actor.c: Some changes from NB#107323 to give 
        the warnings. This is not a fix yet though.

2009-03-30  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-wm.c (show_info_note): New idle handler.
	(hd_wm_client_responding): Show the information banner in an idle
	handler, otherwise this can cause a lockup in libxcb. Fixes: NB#106919

2009-03-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* debian/rules:
	  Recognize the "debug" DEB_BUILD_OPTIONS parameter
	  to enable g_debug() and compile with -O0.

2009-03-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/launcher/hd-app-mgr.c (hd_app_mgr_kill):
	  Don't attempt to kill() if pid get < 0 by any accident.

2009-03-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#107503 ROTATION: status bar disappearing

	Actually this bug had nothing to do with rotation.
	It was cause by: keylock mapped -> we have a fullscreen client
	-> change state (to portrait) -> sync_clutter hided SA because of
	the fullscreen -> keylock unmapped -> state is NOT changed and
	the stack is not restacked -> SA remained hidden.

	* src/home/hd-render-manager.c (hd_render_manager_sync_clutter_before):
	  Don't show/hide the status area here, it's enough to do it during
	  restacking.

2009-03-30  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  * Don't update the HDRM from add_window().  This made the Tasks
	    button hidden when a non-portrait mode application launched
	    in front of a portrait one.
	  * Fix task switche layout when going there from that state.

2009-03-30  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c: White space and over 80 char lines fixed.
	(hd_comp_mgr_unmap_notify): Handle the stackable leader as well.

2009-03-30  Jan Arne Petersen  <jpetersen@openismus.com>

	Implement Do not disturb flag.

	* src/mb/hd-atoms.c:
	* src/mb/hd-atoms.h (HD_ATOM_HILDON_DO_NOT_DISTURB,
	  HD_ATOM_HILDON_DO_NOT_DISTURB_OVERRIDE): Add new atoms for do not
	  disturb flags.

	* src/mb/hd-comp-mgr.c (stack_sync, do_not_disturb_flag,
	  portrait_requested, hd_comp_mgr_client_property_changed,
	  hd_comp_mgr_map_notify, hd_comp_mgr_restack,
	  hd_comp_mgr_should_be_portrait,
	  hd_comp_mgr_check_do_not_disturb_flag): Check for changes of do not
	  disturb flag on restacking and property change event. Check for do
	  not disturb on mapping of incoming event previews and information
	  banners.

	* tests/Makefile.am:
	* tests/test-do-not-disturb.c (added): Add do not disturb test window.

2009-03-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Coverity found issues:
	* src/mb/hd-decor.c (hd_decor_create_actors): Don't use 'client'
	before its NULL check.
	(hd_decor_create_actors): Remove dead code, check for title==NULL when
	it cannot be.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Add check for
	possible NULL deref with priv->home==NULL.
	* src/mb/hd-theme.c (construct_buttons): Avoid NULL dereference.
	* src/mb/hd-wm.c (hd_wm_client_responding): Remove unused 'banner'.

	* src/home/hd-home.c (root_window_client_message): Plug a memory leak
	by using break instead of return in the switch.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unmap_notify): Remove transiency
	from a stackable secondary before libmatchbox2 starts to unmap them.
	Also, fix the transiency of the window above if any. Fixes: NB#103836

2009-03-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-notification.c: deleted, never used
	* src/home/hd-notification.h: deleted
	* src/home/Makefile.am
	* data/qgn_home_close.png: deleted, tasw doesn't need it anymore
	* data/Makefile.am
	* TODO

2009-03-27  Gordon Williams <gordon.williams@collabora.co.uk>

        * tests/test-launcher.c (removed)
        * tests/Makefile.am: Removed launcher test (as ir wouldn't have worked
          in a long time anyway)

2009-03-27  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/launcher/hd-launcher-page.c
        * src/launcher/hd-launcher-grid.c
        * src/launcher/hd-launcher-grid.h
        * src/launcher/hd-launcher-tile.c
        * src/launcher/hd-launcher-tile.h: Added glow effect to task launcher 
          items. Refactored HdLauncherTile a bit to save code.
        * src/tidy/tidy-highlight.c: Added more samples for improved blur 
        * data/transitions.ini: Speeded up glow

2009-03-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#98202 Version conflict dialog is appeared in background while the
		 restoring is going on.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Don't place confirmation notes in the front group,
	  because that group is in front of everything else,
	  and if the confirmation note has a transient it
	  would be behind the note.

2009-03-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* tests/test-portrait-win.c:
	  Numerous enhancementes.

2009-03-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Task Navigation Specification 2.0 update.

	NB#106694 Sometimes close button is not shown on the incoming event
		   notification.
	NB#101730 Title of thumbnails in switcher area is not clear.
	NB#98762  The "X" in switcher thumbnails should be themed properly

	* src/mb/hd-atoms.h
	* src/mb/hd-atoms.c:
	  Added atoms to communicate the incoming event notification's
	  time and message body (secondary text).
	* src/mb/hd-note.h
	* src/mb/hd-note.c:
	  Cache the property values.  Notifications to work will need
	  a newer hildon-home now.
	* src/home/hd-task-navigator.c:
	  Little 150KiB change.  Don't use /var/tmp/app-screenshots anymore
	  but X-Maemo-Switcher-Icon of .desktop files.
	* src/mb/hd-comp-mgr.c:
	  Now notification actors needn't be reparented because
	  the navigator doesn't use it anymore.
	* configure.ac:
	  Changed -std=c99 to -std=gnu99.
	* TODO: update
	* src/home/hd-switcher.c
	* src/home/hd-scrollable-group.c:
	  Cosmetic fixes.

2009-03-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.31

2009-03-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_setup_input_viewport): Trap X
	errors.

2009-03-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.30

2009-03-26  Gordon Williams <gordon.williams@collabora.co.uk>

        * data/transitions.ini: More speedups by Martin

2009-03-26  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/tidy/tidy-highlight.c (added)
        * src/tidy/tidy-highlight.h (Added)
        * src/tidy/Makefile.am: Added extra tidy class for blurring task
          launcher icons. Not used in task launcher yet.

2009-03-26  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/mb/hd-decor.c
        * src/home/hd-title-bar.c
        * src/home/hd-title-bar.h: Changing the margin between the title and
          the progress indicator to 8px        
        * data/transitions.ini: Martin's latest values, extra entries for
          task launcher glow that will appear soon          
        * src/mb/hd-comp-mgr.c
        * src/home/hd-home-view.c
        * src/tidy/tidy-blur-group.h
        * src/tidy/tidy-blur-group.c: Improvements to blurring code, and
          fixes to update what is blurred   
        * src/tidy/tidy-sub-texture.h 
        * src/tidy/tidy-sub-texture.c: Tidying some code up    

2009-03-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_get_app): Replace
	g_return_val_if_fail with an if.
	(hd_comp_mgr_client_property_changed): Enhance NULL checks in an
	attempt to fix one of the crashes in NB#108204.

	* src/mb/hd-theme.c (construct_buttons, back_button_press_handler):
	Reference back button for the press handler when installing the press
	handler, not when calling it (when it can be already destroyed). Fixes
	a crash with the current libmatchbox2.

	Revert reversion of Marc's patch, wasn't an issue after all.

2009-03-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.29

	Reverted Marc's patch for NB#106507 because it broke background
	killing.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_handle_stackable): When a stack
	leader is replaced and becomes a secondary, fix its transiency. Also
	re-theme both of the windows to get the titlebar buttons right.
	Requires libmatchbox2 != 0.2.22-1. Fixes: NB#103508

2009-03-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.28

2009-03-24  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Event handlers now return void and cannot stop processing
	of further events.
	Accoding to Kimmo:
	Fixes NB#105014.
	
	* src/home/hd-home.c:
	* src/mb/hd-animation-actor.c:
	* src/mb/hd-note.c:
	* src/util/hd-util.c:

2009-03-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	105061 ROTATION: Incoming call dialog in home view is not
	       in portrait layout

	Support portrait mode in home view.  A bit.
	This is necessary to show dialogs in home view which request
	portrait mode.

	* src/home/hd-render-manager.h:
	  New state, HDRM_STATE_HOME_PORTRAIT, which is like HDRM_STATE_HOME.
	  Added STATE_IS_PORTRAIT() and STATE_IS_PORTRAIT_CAPABLE().
	* src/home/hd-render-manager.c:
	  Added hd_render_manager_set_state_portrait() and *_unportrait().
	  Handle HDRM_STATE_HOME_PORTRAIT.
	* src/mb/hd-comp-mgr.c:
	  Also switch between HOME and HOME_PORTRAIT.
	* src/home/hd-home.c
	* src/home/hd-home-view.c:
	  Rotate the backgrounds back if we're going to portrait mode.
	* src/util/hd-util.c:
	  Create a modal blocker large enough to be ok both in portrait
	  and landscape modest.

2009-03-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  Don't add hidden actors to the list of blockers since it doesn't
	  block anything.  May fix some actual problems.

2009-03-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-theme.c (back_button_timeout): Add some NULL guards. The
	original code was strangely brave in this respect. Should fix
	NB#103447.

2009-03-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-dialog.c (hd_dialog_request_geometry):
	  FKB regression fix.  Ignore decorations when decorations are
	  to be ignored.  Don't reserve cancel area for fullscreen dialogs.
	  Bocsi.

2009-03-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.27

	* autogen.sh: Do not call configure, it's done later by cdbs.
	* debian/rules: Use DEB_CONFIGURE_EXTRA_FLAGS and CFLAGS to pass the
	options in the right way.
	* src/launcher/Makefile.am, src/home/Makefile.am,
	src/Makefile.am, src/util/Makefile.am, src/mb/Makefile.am,
	configure.ac: Link to libmatchbox2 statically when configure flag
	--enable-static-mb2=yes is given.

2009-03-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#106587 Drawing bug using widgets requesting size bigger than the
	          max size inside dialogs

	* src/mb/hd-dialog.c (hd_dialog_request_geometry):
	  Make sure the granted geometry doesn't exceed the screen height.

2009-03-20  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Misc improvements to prestarting sequence.
	Fixes: NB#106507

	* src/launcher/hd-app-mgr.c:

2009-03-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  Little cleanup: name things by their proper name and rename
	  HdCompMgrClientPrivate::portrait_supported to portrait_not_supported.

2009-03-20  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/home/hd-title-bar.c: Ensured that the progress indicator is at
        the end of the title, and that it never overlaps the close button. 
        
2009-03-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#107155 ROTATION: Call handling with system lock dialog is not
	          shown in portrait mode

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Honor the current application's portrait request even
	  if it's not currently visible.

2009-03-20  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Track the windows (including dialogs) for each app so the HdCompMgr can
	tell HdAppMgr when an app has disappeared.
	Fixes: NB#106673

	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-app-mgr.h:
	* src/launcher/hd-launcher-item.c: Added a way to get the GQuark of the
	application id.
	* src/launcher/hd-launcher-item.h:
	* src/launcher/hd-launcher.c:
	* src/mb/hd-comp-mgr.c:

2009-03-20  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/home/hd-render-manager.c: Fix for NB#106678 - Home edit tab
        staying visible when changing states.

2009-03-19  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-title-bar.c (HD_TITLE_BAR_TEXT_MARGIN): Use 24px instead
	of 8px.

2009-03-19  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/home/hd-render-manager.c: Removed warnings generated by clutter
        if restack is called before an actor is parented

2009-03-19  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#103409 - Display is not on when information banner comes

	* configure.ac:
	* debian/control: Add mce-dev dependency

	* src/mb/hd-comp-mgr.c (property_changed_cb_id, mce_proxy,
	  hd_comp_mgr_init, hd_comp_mgr_map_notify): Request mce to switch
	  display on if there is an information banner displayed.

2009-03-19  Gordon Williams <gordon.williams@collabora.co.uk>

        * src/home/hd-clutter-cache.c
        * src/home/hd-clutter-cache.h: Added support for reloading textures in
        the cache
        * src/mb/hd-theme.c: Whenever a new theme is created, notify the 
        texture so it can reload all its' textures on theme change. This
        updates titlebars etc, which PARTIALLY solves NB#101874

2009-03-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#105921 Task switcher is not accessible after the missed call event
	          when call UI is opened

	* src/mb/hd-note.c:
	  Stack incoming event windows below the desktop,
	  so hd_comp_mgr_get_foreground_region() won't find it
	  and won't think it covers anything.

2009-03-19  Jan Arne Petersen  <jpetersen@openismus.com>

	Add support for _HILDON_APPLET_ON_CURRENT_DESKTOP property.

	* src/home/hd-home.c (hd_home_get_current_view,
	  hd_home_get_not_visible_views):
	* src/home/hd-home.h: Add function to get all not visible views.

	* src/mb/hd-atoms.c (hd_atoms_init):
	* src/mb/hd-atoms.h (HD_ATOM_HILDON_APPLET_ON_CURRENT_DESKTOP): Add
	new atom.

	* src/mb/hd-desktop.c (hd_desktop_stack): Add/Remove
	_HILDON_APPLET_ON_CURRENT_DESKTOP property to applets.

2009-03-18  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#104475

	* src/home/hd-home.c (hd_home_desktop_key_press):
	* src/home/hd-render-manager.h (STATE_NO_CALL_FROM_HOME): Do not allow
	call from Home for layout mode, switcher and launcher.

	* src/mb/Makefile.am: Remove trailing spaces.

2009-03-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Removed the icon theme hack, using a bit cleaner workaround.

	* configure.ac,
	  data/icons: Removed data/icons.
	* data/Makefile.am,
	  data/qgn_home_close.png: Moved PNG here from the icons directory.
	* src/home/hd-task-navigator.c (hd_task_navigator_init): Load
	qgn_home_close.png from /usr/share/hildon-desktop for now.

2009-03-18  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes for NB#101613 

	* src/home/hd-render-manager.c: Made sure blur_Front is not raised to
	the top of front - allowing notifications to be seen properly.
	* src/home/hd-render-manager.h
	* src/mb/hd-comp-mgr.c: moved hard-coded state to the top of HDRM like
	we have for other states

2009-03-18  Gordon Williams <gordon.williams@collabora.co.uk>

	* data/transitions.ini: Speeded up transitions even more

2009-03-18  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-page.h: Commented enums
	* src/home/hd-home-view-container.c: Fix for NB#106484, allowing
	background image to move even when blurred
	* src/util/hd-transition.c: Modified close animation to shrink
	more vertically before it starts to shrink horizontally

2009-03-18  Alejandro Pinheiro <apinheiro@igalia.com>

	* debian/rules: set a11y suppport compilation as the default one
	* src/a11y/hildon-desktop-a11y.c: use the environment variable
	ENABLE_HILDON_DESKTOP_A11Y in order to check in runtime if it is
	needed to init the a11y support

2009-03-18  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Changed default application icon name to the correct spelling.
	Fixes: NB#106105.

	* src/launcher/hd-launcher.h:

2009-03-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.26

2009-03-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h: Fix for bugs NB#105855 and NB#106022,
	both related to what is blurred/visible in home edit mode.
	* src/mb/hd-comp-mgr.c: Fixed regression caused by misplaced assert

2009-03-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Use the lowmem signal to determine whether we can launch new
	applications.
	Fixes: NB#106339

	* src/launcher/hd-app-mgr.c:

2009-03-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c: Changes to unregister_client so that an
	unregistered HdApp no longer contains links to the followers it
	had previously.

2009-03-17  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_constructed): Use g_mkdir_with_parents fix
	  warning.

	* src/home/hd-home.c (hd_home_desktop_key_press): Use Gdk to get
	pressed key. Fixes: NB#104578, NB#104534

2009-03-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c
	* src/launcher/hd-app-mgr.c: Code to start an app launch transition
	whenever hildon-desktop is asked to launch an application
	* src/home/hd-render-manager.c: Switched to using object_get_data to
	find clients from actors as it is faster than a search
	* src/home/hd-switcher.c: Added extra checks for valid clients to
	help fix NB#105933 - although this stops the crash it doesn't fix the
	real issue yet
	* src/mb/hd-comp-mgr.c: Added a check for the client, removed some
	debug statements that were spamming the console

2009-03-17  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.25

2009-03-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added X-Maemo-Switcher-Icon property to HdAppLauncher, read from the
	.desktop file.

	* src/launcher/hd-launcher-app.c:
	* src/launcher/hd-launcher-app.h:

2009-03-16  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/mb/hd-status-menu.c (hd_status_menu_init): Move resize/center to
	hildon-status-menu.

2009-03-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client):
	  Regression fix: closing a window stack in tasw segfaulted
	  because unregister_client() forgot to remove the secondary's
	  actor from the switcher.

2009-03-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	When not enough memory is available for launching an app, show a
	notification and allow the user to close other apps.

	* src/home/hd-switcher.c:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher.c:

2009-03-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_subview):
	  Regression workaround: after the transition to the subview
	  the main view wouldn't update anymore.

2009-03-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client):
	  Fix sigsegv that happened on the device after closing web browser
	opened from RSS reader

2009-03-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#105295 Giving a Missed call in portrait mode changes
	          the orientation to landscape

	Actually not changes but crashed hd.

	* src/home/hd-render-manager.c (hd_render_manager_is_client_visible):
	  Tolerate actors of clients in the window stack which are not
	  child of the_render_manager.  This may occurr when the client
	  is in the stack but was not mapped on wm-side.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Fix misleading comment.

	Don't tell me it's 13rd Friday again!

2009-03-12  Gordon Williams <gordon.williams@collabora.co.uk>

	Fix for app relaunch transition.

	* src/launcher/hd-app-mgr.h
	* src/launcher/hd-app-mgr.c: Split hd_app_mgr_relaunch out into
	  hd_app_mgr_relaunch_set_top 
	* src/home/hd-render-manager.h: tidying up
	* src/home/hd-render-manager.c: added transition-complete signal
	* src/home/hd-task-navigator.c: add zoom-in-complete signal
	* src/home/hd-switcher.c: Now sequence app relaunch event to go to
	  launcher, then zoom in, then send app_top message

2009-03-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Ensure apps go to inactive state when main window gets closed.
	Fixes: NB#105003.

	* src/mb/hd-comp-mgr.c:

2009-03-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Background killing.
	Fixes: NB#100159

	* src/home/hd-home.c: Replaced call to hd_comp_mgr_app_from_xwindow to
	hd_comp_mgr_client_get_app.
	* src/home/hd-switcher.c: Remove the previous actor when a new one is
	waking up.
	* src/launcher/hd-app-mgr.c: Many changes for app hibernation.
	* src/launcher/hd-app-mgr.h:
	* src/launcher/hd-launcher-app.h: Removed hd_comp_mgr_app_from_xwindow.
	* src/launcher/hd-launcher.c: Used the new unified hd_app_mgr_launch
	instead of hd_app_mgr_relaunch.
	* src/mb/hd-comp-mgr.c: Many, many hacks to make hibernation work.
	* src/mb/hd-comp-mgr.h:

2009-03-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c: Replaced call to canberra (for sound)
	with a warning (for speed). Will be removed when 105635 is fixed.
	* data/transitions.ini: Made transitions really fast to increase
	apparent speed of device.

2009-03-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.24

2009-03-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c
	* data/white-particle.png: New 'twinkling' close transitions, and
	using clutter-cache for the particle texture. Added cache flag for
	canberra, and added debug print if the call takes >100ms	

2009-03-12  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_add_applet): Restack windows.
	Fixes: NB#104480.

	* debian/changelog: Update

2009-03-12   Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Revert Thomas' patch, we need to make it so that _NET_WM_NAME is free
	from markup and markup will be in new window property:

	Escape titles before we display them so that you can
	use <, >, and & within them.  For some reason, turning
	off markup in titles doesn't do this, so we have to
	escape them explicitly.

	* src/home/hd-title-bar.c:
	* src/mb/hd-decor.c:

2009-03-12  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.c
	  (hd_render_manager_place_titlebar_elements): Call
	  hd_title_bar_update. Fixes: NB#105256

	* debian/changelog: Update

2009-03-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home.c: Removed some debug printing
	* src/mb/hd-app.h
	* src/mb/hd-comp-mgr.c: Now don't perform a subview transition if
	  mapping without an unmap (eg. fullscreen->window case for image
	  viewer)

2009-03-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-transition.c (hd_transition_close_app,
	  on_close_timeline_new_frame, hd_transition_completed)

	  Prepare the close-app transition for portrait<->landscape
	  mode switching, which might be triggered by the application
	  closing.  Failing to do this the effect goes wrong.
	  Also closed a memory leak.

2009-03-11  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Escape titles before we display them so that you can
	use <, >, and & within them.  For some reason, turning
	off markup in titles doesn't do this, so we have to
	escape them explicitly.

	Fixes: #NB105404

	* src/home/hd-title-bar.c:
	* src/mb/hd-decor.c:

2009-03-11  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c: Re-enabled proper sliding
	subview transition

2009-03-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Implemented don't support portrait mode.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Effectively all clients are assumed to support portrait mode
	  unless they claim otherwise.
	* src/mb/hd-note.h
	* src/mb/hd-note.c:
	  Resize the note when the screen geometry changes.
	  Necessary if we switch back to landscape because of a note
	  because notes are sized to fill the screen horizontally.
	  Dialogs don't have this problem.
	* tests/test-portrait-win.c

2009-03-11  Jan Arne Petersen  <jpetersen@openismus.com>

	Fixes: NB#105071 - Do not show notification previews in portrait mode.

	* src/home/hd-render-manager.h (STATE_DISCARD_PREVIEW_NOTE): Do not
	show notification previews in portrait mode.

2009-03-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Regression fix: application window disappeared after coming from
	switcher view and opening the menu.

	* src/home/hd-render-manager.c (hd_render_manager_return_app):
	  Don't let HdHome cover applications.

2009-03-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#105036 Menu Items are not displayed in Call handling view

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Ignore menus, which are not transient.  What a mess.

2009-03-10  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/util/hd-transition.c: added check for null dereference
	that just crashed my device.

2009-03-10  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Fixes NB#91048.
	
	* src/home/hd-home.c: When we get a request to show or hide the
	progress indicator, use the window ID given in the request, and
	don't attempt to guess which window, because we'll get it wrong.

2009-03-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_set_blur):
	  Don't call the complete() function if the effect is already playing
	  because that indirectly calls hd_comp_mgr_restack() and whatsnot
	  with the end result that set_blur() may recurse.

	  This fixes a problem with windows requesting portrait mode
	  as soon as mapped: everything changes well, hdrm goes to the
	  appropriate state but HdTitleBar's state becomes inconsistent
	  and shows the top-left button again.

2009-03-10  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: made shading pattern be loaded from an
	  array
	* src/launcher/hd-launcher-grid.c: modify launcher animation to 
	  fade diagonally

2009-03-10  Gordon Williams <gordon.williams@collabora.co.uk>

	Fixes for NB#104037 and NB#96780, and black desktop + non-blurring
	applet regression from a few days ago.
	
	* src/home/hd-render-manager.c: Added more #defined debug info
	* src/mb/hd-comp-mgr.c: Removed un-needed restacks
	* src/home/hd-task-navigator.c: Removed foreach that didn't work
	 (You can't modify what you iterate over in clutter)
	* src/tidy/tidy-blur-group.c: Added more dimming for vignette effect

2009-03-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Make the app_killer interface usable again.

	* src/launcher/hd-app-mgr.c (hd_app_mgr_dbus_name_owner_changed):
	  Listen for new registrations too.
	  Request for the PID of the launched application's service
	  when we see its NameOwnerChanged.  Getting it right after
	  launch fails because the service is not registered at that time.
	* src/mb/hd-comp-mgr.h
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_kill_all_apps):
	  Renamed from hd_comp_mgr_hibernate_all().
	  Reverts change from r35805 and use HdAppMgr again
	  to enumerate running applications.
	  Fixes a crash when hd_comp_mgr_hibernate_client() tried to
	  hibernate the desktop client, which doesn't have a ClutterClient.
	* src/util/hd-dbus.c:
	  Update.

2009-03-10  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.23

2009-03-10  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/hildon-desktop-views.schemas: By default views 1, 2, 3 are
	displayed. Fixes: NB#93980
	* debian/changelog: Update.

2009-03-09  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Fixes: NB#103602

	* src/mb/hd-dialog.c: when a dialogue opens, remove all
	open menus.

2009-03-07  Thomas Thurman  <thomas.thurman@collabora.co.uk>

        Fixes: NB#100141
	
	* src/mb/hd-comp-mgr.c: app->leader->followers can be null,
	so check before we dereference it.

2009-03-05  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-switcher.c: remove debug statements accidentally checked
	in in previous commit.

2009-03-05  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Fixes: NB#96780
	and its duplicates NB#104206 and NB#104320.
	Does not yet fix NB#104037 which appears not to be identical.
	
	* src/home/hd-render-manager.c: unconditionally raise apps
	in the order the WM believes they're in, when switching to them.

2009-03-05  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Stop trying to prestart apps if they fail.
	Fixes: NB#99791

	* src/launcher/hd-app-mgr.c:

2009-03-05  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added prestarting priorities.
	Fixes: NB#100675

	* src/launcher/hd-app-mgr.c: Prestart apps in priority order, kill them
	in inverse sequence.
	* src/launcher/hd-launcher-app.c: Added new priority variable, read from
	the .desktop file.
	* src/launcher/hd-launcher-app.h:

2009-03-03  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h:
	Added hd_render_manager_blurred_changed convenience function
	* src/home/hd-home-view.c:
	Now call update_blur when the background image changes
	* src/tidy/tidy-blur-group.c:
	Added fallback for when pixel shader can't be used - like scratchbox
        (uses multiple renders)
	* src/mb/hd-comp-mgr.c:
	Added comment to explain commenting of blur update code

2009-03-03  Gordon Williams <gordon.williams@collabora.co.uk>

	Clutter 0.8.2-0maemo20 reccomended (or transitions stutter)
	* src/home/hd-render-manager.c:
	  Removed blur box for task navigator, instead just adjust opacity.	  
	  Fixed restacking bug
	  Fixed bug causing transitions to be constantly running in some cases
	* src/tidy/tidy-blur-group.c:
	  Re-engineered blur to do a progressive blur for blurring in, and
	  a simple fade for blurring out.
	* src/mb/hd-comp-mgr.c:
	  Removed the unmap_effect variable as it turns out not to be needed
	  No longer return windows for stacking as we do it in HDRM now
	  (this allows us to only update the screen when absolutely required)
	* data/transitions.ini
	* src/util/hd-transition.c:
	  Added 'duration' settings for more types of transition. Removed
	  settings for task navigator blur box

2009-03-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c (backgrounds_dir_changed): Change
	suffix to .pvr.

2009-03-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/tidy/tidy-blur-group.c (tidy_blur_group_paint):
	  Fallback to something sensible if we don't have FBO.

2009-03-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* tests/Makefile.am:
	  Build test-portrait-dlg from the right source.
	* tests/test-portrait-win.c:
	  Header cleanup.

2009-03-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c:
	  Optimised blur pixel shader a little, and added more samples
	  for a more smooth blur effect
	* src/mb/hd-theme.c
	* src/mb/hd-theme.h:
	  HdTheme now only extended from MBWMTheme, not MBWMThemePng
	  (this should reduce X Pixmap usage)
	* src/home/hd-home-view.c:
	  Now use .pvr home view backgrounds. Added code to clip oversize
	  backgrounds to the correct size.

2009-03-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.22

2009-02-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-home.c: improve the warnings when apps
	  don't get screenshots taken.

2009-02-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-home.c: add ability to create and delete
	  screenshots when _HILDON_LOADING_SCREENSHOT is received.
	* src/launcher/hd-launcher.c: when restoring saved images,
	  look for PNGs, not JPEGs.
	* src/mb/hd-atoms.c: declare _HILDON_LOADING_SCREENSHOT atom.
	* src/mb/hd-atoms.h: declare _HILDON_LOADING_SCREENSHOT atom.
	* configure.ac: add gdk-pixbuf-xlib library which we
	  need for screenshots.
	* src/main.c: initialise gdk-pixbuf-xlib library.
	* src/launcher/hd-launcher-app.h: declare
	  hd_comp_mgr_app_from_xwindow().
	* src/mb/hd-comp-mgr.c: remove external declaration of 
          hd_comp_mgr_app_from_xwindow().
	
2009-02-27  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_load_applet_position,
	  hd_home_view_add_applet, hd_home_view_move_applet):
	* src/home/hd-home-view.h:
	* src/home/hd-home.c (hd_home_add_applet): Fix move of default
	  applets.

	* src/home/hd-title-bar.c (BTN_LABELS): Fix string.

2009-02-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#103417 Animation actors cannot be resized
	Patch from Artem Egorkine.

	* src/mb/hd-animation-actor.c:
	  Allow geometry changes to HdAnimationActors as long as they
	  remain off-screen.

2009-02-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* data/: Remove unused graphics.

2009-02-26  Alejandro Pinheiro <apinheiro@igalia.com>

	* src/a11y/tail: new directory, to add the implementation of the a11y
	support for src/tidy
	* src/a11y/tail/tail.[ch]: new
	* src/a11y/tail/tail-sub-texture.[ch]
	Added a11y implementation for TidySubTexture

2009-02-26  Alejandro Pinheiro <apinheiro@igalia.com>

	* tests/Makefile.am
	Added -D_XOPEN_SOURCE compiling test portrait (win and dlg), to avoid
	problems including hildon-remote-texture.h

2009-02-26  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.h
	* src/home/hd-task-navigator.c:
	  Little cleanups.

2009-02-26  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Portrait mode changes.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_should_be_portrait):
	  Let the REQUEST flag be inherited too.
	  This is significant when the requesting window is not visible,
	  eg. when there is a stackable window above.
	* src/home/hd-title-bar.c (hd_title_bar_init):
	  Regression fix: the right-aligned buttons weren't visible after
	  switching to portrait mode.  Fixed by repositioning them after
	  screen size change.
	  Plus little cleanups (made global variables static).
	* tests/Makefile.am
	* tests/test-portrait-win.c:
	  Enhanced.

2009-02-26  Jan Arne Petersen  <jpetersen@openismus.com>

	Implement new edit mode title bar.

	* src/home/hd-render-manager.c (hd_render_manager_set_input_viewport,
	  hd_render_manager_sync_clutter_before): Remove HDRM_BUTTON_MENU
	  handling.
	* src/home/hd-render-manager.h (STATE_IS_EDIT_MODE): Add
	  STATE_IS_EDIT_MODE macro.

	* src/home/hd-switcher.c (hd_switcher_clicked, hd_switcher_press):
	  Remove menu button. Use switcher_press to show edit menu in edit
	  mode.

	* src/home/hd-title-bar.c (hd_title_bar_init): Add supoort for buttons
	  with text.
	  (hd_title_bar_set_state): Add handling for BTN_MENU and BTN_DONE.
	  (hd_title_bar_set_full_width): Use relative positions for left and
	  right separtor in edit mode.
	  (hd_title_bar_set_for_edit_mode, hd_title_bar_update): Show edit
	  title bar in edit mode.
	  (hd_title_bar_top_left_press): Do not show pressed state in edit
	  mode.
	  (hd_title_bar_top_right_press): Go back to home mode if in edit
	  mode.

	* src/home/hd-title-bar.h: Add HDTB_VIS_BTN_DONE.

2009-02-25  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (close_applet, close_button_clicked,
	  hd_home_view_close_all_applets): Move close applet function here.
	  (hd_home_view_unregister_applet): Reset layout.

	* src/home/hd-home.c:
	* src/home/hd-home.h: Move close applet function to HdHomeView.

2009-02-25  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c: Fixed blurring of FKB (and full-screen
	dialogs) again. NB#103395
	* src/mb/hd-comp-mgr.c: Call update_blur on unregister, as we don't
	get an unmap event for the FKB.
	  
2009-02-25  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h:
	* src/home/hd-home.c:
	* src/home/hd-home.h:
	* src/home/hd-render-manager.h: Implement more changes in Home UI
	spec.

2009-02-24  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c:
	* src/home/hd-home.c:
	* src/home/hd-home.h: Implement some changes in Home UI spec.

2009-02-24  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-decor.c
	* src/home/hd-title-bar.c:
	NB#90445 - long window titles should be clipped to the screen. Removed
	non-centred code paths from hd-decor as they were never executed.

2009-02-24  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-layout.c (added):
	* src/home/hd-home-view-layout.h (added):
	* src/home/Makefile.am: Add HdHomeViewLayout class which supports
	arranging applets according to the Home UI spec.

	* src/home/hd-home-view.c: Use new HdHomeViewLayout to arrange
	applets. Fixes: NB#101724

	* src/home/hd-home.c (hd_home_add_applet): Move applet positioning to
	HdHomeView.
	  (hd_home_show_applet_buttons): Hide settings icon. Fixes: NB#102994

	* src/mb/Makefile.am:
	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	* src/mb/hd-home-applet.c:
	* src/mb/hd-home-applet.h:
	* src/mb/hd-applet-layout-manager.c (deleted):
	* src/mb/hd-applet-layout-manager.h (deleted): Remove old, non
	working, applet arranging code.

2009-02-23  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c: Added workaround for GLSL shader
	compilation when the language includes ',' as a decimal separator

2009-02-23  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.c: removed loading of blank image 
	(which is now not in the h-d package) - if there is no image a 
	rect of the theme's background colour is created.

2009-02-23  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/launcher/hd-launcher.c: basic support for snapshot images
	on loading.  No support for saving them yet.

2009-02-23  Gordon Williams <gordon.williams@collabora.co.uk>

	Themed app launch animation
	* data/blank-window.png (deleted)
	* data/launcher-button-highlight.png (deleted)
	* data/edit-button.png (deleted)
	* data/Makefile.am: removed images that are no longer used
	* src/launcher/hd-launcher.c: Now use app screenshot or gtk theme's
	  background colour for launch transition, and use title bar image
	* home/hd-home.c: Remove reference to edit-button.png in #define

2009-02-23  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-task-navigator.c: Modified task navigator tourette's
	* src/home/hd-title-bar.c
	* src/mb/hd-theme.h:
	Used correct shape 'pressed' button NB#102652
	* src/tidy/tidy-blur-group.c:
	Modified vignette effect to Martin's spec
	* src/tidy/tidy-mem-texture.c:
	Removed exact row length in preparation for new SGX (Clutter will make
	sure it still works)
	* data/Makefile.am
	* data/transitions.ini:
	Added file to describe length of transitions
	* src/util/hd-transition.c
	* src/util/hd-transition.h:
	Added functions to read settings from transitions.ini
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-grid.c:
	Use hd-transition code to set animation lengths, tweaked animations to
	Martin's spec
	* src/home/hd-render-manager.c:
	Tidying animation code, loading animation details from transitions.ini

2009-02-23  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Remove connection from HdLauncherApp to HdCompMgrClient.
	Fixes: NB#102086

	* src/home/hd-switcher.c: Changed handling of relaunching to use the new
	function.
	* src/home/hd-task-navigator.c: Added function to look for the appropiate
	actor for an app.
	* src/home/hd-task-navigator.h:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher-app.c: Removed methods for getting and setting
	the main_comp_mgr_client.
	* src/launcher/hd-launcher-app.h:
	* src/mb/hd-comp-mgr.c: Set a property on each window actor with the app
	id.

2009-02-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.21

2009-02-21  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_update_active_views): Fix selection of new
	  current view. Fixes: NB#102458
	  (hd_home_view_container_constructed): Start to monitor
	  ~/.backgrounds in constructed.
	* debian/changelog: Update.

2009-02-20  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Being intransient is now a sufficient condition to be considered
	system-modal.  A dialog's modality is not relevant to its
	system-modality.  After discussion with Kimmo.  
	Fixes: NB#97489.
	
	* src/util/hd-util.c: Change prerequisites for being system-modal.

2009-02-20  Jan Arne Petersen  <jpetersen@openismus.com>

	Move background image caching to hildon-home. hildon-desktop just
	loads the existing files.

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_update_active_views): Monitor ~/.backgrounds.
	  (hd_home_view_container_dispose): Remove ~/.backgrounds monitor.
	* src/home/hd-home-view.c (
	  load_background_source, hd_home_view_allocate,
	  hd_home_view_constructed, hd_home_view_dispose,
	  hd_home_view_finalize, load_background_idle,
	  hd_home_view_load_background):
	* src/home/hd-home-view.h: Just load the cached background.
	* debian/changelog: Update.

2009-02-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Fulfilling Lassi's requests wrt portrait mode.

	* src/util/hd-util.c (hd_util_change_screen_orientation):
	  Rotate_90 instead of Rotate_270.
	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_client_property_changed():
	    If the client's REQUEST property changes from 0->1 but SUPPORTS stays 0
	    assume it.
	  hd_comp_mgr_should_be_portrait():
	    When deciding whether a client SUPPORTs portrait layout consider its
	    ancestors in the transiency hierarchy as well.

2009-02-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-render-manager.c (hd_render_manager_init): Remove unused
	member 'in_notify' from the priv struct.
	(hd_render_manager_set_input_viewport): Block Status Area input when
	we have the dialog blur (does not work for two levels of dialogs,
	though).

2009-02-19  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Remove check for being in a transition from HdSwitcher.
	Fixes: NB#102568

	* src/home/hd-switcher.c:

2009-02-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-title-bar.c (hd_title_bar_set_window): If the client is
	NULL, remove the back and close button as well. Fixes: NB#102000
	* src/mb/hd-theme.c (hd_theme_create_decor): Return immediately if the
	client is undecorated.
	* src/mb/hd-dialog.c (hd_dialog_request_geometry): Leave at least
	title bar's worth of space on top of the dialog.

2009-02-19  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Avoid re-entering hd_render_manager_set_state if we came from there, the
	results are unspecified.

	* src/mb/hd-wm.c:

2009-02-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c (hd_task_navigator_add_dialog):
	  Don't abort on error but emulate g_return_if_fail in five lines of code.

2009-02-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Coverity warning fixes.

	* src/home/hd-clutter-cache.c (hd_clutter_cache_get_real_texture):
	Plug leaked filename_alloc in two error cases.
	* src/home/hd-render-manager.c (hd_render_manager_sync_clutter_befo):
	Fix coverity warning with HDRM_STATE_UNDEFINED.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Fix coverity
	warning (app->leader is always non-NULL when app->stack_index >= 0
	holds).

2009-02-19  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c (hd_render_manager_update_blur_state):
	  Add HdWmClientTypeAppMenu to list of client types that cause blur
	  (for clock's popup window)	

2009-02-19  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added misc debug output of prestarting process.

	* src/launcher/hd-app-mgr.c:

2009-02-19  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Removed checking for init_done signal before prestarting apps, as h-d
	wasn't getting it in time.

	* src/launcher/hd-app-mgr.c:

2009-02-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#89949 -- removing another cool easter egg.
	Activate (focus) the desktop client when going to switcher/launcher
	views. This will naturally unfocus the current application.

	In addition this will enable home-call and home-contacts.

	* src/home/hd-render-manager.h:
	  Add STATE_TASK_NAV and STATE_LANUNCHER as NEED_DESKTOP.
	* src/home/hd-home.c:
	  Add the Input WM hint to the desktop client window to make it
	  focusable.
	* src/home/hd-render-manager.c (hd_render_manager_set_state):
	  Tiny cleanup.

2009-02-18  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-render-manager.c: In addition to my previous checkin,
	the menu button should still work when the screen is blurred
	(since that's the only time it ever appears!)

2009-02-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Applet stacking fixes.  Remedies the "applet is not activated when
	clicked" and "invisible applet is activated when clicking on an empty
	desktop" (aka. rodarvus-symptom) problems. Fixes: NB#101434

	* src/mb/hd-desktop.c (hd_desktop_stack):
	  Don't look at who is transient to the desktop but ask the active
	  home view for the list of applets.
	* src/mb/hd-home-applet.c:
	  Don't attempt to make applets transient to the desktop.
	* src/home/hd-home.c
	* src/home/hd-home.h
	* src/home/hd-home-view.h
	* src/home/hd-home-view.c:
	  Utility functions added.
	* src/home/hd-home-view-container.c:
	  Force restacking when the desktop-changing transition is complete.
	  This is because merely making the stacking dirty may not take
	  effect until the next X event.

2009-02-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-app.c (hd_app_init): Re-enable patch from Laszlo to set
	transiency of stackable windows. Fixes: NB#97313
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Add missing
	hd_render_manager_stop_transition calls when adding new actor to the
	task navigator.

2009-02-18  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_add_applet): Set the view to
	the applet data.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Get the view
	from the applet data instead of iterating the hierarchy. Fix crash.

2009-02-18  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_create_edit_button, hd_home_constructed,
	  hd_home_show_edit_button): 
	* src/mb/hd-theme.h: Replace the edit button with a themed version
	  without any text. Fixes: NB#90289, NB#101918

	* debian/changelog: Update.

2009-02-18  Alejandro Pinheiro <apinheiro@igalia.com>

	* src/a11y/launcher/hda-launcher-grid.c: simplified after CAIL changes
	
2009-02-18  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-render-manager.c: Don't add HD buttons to the input
        list if they're not reactive.  In other words, clicking an HD
        button while a system modal dialogue is up will close the dialogue.
        MB#100934.
	
2009-02-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Implement full stackable window handling.

	* src/util/hd-transition.c (hd_transition_close_app): Check that the
	secondary window is not a temporary leader.
	* src/mb/hd-theme.c (construct_buttons): Handle the case that the
	window is a secondary acting as leader.
	* src/mb/hd-app.c (hd_app_destroy): Remove content from this function.
	It is now done at the unmapping handler.
	(hd_app_init): Move stackable-related code to MapNotify handler
	because mapping time is what counts, not creation.
	* (hd_app_close_followers): Remove g_return_val_if_fail checks and
	replace the while loop with a for loop.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Code to handle
	tricky cases, like unmapping of windows from middle of the stackable
	window stack. Make sure task navigator has the right actor in all
	cases.
	(hd_comp_mgr_handle_stackable): New function, containing code from
	hd_app_init and some more to aid in the task of keeping the actor in
	task navigator up-to-date.
	(hd_comp_mgr_map_notify): Changes to keep task navigator up-to-date
	with the stackable window stack.
	(hd_comp_mgr_effect): Handle the case of secondary window acting as
	the leader.
	(hd_comp_mgr_close_app): Send delete event to the window only if it is
	the leader, otherwise hd_app_close_followers already sent it.

2009-02-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Regression fix.

	* src/mb/hd-wm.c (hd_wm_client_activate):
	  Don't leave the current state if the activated client is not a HdApp.
	  This is because in switcher view programs are free to create dialogs
	  etc. and we don't want to leave the view in this case.

2009-02-18  Alejandro Pinheiro <apinheiro@igalia.com>

	* src/a11y/launcher/hda-launcher-grid.c
	* src/a11y/launcher/hda-launcher-page.c
	* src/a11y/launcher/hda-launcher-tile.c
	Changes required after some CAIL API changes

	* src/a11y/Makefile.am
	* src/a11y/hildon-desktop-a11y.c
	* configure.ac
	* src/a11y/home: new directory
	* src/a11y/home/hda-home.[ch]: new files
	* src/a11y/home/hda-home-init.[ch]: new files
	Added a11y support for HdHome object (HdaHome)

2009-02-18  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Asynchronous application prestarting.

	* src/launcher/hd-app-mgr.c: Changed prestarting code to use async dbus calls.
	Also, small misc fixes.
	* src/launcher/hd-launcher.c: Do not consider prestarted apps as launched.

2009-02-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Regression fix, debugging features.

	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_setup_input_viewport():
	    Only consider subtracting the territory of foreground windows
	    in application and home views.  Doing so in tasw view opens
	    up the possibility of interaction with the thumbnail contents
	    with the pointer, which is fun but incorrect.
	  hd_comp_mgr_dump_debug_info():
	    Dump client window geometries.
	    Dump the input shape.

2009-02-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Task navigator cleanups.

	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c:
	  added hd_render_manager_return_app()
	  added hd_render_manager_return_dialog()
	* src/home/hd-task-navigator.h
	* src/home/hd-task-navigator.c:
	  drop the application window's actor and its dialogs in a container
	  to make it easier to hide them all at once

2009-02-18  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-wm.c: Applied Laszlo Pere's patch for bug #95018 (switch
	  to app mode when application is activated). Also fixes #99100

2009-02-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	  Now remove any notifications and dialogs that are in front of the
	  desktop from the input mask area for the buttons. NB#101613

2009-02-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	  Moved initialisation of hd-app-manager to allow it to add a signal
	  to hd-render-manager
	* src/home/hd-render-manager.c:
	  Modified calls to avoid clutter warnings when actors had/didn't have
	  parents

2009-02-17  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.h (STATE_DISCARD_PREVIEW_NOTE):
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_register_client,
	  hd_comp_mgr_map_notify): Discard previews if there is an fullscreen
	  application is shown. Fixes: NB#97230
	
	* debian/changelog: Update.

2009-02-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-task-navigator.c: Modified g_return_if_fail check
	to normal 'if' and comment (return_if_fail does nothing now)

2009-02-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* hd-comp-mgr.c: Added check in restack to detect apps above the
	desktop and switch to app mode.

2009-02-17  Alejandro Pinheiro <apinheiro@igalia.com>

	* configure.ac
	* debian/rules
	* src/main.c
	* src/ally: new directory

	Added a11y support for hildon-desktop. The a11y support is not compiled
	by default. You need to pass --enable-a11y to the configure, ie:
	  * ./autogen.sh --enable-a11y
	  * Add a11y to the DEB_BUILD_OPTIONS when using dpkg-buildpackage

	Fixes NB#93169

2009-02-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added D-Bus interface to remotely launch applications.
	For NB#100519

	* src/home/hd-switcher.c: Receive relaunched signal from HdAppMgr.
	* src/launcher/Makefile.am:
	* src/launcher/hd-app-mgr-dbus.xml: Inteface definition for HdAppMgr.
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-app-mgr.h:
	* src/launcher/hd-launcher-tree.c: Added method to find an item by id.
	* src/launcher/hd-launcher-tree.h:
	* src/mb/hd-comp-mgr.c: Create the HdAppMgr before HdSwitcher.

2009-02-16  Gordon Williams <gordon.williams@collabora.co.uk>
	
	NB#99127 - Home Edit Background not blurred
	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher.c:
	Remove back arrow and use HdTitleBar's back button instead	  
	* src/home/hd-title-bar.c:	
	button highlighting for right-hand buttons
	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h:
	Use HdTitleBar back button instead of launcher/edit back buttons,
	and ignore back button for input viewport if in app mode.	
	* src/home/hd-home.h
	* src/home/hd-home.c
	* src/home/hd-home-view.c
	* src/home/hd-home-view.h:
	Remove back arrow and use HdTitleBar's back button instead.
	Add applets_container to new 'front' group, which can be pulled
	in front of home blurring for edit mode.

2009-02-16  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Regression fixes.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client):
	  Restored workaround to make HDRM reactive again when the latest
	  known system-modal dialog is gone,
	* src/home/hd-render-manager.c (hd_render_manager_update_blur_state):
	  Blur/unblur home when a confirmation note is mapped/unmapped.

2009-02-16  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.h (STATE_SHOW_OPERATOR): Do not show the
	operator applet in edit mode. Fixes: NB#100746

	* debian/changelog: Update.

2009-02-16  Gordon Williams <gordon.williams@collabora.co.uk>

	*  src/home/hd-clutter-cache.c:
	Support for XY texture expansion

2009-02-13  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-dialog.c (hd_dialog_init): Support undecorated dialogs by
	not adding decor geometry to their size. Fixes: NB#101816

2009-02-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h:
	Added hd_render_manager_update_blur_state, which intelligently checks
	if a view should be blurred or not. NB#100590
	* src/mb/hd-comp-mgr.c
	* src/mb/hd-comp-mgr.h:
	Changes to use hd_render_manager_update_blur_state
	Changes to stop HD_COMP_MGR_CLIENT_IS_MAXIMIZED accidentally classing
	the 'crash' dialog as a fullscreen client and blurring it

2009-02-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#100551

	* src/mb/hd-note.h:
	  Added macros for all note types.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify):
	  Test for specific client types (sysmodal dialog, info note,
	  confirmation) rather than "all except ..." when deciding
	  whether to leave for home from tasw/talu.  The previous test
	  cause us to change state when a new banner was mapped.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect):
	  Blur/unblur when a comfirmation/info note is mapped/unmapped.

2009-02-13  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.20

2009-02-13  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Set correct xsession script number to 05 as NB#101224 says.

	* debian/rules:

2009-02-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home.c:
	  Fixed broken notify for progress indicator - didn't mark the decor
	  as dirty so it never got redrawn.
	* src/mb/hd-decor-button.c:
	  Removed previous press/release notifies, as now works fine when called
	  from hd-theme
	* src/home/hd-title-bar.c
	* src/home/hd-title-bar.h
	* src/mb/hd-theme.c
	* src/mb/hd-decor.c
	* src/mb/hd-decor.h:
	  Added button paint handler, and make sure buttons and title bars are
	  synced when repainted. Also added call to hd-title-bar from hd-decor
	  to update it if the relevant decor is synced.

2009-02-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#100952
	Don't go to switcher view if a closed application wasn't
	the topmost one.

	* src/home/hd-render-manager.c
	* src/home/hd-switcher.c
	* src/mb/hd-wm.c
	* src/mb/hd-wm.h
	* src/mb/hd-comp-mgr.c

2009-02-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added an xsession script for hildon-desktop. NB#101224

	* debian/control:
	* debian/hildon-desktop.xsession:
	* debian/rules:

2009-02-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Reworked a bit to blink the tasks button when the text
	  of a groupped notification changes.

2009-02-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Coverity fixes:
	* src/home/hd-scrollable-group.c (hd_scrollable_group_parent_changed):
	Initialise width and height.
	* src/tidy/tidy-frame.c (tidy_frame_remove_actor): Set the child NULL
	after unreferencing it, not before.
	* src/tidy/tidy-style.c (tidy_style_set_effect_valist): Remove unused
	variable 'param.name'.

2009-02-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-title-bar.h
	* src/home/hd-title-bar.c:
	  Allowed left_pressed to be used from outside (bug 101522)
	* src/home/hd-render-manager.c:
	  Added sync_after function, to change clutter visibilities if they
	  are needed to be done after a transition ends. Fixes bug with
	  zoomed button.
	* src/tidy/tidy-blur-group.c:
	  Added vignette effect for when zooming out
	* src/mb/hd-decor-button.c
	* src/mb/hd-decor-button.h:
	  Cleaned up and added handler for new matchbox press + release
	  signals, to make right buttons highlight correctly.

2009-02-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-title-bar.c (hd_title_bar_set_switcher_pulse):
	  Typo correction to not corrupt HdTitleBar::state when the last
	  notification is closed.

2009-02-11  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	  Now check if home_blur has really changed, and only update if it
	  has. This saves a ~150ms recalc of the blur texture
	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h
	* src/mb/hd-remote-texture.c:
	  Bugfixing and making remote-texture more like animation-actor
	  (It couldn't be treated like a window and still behave the way
	  we needed it to)

2009-02-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#96795

	This is an old bug (tasks button accessible while sysmodal in front)
	but reappeared with HdTitleBar.  HDRM made the wrong actors unreactive.

	* src/home/hd-title-bar.c:
	  Removed dummy HdTitleBar::btn_switcher and ::btn_launcher, which
	  were taken over by buttons[BTN_SWITCHER] and buttons[BTN_LAUNCHER].
	  Make HDRM use these latter actors.
	* src/home/hd-render-manager.c:
	  Don't change the visibility of HDRM_BUTTON_TASK_NAV and
	  HDRM_BUTTON_LAUNCHER but leave it completely up to HdTitleBar.
	  Don't reparent them either.

2009-02-11  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Make application killing dialog look for the app's localized name.
	NB#89600

	* src/launcher/hd-launcher-item.c: Added method to get the localized name
	for a HdLauncherItem.
	* src/launcher/hd-launcher-item.h:
	* src/launcher/hd-launcher.c: Get the localized name directly.
	* src/mb/hd-comp-mgr.c: Added method to get the localized name of the app
	if it's present.
	* src/mb/hd-comp-mgr.h:
	* src/mb/hd-wm.c: Use the app's localized name if it's known.

2009-02-11  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-title-bar.c:
	  Now don't error if no hd-decor, and instead remove the title bar
	* src/tidy/tidy-mem-texture.c (Added)
	* src/tidy/tidy-mem-texture.h (Added)
	* src/tidy/Makefile.am:
	  Added tiled texture that works from a memory area
	* src/mb/hd-remote-texture.c (Added)
	* src/mb/hd-remote-texture.h (Added)
	* src/mb/Makefile.am:
	  New Remote texture window type that handles rendering a shared
	  memory area as a window.
	* src/mb/hd-atoms.c
	* src/mb/hd-atoms.h:
	  New atoms for remote texture control via X
	* src/mb/hd-wm.c
	* src/mb/hd-wm.h:
	  Added HdWmClientTypeRemoteTexture window type

2009-02-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect):
	  Put back accidentally disabled slide-in transition
	  of notification previews.

2009-02-10  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Show an string in empty task launcher categories.
	Fixes: NB#100588
	
	* src/launcher/hd-launcher-item.c: Added missing 'break'.
	* src/launcher/hd-launcher-page.c:

2009-02-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#98542, NB#95193

	* src/home/hd-title-bar.h (HDTB_VIS_BTN_SWITCHER_HIGHLIGHT):
	  New internal top-left button state to signify that the the tasks
	  button hilight shouldn't be cleared because there are unconfirmed
	  notifications in tasw.
	* src/home/hd-title-bar.c:
	  hd_title_bar_set_state(): take advantage of the new state
	  hd_title_bar_set_switcher_pulse():
	    Stop pulsating after two cycles and leave the tasks button
	    highlighted.  Continue the animation from that point unless
	    the button was reset.
	* src/home/hd-task-navigator.h (hd_task_navigator_has_notifications):
	  New interface exported just in case.
	* src/home/hd-task-navigator.c:
	  Reset the top-left button animation at appropriate times.
	  Signal all incoming event notifications, not only the first one.

2009-02-10  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.19

2009-02-10  Jan Arne Petersen  <jpetersen@openismus.com>
	
	Increase size of edges in layout mode to move applets between views.
	Fixes: NB#96802

	* src/home/hd-home.h (HDH_SWITCH_WIDTH): Double the width of the
	edges.

2009-02-10  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-app.c: comment out Laszlo's transiency setting code for
	now to fix the CallUI issue.

2009-02-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* tests/test-portrait-win.c:
	  Added the option to test fullscreen mode as well.

2009-02-10  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c (hd_render_manager_create):
	  Resize HdHome when rotating the screen.  If we leave it 800x480
	  all the times set_visibilities() won't believe that it's obscured
	  in application view and leaves it visible.  Then any (= all)
	  applets not supporting portait mode will cause us to rotate
	  the screen back to landscape momentary when a new portrait-capable
	  window is mapped in portrait mode.
	* src/home/hd-home.c:
	  Syntax hilighting correction.

2009-02-09  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Update.

2009-02-09  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Update.

2009-02-09  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c
	* src/util/hd-transition.h:
	Moved progress indicator animation code to save duplication
	* src/home/hd-title-bar.c:
	Added progress indicator animation code for main title bar
	* src/mb/hd-decor.c
	* src/mb/hd-decor.h:
	Changed to use hd-transition for progress indicator, and allowed
	hd-title-bar to use hd_decor_is_waiting

2009-02-09  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/hildon-desktop.postinst:
	* src/Makefile.am:
	* src/hildon-desktop.schemas (deleted): Remove default backgrounds
	.schema. Fixes: NB#101138.

	* src/hildon-desktop-views.schemas: Update default active views.

	* src/home/hd-home-view.c (hd_home_view_gconf_bgimage_notify): Load
	background images from theme if not available in GConf.

2009-02-09  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	12:34 < kuzak> androide, I think there is a bug in your bug fix: if
	               you kill fullscreen
	               application (e.g. application manager), next time you
		       go to Home, Status Area has vanished

	* src/home/hd-render-manager.c (hd_render_manager_sync_clutter):
	  Consider has_fullscreen only if STATE_IS_APP().

2009-02-09  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Handle fullscreen without forcing clients into one layer or other.
	NB#100720

	* src/mb/hd-app.c:
	  Removed stacking_layer() override.
	* src/mb/hd-comp-mgr.h
	* src/mb/hd-comp-mgr.c:
	  Removed hd_comp_mgr_set_status_area_stacking().
	* src/mb/hd-status-area.c:
	  Removed the LayoutPrefPositionFree layout hint to make it
	  possible to move the client out of screen.  With this flag set
	  the layout manager doesn't permit that.
	* src/home/hd-render-manager.c (hd_render_manager_set_visibilities):
	  Search the whole stack for fullscreen apps.  Introduced has_fullsreen.
	  Rather than influencing its stacking layer move the status area
	  at the same time front_blur is shown/hidden.

2009-02-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-theme.c (construct_buttons): Use stack index instead of a
	boolean to allow distinguishing non-stackables from secondary windows.
	* src/mb/hd-app.c (hd_app_init): Add asserts to the end of the
	function to enforce certain invariants for stackable windows. Make
	stackable handling more robust.
	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Prepare for the case
	of replacing a stackable window in the middle of a window stack. This
	is done by checking whether the mapped window is on top of the stack.
	The HD restart case requires asking Task Navigator about its knowledge
	of the stackable windows. Removed some g_return_if_fails and replaced
	one with g_assert (silent ignoring of internal inconsistency is the
	worst coding style).

2009-02-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-clutter-cache.c (hd_clutter_cache_class_init): Remove
	g_type_class_add_private call for an empty struct, fixes Glib CRITICAL.
	* src/mb/hd-app.h: Replace secondary_window with stack_index, which is
	based on the value set by the HildonStackableWindow widget.
	* src/util/hd-transition.c (hd_transition_close_app),
	src/mb/hd-theme.c (construct_buttons),
	src/mb/hd-app.c (hd_app_destroy, hd_app_init),
	src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Use the new
	stack_index member instead of secondary_window.
	* src/mb/hd-comp-mgr.c: White-space and typo fixes. Added FIXMEs.
	* src/home/hd-render-manager.c (hd_render_manager_set_visible):
	Don't call hd_render_manager_set_input_viewport with an argument,
	it does not take any.
	* src/mb/hd-desktop.c (hd_desktop_realize): Remove unnecessary
	reparenting. (If it is needed, it should be done in libmatchbox side.)

2009-02-06  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (PAN_NEXT_PREVIOUS_PERCENTAGE,
	  hd_home_desktop_release): Set Home panning threshold to 40%.

2009-02-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Little cleanups.

	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c:
	  Removed now superseded hd_render_manager_update_tasks_button().
	* src/home/hd-task-navigator.c:
	  Removed calls to clutter_stage_set_key_focus().
	* src/mb/hd-note.h:
	  Added HD_IS_INCOMING_EVENT_*_NOTE() as shortcuts to check the
	  ::note_type at once.
	* src/mb/hd-comp-mgr.c:
	  Use them.

2009-02-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Added command line option `-r' not to worry if a window manager
	is already running but try to take it over.

	* src/main.c (main):
	  Change the hidden root window name to "hildon-desktop".

2009-02-05  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Respect HILDON_DESKTOP_APPS_PRESTART in scratchbox.

	* src/launcher/hd-app-mgr.c (hd_app_mgr_setup_prestart):

2009-02-05  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-title-bar.c:
	Minor change to left-align application titles

2009-02-05  Gordon Williams <gordon.williams@collabora.co.uk>

	These changes require the new theme style, and depend on the 
	symbolic link /etc/hildon/theme being set.

	* src/home/hd-clutter-cache.h
	* src/home/hd-clutter-cache.c:
	Added ability to load a full texture, but still allow it to be 
	stretched while keeping the ends intact.
	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c
	* src/home/hd-task-navigator.c:
	Allowed render manager to update button state in hd-title-bar,
	and made task-navigator update the top-left button at the correct
	time for new notifications.
	* src/home/hd-title-bar.c
	* src/home/hd-title-bar.h
	* src/mb/hd-theme.h:
	Added new themed toolbar and buttons - moved full-screen toolbar
	into hd-title-bar. Added pulsing glow effect for when there are
	notifications.	
	* src/mb/hd-decor-button.h
	* src/mb/hd-decor-button.c:
	Moved rendering code to hd-title-bar, which handles all buttons
	* src/mb/hd-decor.c
	* src/mb/hd-decor.h:
	Moved rendering of title to hd-title-bar for apps. Added progress
	indicator using new themed graphics

2009-02-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#98365

	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c:
	  hd_render_manager_update_tasks_button() added to synchronize
	  the content of the top-left button.
	* src/mb/hd-comp-mgr.c:
	  Make sure the top-left button is showing the tasw/talu icon
	  as appropriate when an incoming event notification is mapped
	  or unmapped.
	* src/home/hd-task-navigator.c (load_icon):
	  Typo fix.

2009-02-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/launcher/hd-app-mgr.c (hd_app_mgr_prestart):
	  New debugging feature: if the $HD_NOPRELOAD environment variable
	  is set do not prestart applications at all.

2009-02-04  Jan Arne Petersen  <jpetersen@openismus.com>

	Do not show notification previews if in switcher. Fixes: NB#99892.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Delete preview
	windows if in switcher.

	* debian/changelog: Update.

2009-02-03  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	New and improved HdAppMgr for NB#98239.

	* src/home/hd-render-manager.c: Added a property 'state', now changes
	in state can be tracked with a signal.
	* src/home/hd-render-manager.h:
	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-app-mgr.h:
	* src/launcher/hd-launcher-app.c: Removed debugging output.
	* src/launcher/hd-launcher.c: Moved prestarting to HdAppMgr.
	* src/mb/hd-comp-mgr.c: Moved low memory management to HdAppMgr.
	* src/mb/hd-comp-mgr.h:
	* src/util/hd-dbus.c: Removed memory signals.

2009-02-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Added new D-BUS signal com.nokia.hildon_desktop.exit_app_view for RR
	to be able to switch to task switching view.  The signal has no effect
	if sent in non-application view.

	* src/home/hd-switcher.h
	* src/mb/hd-comp-mgr.c:
	  Removed some obsoleted definitions and declarations.
	* src/util/hd-dbus.c:
	  Signal handler added.

2009-02-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Made window hibernation and hibernated window selection
	in switcher view usable.

	* src/home/hd-task-navigator.c:
	  Resurrect hd_task_navigator_hibernate_window().
	  Removed support for hibernated window decoration.
	* src/home/hd-switcher.c (hd_switcher_zoom_in_complete):
	  Crashed when the selected thumbnail belonged to a now
	  hibernated client.
	* src/launcher/hd-app-mgr.c (hd_app_mgr_service_top):
	  Thinko correction: dbus_message_append_args() takes pointers
	  to arguments, even if the argument is a pointer itself.

2009-02-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.18

2009-02-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.h:
	  Allow clients/actors wider than SCREEN_WIDTH to be considered
	  IS_MAXIMIZED.  Failing so the actor may be parented to app_top
	  by mistake, causing the tasks button to disappear.
	* src/home/hd-render-manager.c:
	  Removed unnecessary full redraw requests when switching between
	  landscale/portrait modes.
	  

2009-02-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#94308

	* src/mb/hd-wm.c (hd_wm_get_current_app):
	  Don't be clever about picking the right client.  Earlier we skipped
	  transients and secondary windows in the belief that they are not a
	  different application but it turns out libhildon has a different
	  conception what belongs to an application what doesn't.

2009-02-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-app.c (hd_app_stacking_layer):
	  Take the fullscreenness of the transients into consideration
	  when determining the stacking layer.

2009-02-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/util/hd-transition.c (hd_transition_subview): Check if the views
	have cm_clients at all before using them.
	* src/mb/hd-app.c (hd_app_init): Read XA_INTEGER instead of XA_STRING
	when reading the stackable window property.

2009-02-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* test/portrait-common.c
	* test/test-portrait-dlg.c
	* test/test-portrait-win.c:
	  New test programs.
	* test/test-portrait.c:
	  Obsolete, removed.

2009-02-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Initial support for portrait mode.

	* configure.ac:
	* debian/control:
	  Declared dependency on libxrandr-dev

	* src/launcher/hd-app-mgr.h
	* src/launcher/hd-app-mgr.c:
	  New debugging function: hd_app_mgr_dump_app_list()
	* src/mb/hd-atoms.h
	* src/mb/hd-atoms.c:
	  New atoms: _HILDON_PORTRAIT_MODE_REQUEST and _HILDON_PORTRAIT_MODE_SUPPORT.
	* src/mb/hd-app.c:
	  Removed the show(), hide() and focus() overrides that changed the state
	  to APP_FULLSCREEN.  Instead override MBWindowManagerClient::stacking_layer.
	* src/home/hd-switcher.h
	* src/home/hd-switcher.c:
	  Removed status area and menu handing and some interaction with home.
	* src/home/hd-home.h
	* src/home/hd-home.c:
	  Removed status area allocation tracking.
	* src/mb/hd-status-area.c:
	  Take the visibility of the Tasks button into account when configuring
	  the inital geometry of the client.
	* src/mb/hd-dialog.c:
	  Process all ->geometry() calls not only the ones changing the height
	  of the dialog.
	* src/home/hd-task-navigator.c:
	  Don't break if the WM was started in portrait mode.

	* src/launcher/hd-launcher-page.h
	* src/launcher/hd-launcher-grid.c
	* src/launcher/hd-launcher.c
	* src/home/hd-home.c
	* src/home/hd-home-view.c:
	  Always assume landscape orientation.

	* src/home/hd-render-manager.h
	* src/home/hd-render-manager.c:
	  hd_render_manager_set_input_viewport():
	    Block the status area in portrait mode.
	  hd_render_manager_set_order():
	    Added HDRM_STATE_APP_PORTRAIT,
	    recalculate the position of the oplogo, status area and app title,
	    cleanups.
	  hd_render_manager_get_visible():
	    Allow querying the visibility of the tasks button.
	  hd_render_manager_set_state():
	    Placeholder added for the actual rotation.
	    Be smart and if circumstances allow go to PORTRAIT if we'd go to APP.
	  hd_render_manager_place_titlebar_elements():
	    Aded for the status area, oplogo and the app title.
	  hd_render_manager_is_visible():
	    Reworked.
	  hd_render_manager_init():
	    Monitor the size of the stage and synchronize
	    the private containers' size with it.

	* src/mb/hd-comp-mgr.h:
	  Made HD_COMP_MGR_SCREEN_WIDTH and HD_COMP_MGR_SCREEN_HEIGHT reflect
	  the current screen dimensions.  Added HD_COMP_MGR_LANDSCAPE_* for
	  the fixed values.
	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_client_property_changed():
	    Monitor the PORTRAIT properties of all clients.
	  hd_comp_mgr_restack():
	    Change to/from portrait mode if necessary because of a new/gone client.
	  hd_comp_mgr_dump_debug_info():
	    Include the stacking layer and actor size in the dump.
	    Also print the list of known running applications.

2009-02-01  Jan Arne Petersen  <jpetersen@openismus.com>

	Add support for special operator applet. Fixes NB#93997

	* src/home/hd-home.c (operator_applet, hd_home_constructed,
	  hd_home_set_operator_applet, hd_home_fixup_operator_position):
	* src/home/hd-home.h: Replace set_operator_icon and set_operator_label
	function with a function to set the operator applet.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Set the operator
	applet instead of adding the applet to a home view.

	* src/mb/hd-home-applet.c (hd_home_applet_init): Do not store the
	operator applet to GConf.

	* debian/changelog: Update.

2009-01-31  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Some fixes to 'application not responding' dialog implementation.

	* src/mb/hd-wm.c (hd_wm_client_responding): Show a Hildon banner when
	client is responsive again.
	(hd_wm_make_dialog): New function to create 'application not
	responding' dialog.
	(hd_wm_client_hang): Call hd_wm_make_dialog and handle the response.

2009-01-29  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.h (STATE_SHOW_STATUS_AREA): Do not show
	status area in edit mode. Fixes NB#93642, NB#96951

	* debian/changelog: Update.

2009-01-29  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	Removed 1px border, added rounding. The fix will rely on the new
	rounding changes to clutter.

2009-01-29  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	Fix for 98336, 98577, 98393 - now update a 1px border around the
	damaged area.

2009-01-29  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c:
	Now unrefs objects that matchbox refs
	Removed scroll-out part of subview transition for now (to get 
	around Image Viewer unresponsiveness problems)

2009-01-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-app.c (hd_app_init): Patch from Laszlo to set transiency
	of stackable windows. Fixes: NB#97313

2009-01-29  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/util/hd-dbus.c:
	  Removed com.nokia.osso_app_killer.kill.
	* src/mb/hd-comp-mgr.c: hd_comp_mgr_hibernate_client()
	  Don't WM_DELETE but SIGTERM the applications.

2009-01-29  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-clutter-cache.h (Added)
	* src/home/hd-clutter-cache.c (Added)
	* src/home/Makefile.am:
	To allow textures (Eg. for buttons/title bars) to be cached
	* src/home/hd-render-manager.c
	* src/home/hd-switcher.c
	* src/home/hd-render-manager.h
	* src/home/hd-switcher.h
	* src/home/hd-title-bar.h (Added)
	* src/home/hd-title-bar.c: (Added)
	Class to encapsulate things to go in top bar for h-d. Currently
	the launcher/switcher buttons. Will handle animation of them +
	theming shaped background for status area 
	* src/tidy/tidy-sub-texture.c (Added)
	* src/tidy/tidy-sub-texture.h (Added)
	* src/tidy/Makefile.am:
	Special clutter class to show only a small part of a bigger texture.
	Used for theming with clutter.
	* src/mb/hd-theme.c:
	Removal of all rendering code. Added code that works with clutter to
	hd-decor and hd-decor-button
	* src/mb/hd-decor.c
	* src/mb/hd-decor.h:
	Addition to create the required decor using clutter, adding it to
	the clutter group containing the texture (requires libmatchbox as
	of 28-1-09)
	* src/mb/hd-decor-button.c (Added)
	* src/mb/hd-decor-button.h (Added)
	* src/mb/Makefile.am:
	Extension of MBWMDecorButton to create clutter buttons not X buttons

2009-01-29  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/hildon-desktop.conf: Update category.

2009-01-28  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/hildon-desktop.install:
	* src/Makefile.am:
	* src/hildon-desktop.conf: Add backup configuration. Fixes NB#96920.

	* debian/changelog: Update.

2009-01-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#92409 -- application killer signal

	* src/util/hd-dbus.c:
	  New signal com.nokia.osso_app_killer.kill to kill all known
	  applications wheher they can hibernate or not.
	* src/mb/hd-comp-mgr.c:
	  Send WM_DELETE to HdAppMgr's SHOWN applications rather than
	  all managed clients to save the life of hh, hsm and systemui.
	* src/home/hd-task-navigator.c:
	  Temporarily disabled the handling of hibernated applications
	  until it's done properly.

2009-01-26  Jan Arne Petersen  <jpetersen@openismus.com>

	When a task is open, access the Home view by long pressing the Tasks
	button. Fixes NB#88401

	* src/home/hd-switcher.c (hd_switcher_constructed): connect switcher
	  buttons to button-press and leave events.
	  (hd_switcher_dispose): Remove long press timeout.
	  (hd_switcher_clicked): Only do something if there was no long
	  press.
	  (press_timeout_cb, hd_switcher_press): Add long press timeout.
	  (hd_switcher_leave): Remove long press timeout.
	
	* debian/changelog: Update.

2009-01-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.17-1

2009-01-23  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Track application pids.

	* src/launcher/hd-app-mgr.c: Set the correct pid when launching/waking
	up apps.
	* src/launcher/hd-launcher-app.c:
	* src/launcher/hd-launcher-app.h: Added methods to get/set an app pid.

2009-01-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/Makefile.am, src/mb/hd-animation-actor.[ch]: New files
	to implement WM-assisted animations class hd-animation-actor.
	* src/mb/hd-atoms.[ch]: Add new atoms for hd-animation-actor.
	* src/mb/hd-wm.c: Detect hd-animation-actor.

2009-01-23  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-theme.c:
	  Don't assume absolute decor placement if we're not using the
	  simple hildon theme.  Since we're using the "hildon" engine now
	  in theme.xml (as opposed to "hildon-simple") that caused the
	  buttons to be fixed at (-1, -1), diregarding their packing.

2009-01-23  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Laszlo:
	* src/mb/hd-theme.c: Do not modify the global variable left_padding,
	it leads to "crawling title". Fixes: NB#95155

2009-01-22  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Update. NB#99030 is fixed, too.

2009-01-22  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Moved flags in HdLauncherApp to a state variable.
	Also removed a lot of old debugging output.

	* src/launcher/hd-app-mgr.c:
	* src/launcher/hd-launcher-app.c:
	* src/launcher/hd-launcher-app.h:
	* src/launcher/hd-launcher-grid.c:
	* src/launcher/hd-launcher-page.c:
	* src/launcher/hd-launcher-tile.c:
	* src/launcher/hd-launcher-tree.c:
	* src/launcher/hd-launcher.c:
	* src/mb/hd-comp-mgr.c:

2009-01-22  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/hildon-desktop-cud.sh:
	* src/hildon-desktop-rfs.sh: Add scripts to clear user data and reset
	to factory settings. Fixes NB#98971

	* debian/hildon-desktop.install:
	* debian/rules:
	* src/Makefile.am: Install cud and rfs scripts.

	* debian/changelog: Update.

2009-01-22  Jan Arne Petersen  <jpetersen@openismus.com>

	* configure.ac: Remove libhildondesktop1 dependency. Add gnome-vfs
	  dependency.

	* debian/changelog: Update.

	* src/mb/hd-desktop.c (hd_desktop_destroy, hd_desktop_init,
	  current_theme_changed):
	* src/mb/hd-desktop.h: Monitor /etc/hildon/theme for theme changes.
	  Fixes NB#98196, NB#98302

2009-01-21  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Add a single define for the default icon, update it to spec.

	* src/launcher/hd-launcher-item.c:
	* src/launcher/hd-launcher-page.c:
	* src/launcher/hd-launcher-tile.c:
	* src/launcher/hd-launcher.h:

2009-01-21  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h:
	  Added HDRM_STATE_HOME_EDIT_DLG state for home edit dialogs
	* src/mb/hd-comp-mgr.c:
	  Added code to change to and from HDRM_STATE_HOME_EDIT_DLG
	  at the correct times to allow us to return to the home edit
	  mode.

2009-01-21  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Localized applications.desktop.

	* data/desktop/applications.desktop:

2009-01-21  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Update. NB#98807 is fixed.

2009-01-21  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c
	* src/tidy/tidy-blur-group.h:
	  Added a convenience function to see if a blur group is actually 
	  buffering the picture of it's children
	* src/mb/hd-comp-mgr.c:
	  Changes to do a full-screen update and kick the blur actor if an
	  actor that is blurred needs update. Fix for 98298

2009-01-21  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (SETTINGS_BUTTON, applet_settings_button,
	  hd_home_applet_close_button_clicked,
	  hd_home_applet_settings_button_clicked, hd_home_constructed,
	  hd_home_show_applet_buttons, hd_home_hide_applet_buttons): Add
	  support for the settings button.

	* src/mb/hd-atoms.c (hd_atoms_init):
	* src/mb/hd-atoms.h (HD_ATOM_HILDON_APPLET_SETTINGS,
	  HD_ATOM_HILDON_APPLET_SHOW_SETTINGS): Add new atoms.

	* src/mb/hd-home-applet.c (hd_home_applet_init):
	* src/mb/hd-home-applet.h (settings): Read settings property from
	  applet window.

2009-01-20  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Updated. NB#98719 is fixed.

2009-01-20  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-task-navigator.c:
	  Support for app titles containing tags
	* src/util/hd-transition.c
	* src/util/hd-transition.h
	* src/mb/hd-note.c
	* src/mb/hd-comp-mgr.c:
	  Addition of animations for notifications and secondary windows	
	* src/mb/hd-app.c:
	  Fix for broken pointers in hd-app::leader	
	* src/mb/hd-decor.c
	* src/mb/hd-decor.h
	* src/mb/hd-theme.c:
	  Fix for SIGSEGV caused by progress indicator

2009-01-20  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client,
	  hd_comp_mgr_map_notify): Close the status menu if any window (except
	  an applet) is mapped.

2009-01-20  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_applet_motion,
	  hd_home_view_applet_release, hd_home_view_restack_applets,
	  hd_home_view_move_applet): Implement proper moving of applets
	  between views. Fixes NB#88327, NB#95452, NB#96802

	* src/home/hd-home.c (hd_home_add_applet): Respect default value for
	  GConf view key.

	* debian/changelog: Update.

2009-01-20  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (move_applet_left_timeout_cb,
	  move_applet_right_timeout_cb, hd_home_view_applet_motion,
	  hd_home_view_applet_press, hd_home_view_applet_release): Implement
	  switching edges highlighting like in the Home UI Spec.

	* src/home/hd-home.c (_hd_home_do_normal_layout,
	  hd_home_show_switching_edges, hd_home_hide_switching_edges,
	  hd_home_highlight_switching_edges):
	* src/home/hd-home.h: Rename switching edges functions.

2009-01-20  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_applet_motion,
	  hd_home_view_applet_press, hd_home_view_applet_release): Does not
	  allow applet to leave permitted area on drag in layout mode. Fixes
	  NB#88390

	* src/home/hd-home.c (hd_home_show_applet_buttons):
	* src/home/hd-home.h: Allow to call hd_home_show_applet_buttons()
	  multiple times with the same applet. Rewmove unused
	  hd_home_move_applet_buttons().

	* debian/changelog: Update.

2009-01-20  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_update_previous_and_next_view,
	  hd_home_view_container_update_active_views, views_active_notify_func,
	  hd_home_view_container_constructed,
	  hd_home_view_container_set_current_view): Also update previous and
	  next view when active views but not current view changed.

2009-01-19  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_constructed): Add left and right switch
	to edit group. Fixes: NB#98209.

	* debian/changelog: Update.

2009-01-19  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Update. NB#96219 is fixed, too.

2009-01-19  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_update_views): Close all applets from a
	  deactivated view. Fixes: NB#95445, NB#94082

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h: Store applet data in a HashTable instead of
	  the object data.

	* src/home/hd-home.c (hd_home_applet_close_button_clicked,
	  hd_home_close_applet): Add function to close an applet.
	  (hide_cb, hd_home_show_applet_buttons,
	  hd_home_hide_applet_buttons): Use more mature method to hide the
	  close button together with the applet.
	* src/home/hd-home.h:

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Use a more
	mature methode to unregister an applet.

	* debian/changelog: Update.

2009-01-19  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_desktop_key_press): Fix calling from
	Home.

2009-01-18  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-theme.c: Titlebar width is relative to size of status area.

2009-01-16  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h
	* src/launcher/hd-launcher-grid.c
	* src/launcher/hd-launcher-grid.h
	* src/launcher/hd-launcher.c
	* src/home/hd-switcher.c
	* src/mb/hd-applet-layout-manager.c
	* src/mb/hd-status-menu.c
	* src/mb/hd-comp-mgr.h
	* src/mb/hd-status-area.c:
	Moved hard-coded references to screen width, height and button sizes
	to refer to the #defines in hd-comp-mgr
	* src/mb/hd-note.c:
	Made IncomingEventPreview notes keep their original size, and be
	positioned at the top of the screen - as per UI Layout guide

2009-01-16  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Application and window matching.
	This commit just adds the basic framework for the new HdAppMgr. Future
	commits will add more functionality.
	Fixes NB#89108

	* src/home/hd-switcher.c (in_transition, hd_switcher_constructed,
	  hd_switcher_relaunch_app, hd_switcher_zoom_in_complete): Go to the
	  task switcher and zoom in on the relaunched app.
	* src/launcher/Makefile.am: Add hd-app-mgr.[c,h]
	* src/launcher/hd-app-mgr.c (I_, _HdAppMgrPrivate, tree, dbus_proxy,
	  HD_APP_MGR_GET_PRIVATE, APP_LAUNCHED, APP_APPEARED, LAST_SIGNAL,
	  app_mgr_signals, LOWMEM_PROC_ALLOWED, LOWMEM_PROC_USED,
	  LOWMEM_LAUNCH_THRESHOLD_DISTANCE, OSSO_BUS_ROOT, OSSO_BUS_TOP,
	  PATH_NAME_LEN, DBUS_NAMEOWNERCHANGED_SIGNAL_NAME, the_app_mgr,
	  hd_app_mgr_get, hd_app_mgr_class_init, hd_app_mgr_init,
	  hd_app_mgr_dispose, hd_app_mgr_launch, hd_app_mgr_relaunch,
	  hd_app_mgr_prestart, hd_app_mgr_wakeup, OOM_DISABLE,
	  _hd_app_mgr_child_setup, hd_app_mgr_execute, hd_app_mgr_service_top,
	  hd_app_mgr_memory_available, hd_app_mgr_dbus_name_owner_changed,
	  hd_app_mgr_match_window):
	* src/launcher/hd-app-mgr.h (__HD_APP_MGR_H__, HD_TYPE_APP_MGR,
	  HD_APP_MGR, HD_IS_APP_MGR, HD_APP_MGR_CLASS, HD_IS_APP_MGR_CLASS,
	  HD_APP_MGR_GET_CLASS, HdAppMgr, HdAppMgrPrivate, HdAppMgrClass,
	  _HdAppMgr, parent_instance, priv, _HdAppMgrClass, parent_class):
	* src/launcher/hd-launcher-app.c (HD_DESKTOP_ENTRY_WM_CLASS, wm_class,
	  prestart_mode, launched, loading, hibernating, main_comp_mgr_client,
	  hd_launcher_app_finalize, hd_launcher_app_parse_keyfile,
	  hd_launcher_app_get_loading_image, hd_launcher_app_get_wm_class,
	  hd_launcher_app_get_prestart_mode, hd_launcher_app_is_launched,
	  hd_launcher_app_set_launched, hd_launcher_app_is_loading,
	  hd_launcher_app_set_loading, hd_launcher_app_is_hibernating,
	  hd_launcher_app_set_hibernating, hd_launcher_app_get_comp_mgr_client,
	  hd_launcher_app_set_comp_mgr_client): Added app lifecycle and window
	  data. This API is not yet finalized.
	* src/launcher/hd-launcher-app.h (__HD_LAUNCHER_APP_H__, parent_class,
	  HdLauncherAppPrestartMode):
	* src/launcher/hd-launcher.c (APP_RELAUNCHED, launcher_signals,
	  hd_launcher_class_init, hd_launcher_application_tile_clicked,
	  hd_launcher_lazy_traverse_tree, hd_launcher_transition_app_start,
	  hd_launcher_transition_new_frame, hd_launcher_get_tree): Removed
	  application management (which goes to HdAppMgr) and added support
	  for re-launching apps.
	* src/launcher/hd-launcher.h (__HD_LAUNCHER_H__, parent_class):
	* src/mb/hd-comp-mgr.c (BLUR_FOR_WINDOW, HdCompMgrPrivate, desktop,
	  render_manager, app_mgr, app, hibernation_key,
	  hd_comp_mgr_client_init, hd_comp_mgr_client_destroy,
	  hd_comp_mgr_client_is_hibernating, hd_comp_mgr_client_get_actor,
	  hd_comp_mgr_init, hd_comp_mgr_unregister_client,
	  hd_comp_mgr_map_notify, hd_comp_mgr_wakeup_client,
	  hd_comp_mgr_get_low_memory_state, hd_comp_mgr_app_from_xwindow):
	  Connect HdCompMgrClient to its app, if it can be found.
	* src/mb/hd-comp-mgr.h (parent):

2009-01-16  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h
	* src/launcher/hd-launcher.c
	* src/home/hd-render-manager.c:
	  Added timeline_stop code to launcher, and added a gboolean for if
	  timeline is playing - ClutterTimeline uses signals so if we check
	  in the same code we do _play from it returns FALSE
	* src/util/hd-transition.c:
	  Made more sensibile transition time
	* src/mb/hd-comp-mgr.c:
	  Better visibility code
	  Removing flickering on app start

2009-01-16  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	  Fixed blurred home view caused by recent blurring changes
	  Fixed visibility detection code to fix black background issue
	* src/util/hd-transition.c
	* src/util/hd-transition.h:
	  Transitions for notifications - not finished yet
	* src/mb/hd-comp-mgr.c:
	  Screensaver check to fix unmap animation + flicker
	  Further visibility checks for update_area
	  Calls to special transitions for notifications
	  Removed some debug messages

2009-01-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c: Patch from Laszlo to check for NULL in
	BLUR_FOR_WINDOW macro. Fixes: NB#96990

2009-01-15  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_get_previous_view,
	  hd_home_view_container_get_next_view): 
	* src/home/hd-home-view-container.h: Add functions to get previous and
	next views.

	* src/home/hd-home-view.c (hd_home_view_applet_motion,
	hd_home_view_applet_press, hd_home_view_applet_release): It is only a
	move if moved more than 20 px else it is a tap. Fixes NB#96930.

	* src/home/hd-home.c (hd_home_constructed, hd_home_show_switches):
	Show switches only when next/previous view are available.

	* debian/changelog: Update.

2009-01-15  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	  Removed frontmost window check as not used any more - and it just 
	  breaks scratchbox.

2009-01-15  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view-container.c
	  (hd_home_view_container_constructed): Set _NET_NUMBER_OF_DESKTOPS
	  property.
	  (hd_home_view_container_set_current_view): Set _NET_CURRENT_DESKTOP
	  property.

	* src/home/hd-home.c: Update.

2009-01-15  Jan Arne Petersen  <jpetersen@openismus.com>

	* data/desktop/applications.desktop: Change icon name to
	general_applications.

2009-01-15  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c:
	  Disabled pixel shader for blur in scratchbox as it doesn't seem to 
	  work in Xephyr.

2009-01-15  Jan Arne Petersen  <jpetersen@openismus.com>

	Rewrite Home View panning. Fixes: NB#93980, NB#92226, NB#94572,
	NB#94871, NB#96194, NB#96367, NB#96383, NB#96738

	* src/hildon-desktop-views.schemas: Use list instead of ints to store
	  active views in GConf.

	* src/home/Makefile.am: Add hd-home-view-container.[ch]

	* src/home/hd-home-dbus.xml: Remove methods from D-Bus interface
	which are no longer used/available.

	* src/home/hd-home-view-container.c:
	* src/home/hd-home-view-container.h: Add a container for home views.

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h: Use new HdHomeViewContainer.

	* src/home/hd-home.c:
	* src/home/hd-home.h: Move Home View handling to HdHomeViewContainer.
	  Remove unused code.

	* src/home/hd-render-manager.c: Update for Home View changes.

	* debian/changelog: Update.

2009-01-15  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	We used to decide whether to blur the home when a new something
	was mapped.  Try to be smarter and not to blur whenever e.g. a
	dialog is mapped and we're in home view.

	* src/home/hd-render-manager.c: hd_render_manager_set_order()
	* src/home/hd-render-manager.h
	* src/mb/hd-comp-mgr.c: hd_comp_mgr_effect()

2009-01-14  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.c:
	  Don't do any launcher transition when opening an application if 
	  we're doing the app opening transition, as no-one will notice
	  and we make the opening transition quicker.	  
	* src/home/hd-render-manager.c:
	  Added some g_object_unrefs that should have existed, and check to
	  see if a window is definitely opaque before we set things below it
          to be invisible

2009-01-14  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c:
	  Don't leave the app view if the user clicks the place of the tasks
	  button while a dialog is showing.  The buttons were unreactive but
	  the current home view reacted and switched the state.

2009-01-14  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  Don't leave tasw when a new dialog is mapped, except if it's
	  system modal.

2009-01-14  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/Makefile.am: add hd-decor.*
	* src/mb/hd-decor.[ch]: subclass of MBWMDecor which knows about progress
          indicators
	* src/mb/hd-theme.c: make progress indicator per decor rather than
          global

2009-01-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-gtk-utils.c:
	  Added flag to force 16 bit textures when loaded from GTK (was 32 
          bit previously)
        * debian/control:
	  Increase version requirement for clutter

2009-01-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.h
	* src/mb/hd-comp-mgr.c:
	  Stopped Notes blurring the background
	  Stopped update_area when in task launcher (eg. from applets) as it
	  is hard to update the blur texture properly.

	* src/tidy/tidy-blur-group.c:
	  Added Pierre-Luc's modified blur shader that compiles under GL

2009-01-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	  Fixed problem where while buttons weren't visible in FKB, they
	  could still be pressed

2009-01-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	  Fixed status area + button problem over FKB by looking for
	  fullscreen flag on windows above the status area window

2009-01-13  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.16

2009-01-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	* src/home/hd-render-manager.h:
	  Beginnings of status area over FKB fix, and fix for blurred launcher
	  button inside task navigator.

2009-01-13  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.15

2009-01-13  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-switcher.c
	* data/launcher-button-highlight.png:
	  Changed highlight method so we don't use transparancy and can get
	  out full colour depth (bug 97591)
	* src/util/hd-gtk-utils.c:
	  Added fixme for a place where 32 bit textures are still created.
	* src/home/hd-render-manager.c:
	  Made status area and buttons be blurred when background is blurred,
	  by adding the blur_front group, which stayus in home_blur, but is
	  in front of apps.

2009-01-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Further CURRENT_APP_WINDOW cleanups.

	* src/mb/hd-comp-mgr.h:
	  Introduced some common macros.
	* src/home/hd-task-navigator.c:
	  Updated to use them.
	* src/home/hd-render-manager.c:
	  Likewise.  Clear the CURRENT_APP_WINDOW property
	  if entering the tasw or talu.
	* src/mb/hd-comp-mgr.c:
	  current_app() => hd_wm_get_current_app()
	* src/mb/hd-wm.h
	* src/mb/hd-wm.c:
	  Added hd_wm_set_current_app_property() to centralize it.
	  hd_wm_get_current_app() takes the client's geometry into account
	  and no longer considers systemui-windows.

2009-01-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.c:
	  Added null pointer check for something that was giving me problems.
	  Possibly only occurs when used with the wrong libs, but good to have.
	* src/home/hd-render-manager.c:
	  hd_render_manager_return_windows only returns 'normal' windows now
	  status menu is raised above the Operator logo and top-left button

2009-01-12  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.14

2009-01-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c:
	  remove unneeded commented lines
	* src/mb/hd-comp-mgr.c:
	  fixed possible VKB issues

2009-01-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.h
	* src/home/hd-switcher.c:	
	  Now stop blur transitions as soon as app is zoomed right in.
	* src/home/hd-render-manager.c:
	  Method to stop transitions early. 'front' now visible even for
	  fullscreen apps (for notifications in FS mode - eg. 'Max zoom 
	  reached'). Removed code that restacked the current focused app,
	  and now use matchbox order, pulling non-fullscreen dialogs out
	  of the blur box.
	* src/mb/hd-comp-mgr.c:
	  Now return windows before stacking so they can be stacked properly,
	  and don't blur background for fullscreen dialogs (VKB) as hdrm will 
	  leave any fullscreen window in the blurbox.
	* src/home/hd-task-navigator.c: spelling in comment.

2009-01-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#97083

	* src/mb/hd-comp-mgr.c: hd_comp_mgr_restack():
	  Determine and set _MB_CURRENT_APP_WINDOW every time we're
	  restacking windows.  The current_app() logic is meant to be
	  temporary until we understand better what "applications" are.

2009-01-12  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/util/hd-transition.c:
	  Make popup animation vary the anchor point to allow us to
	  continue animation even when the window changes size halfway
	  through.

2009-01-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-render-manager.c:
	  Recognize home applet actors and leave them wherever they are,
	  in the blur group, instead of reparenting them to the arena
	  and let them disappear forever when we go to tasw/talu mode.

2008-01-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  When a new window is mapped don't activate the desktop even if
	  the current state NEED_DESKTOP(), as client activation causes
	  setting the _MB_WM_CURRENT_APP_WINDOW, which causes trouble
	  with FKB.
	* src/mb/hd-desktop.c:
	  Make the desktop's stacking and the MBWindowManagerFlagDesktop
	  dependant on the current state.

	This also prevents the last application to be shown in home view
	state when some application maps a new dialog.

2009-01-07  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#96936

	* src/home/hd-task-navigator.c:
	  Restore the opacity of the thumbnail's title and foreground tile
	  when we're about to enter the switcher without transition.
	  Make sure they are transparent otherwise.

2009-01-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#95641

	* src/mb/hd-note.c:
	  Instead of ignoring ->stack() requests set the layer to Bottom
	  in case of HdNoteTypeIncomingEvent:s.  matchbox is in the belief
	  that the first client of its type wants to stack itself higher.

2009-01-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c
	* src/launcher/hd-launcher.c
	* src/util/hd-transition.c
	* src/util/hd-util.c
	* src/util/hd-transition.h

	Moved application started/closed noise making from the navigator
	to the launcher (hd_launcher_transition_app_start()) and
	hd_transition_close_app().

2008-12-30  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-theme.c: further movement towards progress indicator;
	  displays correctly, but needs to be per-window not singleton.

2008-12-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Restart always-on dbus services if disconnected.

	* src/launcher/hd-launcher.c (tree, dbus_proxy,
	  DBUS_NAMEOWNERCHANGED_SIGNAL_NAME, hd_launcher_init,
	  hd_launcher_lazy_traverse_tree, hd_launcher_launch,
	  hd_launcher_service_prestart, hd_launcher_service_top,
	  hd_launcher_transition_new_frame,
	  hd_launcher_dbus_name_owner_changed):

2008-12-30  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_client_init): Simplify creation of
	the hibernation hash key: use pointer to the composite client, it is
	unique and already known.
	(hd_comp_mgr_client_get_window_role): Removed as unused.
	(hd_comp_mgr_client_get_window_class): Removed as unused.

2008-12-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.13

2008-12-24  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	Now skip area updates if an effect is in progress

2008-12-23  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h
	* src/mb/hd-comp-mgr.c:
	Removed desktop grab for Task Launcher as it wasn't required.
	Added code to use signals to queue redraws in order to avoid
	multiple redraws when several different areas are damaged.

2008-12-23  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-switcher.c:
	Fixed the GLIB CRITICALs and general breakage of task navigator 
	introduced by Kimmo's refactoring.
	* src/home/hd-render-manager.c:
	Added null-pointer check in case get_state is ever called 
	before hd-render-manager is created.

2008-12-22  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Hide the task launcher when clicked on top. Fixes NB#96035

	* src/launcher/hd-launcher.c (hd_launcher_constructed):

2008-12-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* TODO: updated, added new and removed old items.

	* src/launcher/hd-launcher.[ch] (hd_launcher_get_back_button): New.
	Needed to allow creating HdLauncher before the render manager.
	(hd_launcher_constructed): Remove hd_render_manager_set_button call.
	The render manager will use hd_launcher_get_back_button to get it.

	* src/home/hd-render-manager.c: Decided to drop the HdRenderManager
	argument from all functions (some had it, some not) because of the
	singleton.
	(hd_render_manager_get): Removed, we don't need multiple render managers.
	(hd_render_manager_create): New. Added to create and initialise the
	render manager. Here the manager is tied to other singletons, such as
	HdTaskNavigator etc.
	(hd_render_manager_finalize): Add the missing unrefs, which would
	really belong to dispose handler, since dispose handler is meant for
	removing of member objects.
	(hd_render_manager_initialised): Removed. The singleton is now always
	initialised at creation time (as far as possible).
	(hd_render_manager_set_order): Remove unnecessary checking code.
	(hd_render_manager_set_comp_mgr): Removed. Set at creation time.
	(hd_render_manager_add_to_front_group): New. This is used for
	reparenting to the front group. Ideally, _get_front_group should be
	removed (hd-transition.c is the only one using it now) since it exposes
	an internal object and encourages distribution of rendering logic.
	(hd_render_manager_set_task_nav, hd_render_manager_set_home,
	hd_render_manager_set_launcher): Removed. Set at creation time.
	(hd_render_manager_set_status_area,
	hd_render_manager_set_status_menu): New. Status Area and Menu are
	dynamically added and removed.
	(hd_render_manager_set_operator): Allow resetting of the operator
	actor since the operator can change.

	* src/home/hd-switcher.c: Add "task-nav" property to allow setting it
	at creation time.
	(hd_switcher_init): Do not create Task Navigator, it is now given to
	us.
	(hd_switcher_constructed): Remove hd_render_manager_get calls. White
	space fixes.
	(hd_switcher_add_status_area, hd_switcher_remove_status_area): Tell
	the render manager, too.

	* src/home/hd-home.c: Remove unused ClutterGroups main_group and
	control_group.
	(hd_home_constructed): Remove hd_render_manager_set_button calls. The
	render manager will ask for the buttons later.
	(hd_home_remove_status_area): Tell the render manager.
	(hd_home_add_status_menu, hd_home_remove_status_menu): Tell the render
	manager.
	(hd_home_get_edit_button, hd_home_get_back_button,
	hd_home_get_operator): New accessors for the render manager.

	* src/util/hd-transition.c (hd_transition_close_app): Optimisation:
	load the particle texture from file only once.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_init): Create Task Navigator here
	instead of in HdSwitcher. Postpone creation of the render manager so
	that other singletons can be passed to it as creation time arguments.

2008-12-22  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-theme.c: now that we paint the decor here in h-d,
	we can do without MB_SECONDARY.

2008-12-22  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.c (on_timeline_blur_completed,
	  hd_render_manager_set_blur): Remove wrong cast from Cluttertimeline to
	  ClutterActor.

2008-12-22  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	Stopped partial updates happening in Task Navigator, because the
	scaling breaks it.
	* src/home/hd-task-navigator.c:
	Disabled visibility detection on some more clutter actors
	to stop flickering
	* src/home/hd-render-manager.c:
	Removed #define for visibility code as it works fine

2008-12-18  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-page.c:
	Fix for SIGSEGV

2008-12-18  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-render-manager.h:
	Removed un-needed grab/ungrab calls
	* src/mb/hd-comp-mgr.c:
	Added workaround for SystemUI windows changing state to STATE_APP
	and blurring on startup.

2008-12-18  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-render-manager.c (hd_render_manager_set_order): Do not
	  try to hide the status_area actor if it is not there.

2008-12-18  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-layout-dialog.c (deleted):
	* src/home/hd-layout-dialog.h (deleted): There is now a gtk+ based
	  Activate views dialog in hildon-home.

	* src/home/Makefile.am: Remove hd-layout-dialog.[ch]

	* src/home/hd-home-dbus.xml: Remove ShowActivateViews method from
	  interface.

	* src/home/hd-home.c:
	* src/home/hd-render-manager.c:
	* src/home/hd-render-manager.h: Remove layout mode used by the clutter
	  based Activate views dialog.

2008-12-18  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Removed fake w50 menu, now real .desktop files are read.
	Added hard-coded ordering for applications in main category.
	Added support for X-Text-Domain in .desktop files.

	* data/desktop/Makefile.am: Removed .w50-desktop files.
	* src/launcher/hd-launcher-item.c (hd_launcher_item_parse_keyfile,
	  _hd_launcher_app_main_position, hd_launcher_item_new_from_keyfile):
	* src/launcher/hd-launcher-item.h (HD_LAUNCHER_ITEM_TOP_CATEGORY,
	  HD_APPLICATION_LAUNCHER): Hard-cde which apps and in which order they
	  go in the main category.
	* src/launcher/hd-launcher-tree.c (walk_visit_func): Don't load
	.w50-desktop files.
	* src/launcher/hd-launcher.c (hd_launcher_create_page,
	  hd_launcher_lazy_traverse_tree): If .desktop file has X-Text-Domain,
	  use it.

2008-12-18  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-render-manager.c
	* src/home/hd-task-navigator.c:
	* src/home/hd-home-view.c:
	Added calls to new clutter function actor_set_visibility_detect to
	skip visibility detection on things that don't need it/break
	with it
	* src/mb/hd-comp-mgr.c:
	Added code to add update handlers to TFP textures, and to update
	only the area of the screen that needs updating. This requires a
	new clutter.	

2008-12-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Fixes NB#96038
	Pango doesn't do the correct thing when ellipsize is set to NONE and
	wrap to FALSE, so we now clip HdLauncherTile's labels so they don't
	go over their allocation.

	* src/launcher/hd-launcher-tile.c (hd_launcher_tile_set_text,
	  hd_launcher_tile_allocate):

2008-12-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	NB#95917

	* src/mb/hd-comp-mgr.c: hd_comp_mgr_close_app()
	  Be prepared to close windows who lost their leaders.
	* src/mb/hd-app.c: hd_app_close_followers()
	  Added some robustness checks.

2008-12-17  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgr.c:
	Added fix for SIGSEGV apparently caused by libmatchbox changes

2008-12-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Activated preloading for camera UI.

	* data/desktop/camera-ui.w50-desktop:

2008-12-17  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Merged Gordon Williams' render-manager-refactor branch.

	* data/desktop/maemoblocks.w50-desktop:
	* data/desktop/osso_notes.w50-desktop:
	* data/desktop/osso_rss_feed_reader.w50-desktop:
	* data/desktop/osso_sketch.w50-desktop:
	* src/hildon-desktop-views.schemas:
	* src/home/Makefile.am:
	* src/home/hd-home-view.c:
	* src/home/hd-home.c:
	* src/home/hd-home.h:
	* src/home/hd-render-manager.c:
	* src/home/hd-render-manager.h:
	* src/home/hd-switcher.c:
	* src/home/hd-switcher.h:
	* src/home/hd-task-navigator.c:
	* src/home/hd-task-navigator.h:
	* src/launcher/hd-launcher-grid.c:
	* src/launcher/hd-launcher-page.c:
	* src/launcher/hd-launcher-page.h:
	* src/launcher/hd-launcher.c:
	* src/launcher/hd-launcher.h:
	* src/mb/hd-app.c:
	* src/mb/hd-applet-layout-manager.c:
	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	* src/mb/hd-theme.c:
	* src/tidy/tidy-blur-group.c:
	* src/tidy/tidy-blur-group.h:
	* src/util/Makefile.am:
	* src/util/hd-transition.c:
	* src/util/hd-transition.h:

2008-12-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* home/hd-task-navigator.c: Workaround attempt of the pulseaudio crash.

2008-12-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* home/hd-task-navigator.c: Make it able to scroll again.

2008-12-16  Tuomas Kuosmanen  <tuomas.kuosmanen@nokia.com>

	* data/icons/48x48/back-button.png: fixed for demo
	* data/icons/48x48/qgn_tswitcher_close.png: fixed for demo
	* data/icons/48x48/qgn_tswitcher_back.png: fixed for demo

2008-12-16  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.12

2008-12-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Zoom out when jumping to the second level in task launcher.

	* src/home/hd-switcher.c (switcher_mode, hd_switcher_constructed,
	  hd_switcher_launcher_cat_launched, hd_switcher_launcher_cat_hidden,
	  hd_switcher_zoom_in_complete):
	* src/launcher/hd-launcher.c (CAT_LAUNCHED, CAT_HIDDEN,
	  hd_launcher_class_init, hd_launcher_back_button_clicked,
	  hd_launcher_category_tile_clicked): Added new signals for launching
	  subcategory and hiding it.

2008-12-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/launcher/hd-launcher-page.c, src/launcher/hd-launcher.c:
	Task Launcher animation adjustments from 1:2.2.10-1fix tag.
	
	* src/home/hd-home-view.c (hd_home_view_refresh_bg): Remove debug to
	enable speedier scrolling.

2008-12-15  Jan Arne Petersen  <jpetersen@openismus.com>
	
	* src/home/hd-home.c (hd_home_desktop_key_press, hd_home_init): Only
	  open dialpad if a number was pressed. Add code for the addressbook
	  live search.

2008-12-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.11

2008-12-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Make main launcher category completely transparent when showing 2nd
	level.

	* src/launcher/hd-launcher.c (hd_launcher_set_top_blur):

2008-12-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Hiding the launcher button when zooming in on app is no longer
	necessary. Fixes NB#92583

	* src/home/hd-switcher.c (hd_switcher_item_selected):

2008-12-15  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Switched back to using a fake image for the loading screen.

	* data/Makefile.am:
	* src/launcher/hd-launcher.c (hd_launcher_constructed,
	  hd_launcher_transition_app_start, hd_launcher_transition_new_frame):
	* data/blank-window.png: Updated to latest theme.

2008-12-13  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Xmas workaround:
	Hide launcher and switcher if they are shown when a new window is
	mapped. This enables using things like power menu in launcher and
	switcher views.
	* src/home/hd-switcher.h (hd_switcher_hide_launcher): Make public for
	the above code.

2008-12-12  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	Partial checkin of progress indicator implementation.

	* src/mb/hd-atoms.[ch]: Add atom for progress indicator
	* src/home/hd-home.c: Respond to progress indicator change by
	  redrawing screen.
	* src/mb/hd-theme.c: Pick up when to add progress indicator (not
	  yet actually drawn).
	* src/launcher/hd-launcher-app.c: initialise variable to avoid
	  compiler warning.

2008-12-12  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_grab_pointer, hd_home_ungrab_pointer,
	  hd_home_do_normal_layout): Fix pointer grab/ungrab with Home edit
	  menu.

2008-12-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Changed the default loading screen to a rect created from the theme's
	bg color. Also, remove it after the animation is complete.

	* data/Makefile.am: Removed the blank-window.png file.
	* src/launcher/hd-launcher.c (launcher_signals,
	  hd_launcher_constructed, _hd_launcher_transition_clicked,
	  hd_launcher_transition_app_start, hd_launcher_transition_new_frame,
	  hd_launcher_transition_completed):

2008-12-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/launcher/hd-launcher.c:
	  Don't exit launcher view to home view when clicking the backgound
	  where the title area would be.

2008-12-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added X-Maemo-Prestarted=always to imageviewer as requested by the
	dev.

	* data/desktop/image-viewer.w50-desktop:

2008-12-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Doubled the duration of the window fly effect because
	  it became invisibly fast.  Zooming is untouched.

2008-12-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Don't create threads interfering with gdb on sbox/x86
	if $HD_NOTHREADS is defined.

	* src/hildon-desktop.h:
	  hd_disable_threads() defined.
	* src/home/hd-home-view.c:
	* src/launcher/hd-launcher.c
	  Use.
	* src/home/hd-task-navigator.c:
	  Also don't crash if we can't play with canberra.

2008-12-12  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Correct hard-coded menu.

	* data/desktop/hildon-control-panel.w50-desktop:
	* data/desktop/maemoblocks.w50-desktop:
	* data/desktop/mediaplayer.w50-desktop:
	* data/desktop/osso_notes.w50-desktop:
	* data/desktop/osso_rss_feed_reader.w50-desktop:
	* data/desktop/osso_sketch.w50-desktop:
	* data/desktop/rhapsody.w50-desktop:

2008-12-12  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/hildon-desktop.postinst:
	* src/Makefile.am:
	* src/hildon-desktop-views.schemas:
	* src/hildon-desktop-active.schemas (deleted): Rename .schemas file.

2008-12-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Make noise when a window is added to/removed from the switcher,
	effectively, when an application is opened or closed.

	* configure.ac
	* debian/control:
	  Declared dependency on libcanberra.
	* src/home/hd-task-navigator.c

2008-12-11  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/hildon-desktop.postinst: 
	* src/Makefile.am:
	* src/hildon-desktop-active.schemas: Install schema file for active
	  views.

2008-12-11  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/hildon-desktop.schemas: Update bg-image gconf keys.

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h: Update bg-image gconf keys.

	* src/home/hd-home.c (hd_home_init, hd_home_add_applet):
	* src/home/hd-home.h: Update bg-image gconf keys. Update applet view
	  values.

	* src/mb/hd-desktop.c (hd_desktop_theme_change): Update for new theme
	  dir layout.
	  hd_desktop_stack): Only stack visible applet windows.
	* src/mb/hd-status-area.c (hd_status_area_class_type,
	  hd_status_area_request_geometry, hd_status_area_new): Add debug
	  output.

2008-12-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Recognize popup menus and such and add/remove from their
	application's thumbnail in the switcher.

	* src/home/hd-switcher.c
	* src/home/hd-task-navigator.c
	* src/home/hd-switcher.h
	* src/mb/hd-comp-mgr.c

2008-12-11  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.10

2008-12-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-wm.h:
	  Changed the definition of HdWmClientType:s; matchbox expects
	  one bit per client type.  Makes application->switcher transition
	  work again.

2008-12-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Disable the Tasks button when a system-modal dialog is showing.

	* src/home/hd-home.h
	* src/home/hd-home.c:
	  Added hd_home_get_mode().
	* src/home/hd-switcher.h
	* src/home/hd-switcher.c:
	  Added functions to enable/disable the Tasks button.
	* src/util/hd-util.h
	* src/util/hd-util.c:
	  Added hd_util_is_client_system_modal().
	* src/mb/hd-comp-mgr.c:
	  Disable the Tasks button when a system-modal dialog is mapped.
	  Re-enable if the last system-modal is unregistered.

2008-12-10  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-dbus.xml: Add GetCurrentViewID method to D-Bus
	  interface.

	* src/home/hd-home.c (hd_home_get_current_view_id):
	* src/home/hd-home.h (hd_home_get_current_view_id): Change return
	  value to unsigned int.

2008-12-10  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Adjusted dimming values so foreground is more distinct.

	* src/launcher/hd-launcher.c (hd_launcher_set_top_blur):
	* src/mb/hd-comp-mgr.c (on_blur_timeline_new_frame):

2008-12-10  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Set "ellipsization" to none in launcher tiles.

	* src/launcher/hd-launcher-tile.c (hd_launcher_tile_set_text):

2008-12-09  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-app.c: set MB_SECONDARY on secondary windows

2008-12-09  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (bg_image_notify, bg_image_dest_height,
	  hd_home_view_allocate, hd_home_view_dispose,
	  get_bg_image_processed_name, process_bg_image_thread,
	  hd_home_view_refresh_bg, hd_home_view_set_property,
	  hd_home_view_get_property, hd_home_view_set_background_image):
	* src/home/hd-home-view.h (priv): Remove unused color/background mode
	  code .

2008-12-09  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-task-navigator.c:
	  Fixed flicker to background that appeared on zoom in/out,
	  added smooth fade in + out of application border + title.

2008-12-09  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_constructed,
	  bg_image_set_idle_cb): Replace the old background actor if a new
	  image is set.

2008-12-08  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c: hd_comp_mgr_map_notify():
	  g_return_if_fail(the newly mapped window is the latest in the
	  window stack), which can happen when we're starting to manage
	  clients. Mitigates a NULL-pointer dereference.

2008-12-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-app.c (hd_app_init): Patch from Laszlo to check that the
	window in the same window group is indeed a stackable window.
	Fixes: NB#94559

2008-12-08  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.9

2008-12-05  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_set_show_home): Stack the status
	area wm client to the bottom instead of hiding it.

2008-12-05  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_remove_status_area): Unparent status
	  area.
	  (hd_home_add_status_area): Add status area to switcher instead of
	  home.
	* src/home/hd-switcher.c (launcher_back_button_clicked,
	  hd_switcher_clicked, hd_switcher_show_status_area,
	  hd_switcher_hide_status_area, hd_switcher_hide_launcher,
	  hd_switcher_show_menu_button): Use new hd_switcher_show_status_area and
	  hd_switcher_hide_status_area functions.

	* src/home/hd-switcher.h: Add hd_switcher_show_status_area and
	  hd_switcher_hide_status_area.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client,
	  hd_comp_mgr_map_notify): Store the wm client of the staus area.
	  (hd_comp_mgr_set_show_home): Do not show the status area wm client
	  if there is a fullscreen window.

	* src/mb/hd-status-area.c (hd_status_area_init): Use TopMid stacking
	  layer and remove transiency to desktop.
	* src/mb/hd-status-menu.c (hd_status_menu_init): Use TopMid stacking
	  layer and remove transiency to desktop.

2008-12-05  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Hide launcher button when switching to an already open app.
	Fixes NB#92583

	* src/home/hd-switcher.c (hd_switcher_item_selected):

2008-12-05  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-app.c: Show the application's actor when it receives focus.
	  This is a workaround.
	* src/home/hd-switcher.c: Show the tasks button having launched something.

2008-12-05  Gordon Williams <gordon.williams@collabora.co.uk>

	*  src/mb/hd-comp-mgr.c: Removed unmap_notify stuff from the effects
	  function and put it in its own callback. Added popup animation for
	  notifications (not the correct one, but it's a good placeholder)

2008-12-05  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (BACKGROUND_COLOR, background_container,
	  applets_container, hd_home_view_constructed, bg_image_set_idle_cb,
	  hd_home_view_restack_applets, hd_home_view_add_applet): Put the
	  background into a background container, put all applets into an
	  applet container and raise the applets container above the
	  background container. Fixes applets are hidden behind background
	  bug.

2008-12-05  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-switcher.c
	* src/home/hd-task-navigator.c
	Reverted changes for blurred backgrounds on dialogs, as they caused
	problems with the VKB (and any new window that appears after a
	dialog)

	* src/tidy/tidy-blur-group.c
	Added variable initialisation and added a few checks to reduce redraws
	if nothing had changed

2008-12-04  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Prevent unmapping transition for secondary stackable windows. This is a
	temporary fix until the real stackable transitions are added.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_effect_map,
	hd_comp_mgr_effect_unmap):

2008-12-04  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_applet_motion): Hide close
	button if an applet is moved. Fixes NB#93709

2008-12-04  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-switcher.c
	* src/home/hd-home.c
	* src/home/hd-task-navigator.c
	* src/home/hd-task-navigator.h
	* src/mb/hd-comp-mgr.c
	* src/mb/hd-comp-mgr.h:
	Allowed main blur to zoom by different amounts (0 for status + dialogs,
        normal for switcher + launcher. Added popup effect for dialogs and 
	blurring of background.

	* src/tidy/tidy-blur-group.c
	* src/tidy/tidy-blur-group.h: Added function to get zoom amount

2008-12-04  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-app.c: Don't accept focus when the clutter actor is hidden.
	  The switcher has an unfortunate habit of hiding actors, about which
	  matchbox knows nothing and may try to transfer focus to an invisible
	  client when another is closed.

2008-12-04  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Update changelog.

2008-12-04  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_applet_motion): Show edges of
	  desktop.
	  (hd_home_view_applet_release): Hide edges of desktop.
	* src/home/hd-home.c: Do not show edges if changed in layout mode.

2008-12-04  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home.c: 
	* src/mb/hd-comp-mgr.c: Made status menu blur out the background
	(had to move to front of stage first) and added pop-up animation 
	for status menu. Fixes NB#93217

2008-12-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_applet_press): Grab the
	  pointer so it is easier to move an applet. Update modified time of
	  an applet.
	  (hd_home_view_applet_release): Ungrab the pointer.

	  (cmp_applet_modified, hd_home_view_restack_applets): Add function to
	  restack the applets clutter actors according to the modified time.

	  (hd_home_view_add_applet): Restack the applets.

	* src/home/hd-home.c (hd_home_applet_close_button_clicked): Remove all
	  GConf settings for an applet if it closed.
	  (hd_home_add_applet): Use applet id from MBWMClient.

	* src/mb/hd-desktop.c (cmp_applet_modified): Add function to compare
	  modified times.
	  (hd_desktop_stack): Stack the applet windows according to the
	  modified time.

	* src/mb/hd-home-applet.c (hd_home_applet_init): Read modified time
	from GConf.

	* src/mb/hd-home-applet.h (modified): Added modified member.

2008-12-03  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-grid.c:
	Added extra checks to make sure we don't get Clutter CRITICALs when an
	Icon cannot be found

2008-12-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.8

2008-12-03  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Hard-coded UI spec for w50. Fixes NB#94416
	If there's a .w50-desktop file present, it supplants the real .desktop
	file. This is to present a launcher menu according to the UI spec until
	every app has been updated.

	* configure.ac:
	* data/Makefile.am:
	* data/desktop/Makefile.am: Added .w50-desktop files.
	* data/desktop/applications.w50-desktop:
	* data/desktop/bookmark.w50-desktop:
	* data/desktop/browser.w50-desktop:
	* data/desktop/calendar.w50-desktop:
	* data/desktop/camera-ui.w50-desktop:
	* data/desktop/filemanager.w50-desktop:
	* data/desktop/hildon-application-manager.w50-desktop:
	* data/desktop/hildon-control-panel.w50-desktop:
	* data/desktop/image-viewer.w50-desktop:
	* data/desktop/mahjong_startup.w50-desktop:
	* data/desktop/mediaplayer.w50-desktop:
	* data/desktop/modest.w50-desktop:
	* data/desktop/nokia-maps.w50-desktop:
	* data/desktop/osso-addressbook.w50-desktop:
	* data/desktop/osso-backup.w50-desktop:
	* data/desktop/osso_calculator.w50-desktop:
	* data/desktop/osso_lmarbles.w50-desktop:
	* data/desktop/osso_pdfviewer.w50-desktop:
	* data/desktop/rhapsody.w50-desktop:
	* data/desktop/rtcom-call-ui.w50-desktop:
	* data/desktop/rtcom-messaging-ui.w50-desktop:
	* data/desktop/worldclock.w50-desktop:
	* src/launcher/hd-launcher-app.c (HD_DESKTOP_ENTRY_PRESTART_MODE):
	Changed to X-Maemo-Prestarted.
	* src/launcher/hd-launcher-item.c (HD_DESKTOP_ENTRY_CATEGORY,
	  hd_launcher_item_parse_keyfile): Changed to X-Maemo-Category.
	* src/launcher/hd-launcher-item.h (HD_LAUNCHER_ITEM_DEFAULT_CATEGORY,
	  HD_LAUNCHER_ITEM_TOP_CATEGORY): Gave a name to the top category,
	  non-categorized apps go into applications.
	* src/launcher/hd-launcher-tile.c (hd_launcher_tile_set_icon_name):
	Use a default icon if the given one was not found.
	* src/launcher/hd-launcher-tree.c (walk_visit_func):
	If there's a .w50-desktop file present for an app, ignore the .desktop
	one.
	* src/launcher/hd-launcher.c: Place non-categorized apps in default
	category. Use HD_LAUNCHER_ITEM_TOP_CATEGORY for top level.

2008-12-03  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/Makefile.am: Fixed autoconf warning

	* src/mb/hd-comp-mgr.c: Added TV-style app-close effect

	* src/mb/Makefile.am: Added HD_DATADIR #define as for src/home
	
	* data/white-particle.png
	* data/Makefile.am: Added white particle required for app close	effect

2008-12-03  Tuomas Kuosmanen  <tuomas.kuosmanen@nokia.com>

	* data/launcher-button-highlight.png: 
	* data/icons/48x48/qgn_tswitcher_application.png: 
	* data/icons/48x48/back-button.png: some hack styling for demo

2008-12-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c: Remove unused code (for resizing and settings
	  button).

2008-12-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-switcher.c (hd_switcher_zoom_in_complete): Show status
	  are if a window is selected from the switcher. Fixes NB#93999

2008-12-03  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Fixes for Tasks button
	* src/mb/hd-app.c: show Tasks in hide handler.

2008-12-03  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-app.c: hd_app_destroy():
	  Only show the Tasks button again if we were fullscreen
	  and topmost visible.

2008-12-02  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_desktop_key_press): call
	  com.nokia.CallUI.ShowDialpad via D-Bus.
	  (hd_home_init): Get D-Bus proxy for com.nokia.CallUI.

2008-12-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher.c	
	* src/launcher/hd-launcher-page.c:
	Modified task launcher transition to fade the 'back' arrow in and out

2008-12-02  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Increased tile clicking threshold to make it easier to launch
	applications.

	* src/launcher/hd-launcher-tile.c (hd_launcher_tile_button_release):

2008-12-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.c:
	Now load a blank window image if no other window is chosen. Because
	we can't be sure of apps also made a click on the fake window 
	remove it silently.

	* data/blank-window.png
	* data/Makefile.am:
	Added a blank window image to show the transition with if there wasn't
	one defined in the .desktop file with X-App-Loading-Image

2008-12-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-page.h : 
        Added function to return the scroll amount of the page

	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher-app.c
	* src/launcher/hd-launcher-app.h
	* src/launcher/hd-launcher.c:
	Added application launcher transition

	* src/mb/hd-app.c: 
	Added call to remove application start transition when an 
	application window is shown.

2008-12-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c: hd_comp_mgr_map_notify():
	  Replace 3+ subsequent stackable windows correctly in the switcher.

2008-12-02  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-switcher.c (hd_switcher_menu_clicked): Move the call to
	ungrab the pointer to hildon-home. So the desktop does not freeze if
	hildon-home is not running.

2008-12-02  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-switcher.c (hd_switcher_show_menu_button): Hide status
	  area. Set the size of the menu button to the size of switcher and
	  staus area.
	  (hd_switcher_hide_menu_button): Show status area.

2008-12-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c
	Made all lines <80 chars long	

2008-12-02  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_pan_full): Hide edit button on pan.
	  (hd_home_show_edit_button): Add edit button area to input viewport
	  instead of the grab.
	  (hd_home_hide_edit_button): Remove edit button area from input
	  viewport.
	* src/home/hd-home.h: Make hd_home_hide_edit_button public.

	* src/home/hd-switcher.c (hd_switcher_clicked): Hide edit button if
	  switcher is clicked.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_setup_input_viewport,
	  hd_comp_mgr_turn_on): Update hd_comp_mgr_setup_input_viewport
	  function to accept an array of ClutterGeometry.
	  (hd_comp_mgr_map_notify): Hide edit button if a window is mapped.
	* src/mb/hd-comp-mgr.h: Make hd_comp_mgr_setup_input_viewport public.

2008-12-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-switcher.c
	* src/mb/hd-comp-mgr.c
	* src/mb/hd-comp-mgr.h
	Added function to explicitly stop blur and call it from task
	switcher, so when zooming in from an app the end bit doesn't get
	blurred.

2008-12-02  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-launcher.h
	* src/launcher/hd-launcher-page.c
	* src/launcher/hd-launcher-grid.c
	* src/launcher/hd-launcher.c	
	Fixed transitions from sub-menu, added blurring of bottom level
	and zooming out as per UI Transitions

	* src/tidy/tidy-blur-group.c
	* src/tidy/tidy-blur-group.h
	Added options for zoom and mirroring, removed update_children as
	it's always used when off. Stopped blending problems when blurring
	transparent textures
	(but that requires clutter 0.8.2-maemo11)

 	* src/tidy/tidy-animation.c: (removed)
	* src/tidy/tidy-animation.h: (removed)
	* src/tidy/Makefile.am :
	Removed tidy-animation for legal reasons (GPLv3)

	* src/mb/hd-comp-mgr.c
	Lengthened blur a little, added zoom out as per transitions, increased
	blur colour depth because there's no alpha

2008-12-02  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Added a default icon to HdLauncherTile.

	* src/launcher/hd-launcher-tile.c (HD_LAUNCHER_TILE_DEFAULT_ICON,
	  hd_launcher_tile_set_icon_name):

2008-12-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Stop animations when leaving switcher view.

2008-12-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_set_show_home): New function.
	Patch from Laszlo Pere. Hide Task Switcher when there is a fullscreen
	application on top. Fixes: NB#89269

2008-12-02  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Task Launcher refactor. Separated UI and data into different classes.
	Also updates to latest UI spec.
	Fixes: NB#92644, NB#89202, NB#88460
	
	* src/home/hd-switcher.c: Changes to new HdLauncher API.
	* src/launcher/Makefile.am:
	* src/launcher/hd-launcher-app.c: Removed UI.
	* src/launcher/hd-launcher-app.h:
	* src/launcher/hd-launcher-cat.c: Removed UI.
	* src/launcher/hd-launcher-cat.h:
	* src/launcher/hd-launcher-grid.c: New UI actor, keeps the app grid.
	* src/launcher/hd-launcher-grid.h:
	* src/launcher/hd-launcher-item.c:
	* src/launcher/hd-launcher-item.h:
	* src/launcher/hd-launcher-page.c: New UI actor, shows a whole app
	category.
	* src/launcher/hd-launcher-page.h:
	* src/launcher/hd-launcher-tile.c: New UI actor, shows an app icon and
	label.
	* src/launcher/hd-launcher-tile.h:
	* src/launcher/hd-launcher-tree.c:
	* src/launcher/hd-launcher.c: New HdLauncher singleton, 
	* src/launcher/hd-launcher.h:
	* tests/test-launcher.c:

2008-12-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-theme.c: Patch from Laszlo to keep a reference count in
	the close button, avoiding a crash in certain case. Fixes: NB#93472

2008-12-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-switcher.c:
	  Enter the switcher without zooming if the topmost "visible" client
	  /to matchbox' knowledge/ is not visible after all, as it happens
	  after closing the app in application view.

2008-12-02  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-app.c: hd_app_show(), hd_app_destroy():
	  Hide the switcher (Tasks button) when we are showing fullscreen.

2008-12-02  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/home/hd-home.c: Set _NET_CURRENT_DESKTOP and
	_NET_NUMBER_OF_DESKTOPS according to the current view,
	and honour _NET_CURRENT_DESKTOP being set to change the current view.
	Closes #93720.

2008-12-01  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-home-view.c (hd_home_view_constructed): Make all home
	views black by default.

2008-12-01  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c:
	  Moved dimming code to where texture is rendered, so we make better
	  use of our 4bpp. Also means that changes in brightness are much
	  quicker to render.

2008-11-28  Jan Arne Petersen,Berlin  <jpetersen@openismus.com>

	* src/home/hd-home-dbus.xml: Also export the UngrapPointer method.

	* src/home/hd-home.c: grab_pointer is already called when the edit
	  menu is closed.

2008-11-28  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-dialog.c
	* src/util/hd-util.h
	* src/util/hd-util.c:
	  Moved the modal blocker window creation code to a common place.
	* src/mb/hd-note.h
	* src/mb/hd-note.c:
	  Create a modal blocker for information notes like HdDialog does
	  to close them when the user clicks outside the note.

2008-11-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-app-menu.[ch]: A HildonAppMenu is a menu, not a dialog.

2008-11-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-theme.c: Only non-leader app windows have back buttons.

2008-11-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-task-navigator.c:
	  Truncate the thumbnail titles.

2008-11-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

        (some of this checkin was accidentally in the previous commit)

	* src/mb/hd-theme.c: Menus do not have back buttons, per Tuomas.

2008-11-27  Thomas Thurman  <thomas.thurman@collabora.co.uk>

        Created X windows are named, for debugging.

	* src/home/hd-home.c:
	* src/mb/hd-dialog.c:

2008-11-27  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_effect(), hd_comp_mgr_unregister_client():
	  Handle clients which didn't map before leaving.
	  Fixes some CRITICALS caused by systemui.

2008-11-27  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-comp-mgr.c, src/home/hd-home.c,
	src/home/hd-task-navigator.c: Shorten animation durations for the
	managers.

2008-11-26  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-app.c: initialise variable before use, from Laszlo.
	Fixes: NB#92638

2008-11-26  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_dump_debug_info(): print more information about
	  client windows.

2008-11-26  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/home/hd-home.c:
	Added more names to actors for debugging
	* src/mb/hd-comp-mgr.c:
	Fixed bug where tapping on the background would cause the screen
	to suddenly blur and fade back in

2008-11-26  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-finger-scroll.c:
	Changed code for dragging so that position updates immediately
	* src/tidy/tidy-blur-group.c:
	Modified blur group to use new clutter's 'notify-modified' so
	that it now updates if something that is blurred changes.

2008-11-25  Thomas Thurman  <thomas.thurman@collabora.co.uk>

        Move and redraw title when status area changes size or appears or
	disappears.

	* src/home/hd-home.c:

2008-11-25  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.7

2008-11-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.h
	* src/mb/hd-comp-mgr.c:
	  Added a @tag parameter to hd_comp_mgr_dump_debug_info() to identify
	  the debug dump as a whole.
	  Include the wm client stack in the debug dump.
	  Add the client's XWindow number for actors.
	* src/main.c
	* src/home/hd-task-navigator.c:
	  More clutter_actor_set_name()s.

2008-11-25  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  dump_clutter_actor_tree(): if the actor to dump is a ClutterLabel
	  and it doesn't have a name otherwise print the label text as name.
	* src/home/hd-home.c
	* src/home/hd-task-navigator.c:
	  Added more explicit clutter_actor_set_name()s to make debugging
	  easier.

2008-11-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  release_win(): Hide the dialogs as well as the application window
	  when exiting the switcher.

2008-11-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  hd_task_navigator_add_dialog(): Show the new dialog on the top,
	  regardless of what it is transient for.

2008-11-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  When an application window actor is added to the switcher
	  set its clutter name to the class_hint of the client
	  unless it had a name already.

2008-11-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-task-navigator.c (release_win): Add clutter_actor_hide()
	to fix problem with switching to application when tapping on home.

2008-11-24  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/mb/hd-comp-mgc.c:
	Fixed problem with home view settings window not being shown
	because of clutter ordering

2008-11-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-theme.c: Use MB_WM_DECOR_BUTTON_NOHANDLERS for the dummy
	decor button that is created for moving the application title.

2008-11-24  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.h
	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_dump_debug_info() added.  Currently it g_debug()s
	  who has the XGetInputFocus() and the clutter actor hierarchy.
	  Call it whenever you want.
	* src/main.c:
	  Dump debug info on SIGUSR1.
	* src/launcher/hd-launcher-utils.c
	* src/home/hd-switcher.c
	* src/home/hd-task-navigator.c:
	  clutter_actor_set_name() some actors to be easier to recognize
	  in the debug dump.

2008-11-21  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/home/hd-home-view.c (get_bg_image_processed_name): Strip extra
	".png" from background image names.
	(process_bg_image_thread): Check for existing file before saving the
	pixbuf.
	(hd_home_view_refresh_bg): Only change the background if the file name
	or mode is different.

2008-11-21  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/tidy/tidy-blur-group.c:
	* src/tidy/tidy-blur-group.h:
	* src/tidy/Makefile.am:
	  Added a tidy/clutter class that blurs all of its children. Fallback
          of dimming for Xephyr which doesn't appear to handle fragment shaders

	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	  Added tidy-blur-group and made home view a child of it. Added function
	  to allow background blur to be turned on/off when needed

	* src/launcher/hd-launcher-utils.c:
	  Removed dimmed background (now use blur in hd-comp-mgr)

	* src/home/hd-task-navigator.c:
	  Removed dimmed background (now use blur in hd-comp-mgr)

	* src/home/hd-switcher.c:
	  use blur in hd-comp-mgr for task switcher background


2008-11-21  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (hd_home_desktop_key_press): Add boilerplate
	  handler for KeyPress handling.
	  (hd_home_constructed): Listen for KeyPress events on Home.

2008-11-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Changed the location where the task switcher searches for playing
	  video screenshots to "/var/tmp/app-screenshots/<app-name>".

2008-11-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Bring the application to the foreground instead of trying to
	  close it when it has open dialogs and the user taps the close
	  button in switcher view.

2008-11-21  Jan Arne Petersen  <jpetersen@openismus.com>

	* configure.ac: Add check for dbus-binding-tool.

	* src/home/Makefile.am: Add generation of hd-home-glue.h file used by
	  D-Bus.

	* src/home/hd-home-dbus.xml: Export some methods of HdHome required by
	  hildon-home to D-Bus.

	* src/home/hd-home.c (HD_HOME_DBUS_NAME, HD_HOME_DBUS_PATH,
	  hd_home_init): Export some methods to D-Bus.

	* src/home/hd-switcher.c (launcher_group, connection,
	  hildon_home_proxy, hd_switcher_constructed,
	  hd_switcher_menu_clicked): Call hildon-home via D-Bus to show the
	  edit menu.

	* src/home/hd-add-applet-dialog.c (deleted):
	* src/home/hd-task-manager.c (deleted):
	* src/home/hd-background-dialog.c (deleted):
	* src/home/hd-add-applet-dialog.h (deleted):
	* src/home/hd-task-manager.h (deleted):
	* src/home/hd-background-dialog.h (deleted):
	* src/home/hd-add-task-dialog.c (deleted):
	* src/home/hd-edit-menu.c (deleted):
	* src/home/hd-add-task-dialog.h (deleted):
	* src/home/hd-edit-menu.h (deleted):
	* src/home/hd-applet-manager.c (deleted):
	* src/home/hd-applet-manager.h (deleted): Moved to hildon-home.

2008-11-21  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home.c (applet_close_button, edit_button_cb, desktop,
	  hd_home_view_background_clicked, hd_home_view_applet_clicked,
	  hd_home_applet_settings_button_clicked, hd_home_constructed,
	  hd_home_set_mode, hd_home_show_activate_views_dialog,
	  hd_home_show_applet_buttons, hd_home_hide_applet_buttons,
	  hd_home_move_applet_buttons):
	* src/home/hd-home.h: Add function to show the Activate views dialog.
	Do not show resize button for applets. Fixes NB#92125.

	* src/mb/hd-applet-layout-manager.c
	(hd_applet_layout_layer_sort_func): Fix a bug which crashed the sort.

2008-11-21  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  Remove dialogs from the switcher in hd_comp_mgr_effect()
	  rather than hd_comp_mgr_unregister_client() to have access
	  to MBWMClientBase::transient_for.  This fixes critical warnings.
	* src/home/hd-switcher.c:
	  Re-enable handling of dialogs in switcher view.

2008-11-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.h
	* src/mb/hd-comp-mgr.c:
	  hd_comp_mgr_close_app() added to allow for closing all clients
	  of a window stack.
	* src/home/hd-switcher.c:
	  Close all clients of a window stack when an application is closed
	  in switcher view.

2008-11-20  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Allow adding and show all its dialogs an application may have
	in switcher view, including any kind of HildonNote:s.

	* src/mb/hd-comp-mgr.c:
	  Add all kinds of HildonNote:s to the switcher.
	* src/home/hd-task-navigator.c:
	  Handle more than one dialog per application.
	* src/home/hd-switcher.c

2008-11-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  When a client is unregistered don't try to remove its actor
	  from the switcher if the client specified to SkipTaskbar.
	  This is to avoid a harmless critical warning at the cost
	  of not removing actors whose client changed that flag.

2008-11-19  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-app.c, src/mb/hd-theme.c: Patch from Laszlo Pere to fix
	the long press handling for the Back button on stackable window.

2008-11-19  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-switcher.c:
	  Ungrab the pointer when hd_swticher_something_removed() and the
	  switcher has become empty, thus leaving it.  Fixes one case of
	  making applications unresponsive to touchscreen events after
	  leaving the switcher.
	* src/home/hd-task-navigator.c:
	  Don't allow interactions with the thumbnails while animation is
	  in progress.  Fixes the weirdness you could observe by tapping
	  the same or another thumbnail while zooming and a crash when
	  you tried to close the zooming thumbnail.
	* TODO:
	  Removed done todos.

2008-11-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	  Dont't give system-modal dialogs to the switcher.

2008-11-18  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Show open dialogs in the applications' thumbnail in switcher view.
	Switch to the application if it opens a confirmation note.

	* src/mb/hd-comp-mgr.c:
	  Add/remove dialogs and confirmation notes to the switcher
	  on map/unregister.
	* src/home/hd-switcher.c
	* src/home/hd-task-navigator.c
	* src/home/hd-switcher.h
	* src/home/hd-task-navigator.h

2008-11-18  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.6

	* src/mb/hd-comp-mgr.c, src/mb/hd-theme.c: Patch from Laszlo Pere to
	make stackable windows better supported. Fixes: NB#87040

2008-11-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-task-navigator.c:
	  Show the correct (wrt stacking) and up-to-date window title in
	  the thumbnails in switcher view.
	* TODO:
	  Added and removed switcher todos.

2008-11-17  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Show the last frame of a paused video in switcher view.

	* src/home/hd-task-navigator.c:
	  * pixbuf2texture(): Be more robust and check the input pixbuf.
	    Accept pixbufs with alpha channel.
	* src/home/hd-switcher.c:
	  Removed some debug prints.

2008-11-14  Thomas Thurman  <thomas.thurman@collabora.co.uk>

	* src/mb/hd-comp-mgr.c: initialise variable to avoid warning

2008-11-14  Gordon Williams <gordon.williams@collabora.co.uk>

	* src/launcher/hd-dummy-launcher.c
	* src/launcher/hd-launcher-utils.c
	* src/launcher/hd-task-launcher.c
	* src/home/hd-edit-menu.c
	* src/tidy/tidy-scroll-bar.c
	* src/util/hd-gtk-utils.c
	Named some clutter actors to ease debugging
	* src/home/hd-home.c
	Named some clutter actors to ease debugging
	Removed large background texture
	* src/home/hd-home-view.c
	Named some clutter actors to ease debugging
	Removed the solid background rectangle when an image is added
	Background Image added at the same position as previous image

2008-11-14  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 2.2.5

	Removed data/themes

2008-11-13  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-background-dialog.c (hd_background_dialog_init): Set
	window title. Fixes: NB#92490

2008-11-13  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/home/hd-switcher.c:
	Don't add the same window to the switcher more than once,
	as it happens with unfullscreened windows.
	* src/home/hd-task-navigator.c:
	Comment clarification.
	* src/mb/hd-comp-mgr.c:
	hd_comp_mgr_close_client(): don't crash if it's erroneously
	passed NULL.

2008-11-12  Pere Laszlo  <ext-laszlo.pere@nokia.com>

	Make the operator name move out of the way of the status
	area when it resizes.
	closes bug #88444
	patch number 36447
	reviewed by: Thomas Thurman

	* src/home/hd-home.c: add new function
	hd_home_status_area_allocation_changed() to fix up the
	position of the operator name, attached as a callback
	to the size changing signal of the status area
	* src/home/hd-switcher.c: add comment describing function

2008-11-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	Don't add windows marked as SkipTaskbar to the task switcher.

2008-11-12  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	Do a TV-turned-off-like effect when an application is closed
	in switcher view.

	* src/home/hd-switcher.c:
	Keep the switcher open while the effect is running.
	* src/home/hd-task-navigator.h
	* src/home/hd-task-navigator.c:
	Take advantage of clutter_actor_set_anchor_point_from_gravity().
	* src/mb/hd-comp-mgr.c:
	Disable its own TV-turned-off effect in switcher view.
	* TODO:
	Switcher-related todos updated.

2008-11-11  Adam Endrodi  <adam.endrodi@blumsoft.eu>

	* src/mb/hd-comp-mgr.c:
	Fix r31798's patch application which left the application's
	thumbnail in the switcher.

2008-11-10  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/Makefile.am: Add new hd-task-manager.[ch] and
	hd-add-task-dialog.[ch] files.

	* src/home/hd-edit-menu.c (hd_edit_menu_item_release): Add support for
	Add shortcut dialog.

	* src/home/hd-task-manager.c:
	* src/home/hd-task-manager.h: Add class to load the available tasks
	from the .desktop files (used by the Add shortcut dialog).

	* src/home/hd-add-task-dialog.c:
	* src/home/hd-add-task-dialog.h: Add class which implements the Add
	shortcut dialog

	* src/home/hd-applet-manager.c (items_configuration_loaded_cb): Fix
	bug in i18n code.

2008-11-07  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Patch from Tapani Pälli for HildonStackableWindow. This
	implementation will change in the future to support more exotic use
	cases.

	* src/mb/hd-app.c: Tapani's patch.

2008-11-07  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Test for presence of su, which is not available in scratchbox. Copied from
	hildon-home, thanks jpetersen.

	* debian/hildon-desktop.init: If su is not present, launch hildon-desktop
	  directly.

2008-11-06  Adam Endrodi  <adam.endrodi@blumsoft.eu>

 Enhancements in the task switcher view.

 * src/home/Makefile.am
 * src/home/hd-switcher-group.h
 * src/home/hd-switcher-group.c:
   Gone, replaced by src/home/hd-task-navigator.c.
 * src/home/hd-scrollable-group.h
 * src/home/hd-scrollable-group.c:
   Generic scrollable clutter container used by hd-task-navigator.c.
 * src/home/hd-task-navigator.h
 * src/home/hd-task-navigator.c:
   Adds correct thumbnail dimenstions, decorations, effects and arrangements,
   shows incoming event notifications, blurs the background in switcher view
   and is scrollable.
 * src/home/hd-switcher.h
 * src/home/hd-switcher.c:
   Updated for hd-task-navigator.c, now HdSwitcher is more like a control point.
   Handles the closing of notification windows.
 * src/mb/hd-comp-mgr.c:
   Add/remove notifications when the window is mapped/unregistered.
 * src/mb/hd-note.h
 * src/mb/hd-note.c:
   Fixed the handling of infobanners, extended to cover incoming events.
   Also fixed a bug in the class construction code.
 * src/mb/hd-atoms.h
 * src/mb/hd-atoms.c:
   New X window properties for hildon-home/HDIncomingEventWindow:s:
     _HILDON_INCOMING_EVENT_NOTIFICATION_DESTINATION
     _HILDON_INCOMING_EVENT_NOTIFICATION_SUMMARY
     _HILDON_INCOMING_EVENT_NOTIFICATION_ICON
 * TODO:
   Added TODOs for the task switcher and about incoming event notifications.

2008-11-06  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	At least one home view should be active at all times.

	* src/home/hd-home.c (hd_home_activate_view, hd_home_deactivate_view): Moved
	controlling the number of active views to the layout dialog.
	* src/home/hd-layout-dialog.c (hd_layout_thumb_number_key,
	  active_views, hd_layout_dialog_thumb_clicked,
	  hd_layout_dialog_fixup_highlighters, hd_layout_dialog_constructed): Control
	the total number of active views so that at least one is active at all times.

2008-11-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/mb/hd-desktop.c (get_current_theme): Add function to get current
	  theme.
	  (hd_desktop_theme_change): On theme change update gconf background
	  image keys according to the backgrounds/*.desktop file of the new
	  theme.

2008-11-03  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-applet-manager.c (items_configuration_loaded_cb): Add
	  internationalization support.

2008-10-31  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/control:
	* debian/hildon-desktop.postinst: Fix lintian issues.

2008-10-31  Jan Arne Petersen  <jpetersen@openismus.com>

	* debian/changelog: Release 2.2.4.

	* debian/control: Update requirements.

2008-10-30  Jan Arne Petersen  <jpetersen@openismus.com>

	Implement Add Applet dialog. Fixes NB#88341.

	* configure.ac: Require hildon-1 and libhildondesktop-1.

	* debian/control: Require libhildon1-dev and libhildondesktop1-dev.

	* src/home/Makefile.am: Add new files to sources.

	* src/home/hd-add-applet-dialog.c:
	* src/home/hd-add-applet-dialog.h: Implement the "Add Applet" dialog.

	* src/home/hd-applet-manager.c:
	* src/home/hd-applet-manager.h: Implement an applet manager used by
	the "Add Applet" dialog.

	* src/home/hd-edit-menu.c (hd_edit_menu_item_release): Add support
	for the "Add Applet" dialog.

	* src/home/hd-home.c (hd_home_applet_close_button_clicked): Remove
	applets if they are closed.

	* src/launcher/hd-app-launcher.c (hd_app_launcher_load_from_keyfile):
	Do not try to strchomp NULL strings.

	* src/main.c (main): Initialize GnomeVFS.

2008-10-30  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Improved switcher/launcher button managing logic.
	Fixes: NB#88359

	* src/home/hd-switcher.c (hd_switcher_clicked,
	  hd_switcher_setup_buttons): Changed logic so it hides both buttons when
	  the launcher is shown. Now it also shows the launcher button when in
	  switcher mode.

2008-10-20  Marc Ordinas i Llopis  <marc.ordinasillopis@collabora.co.uk>

	Made the launcher prettier and more similar to the specs.
	Fixes: NB#88439

	* src/Makefile.am: Moved all the hd-gtk-* utils to src/util.
	* src/home/Makefile.am:
	* src/launcher/Makefile.am:
	* src/launcher/hd-app-launcher.c (hd_app_launcher_get_label): Use gtk theme
	color and font to create the launcher label.
	* src/launcher/hd-launcher-item.c
	(hd_launcher_item_get_preferred_width,
	hd_launcher_item_get_preferred_height, hd_launcher_item_allocate,
	hd_launcher_item_paint): Made launcher items fixed sized as per the layout
	guide.
	* src/launcher/hd-launcher-utils.c (background,
	hd_get_application_launcher): Added a background to the main launcher group.
	Moved the other actors to correct positions.
	* src/launcher/hd-task-launcher.c (hd_task_launcher_init): Corrected padding
	and spacing.
	* src/util/Makefile.am:
	* tests/Makefile.am:

2008-10-19  Jan Arne Petersen  <jpetersen@openismus.com>

	* src/home/hd-home-view.c (hd_home_view_applet_release): Store new
	applet position and view in GConf.
	* src/home/hd-home.c (hd_home_applet_close_button_clicked): Remove
	stored position and view.
	  (hd_home_add_applet): Add applet with stored position and stored
	  view (if available).

	* src/mb/hd-atoms.c (hd_atoms_init):
	* src/mb/hd-atoms.h: Add _HILDON_APPLET_ID and UTF8_STRING atoms.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_map_notify): Store applet id in
	cutter actor.

	* src/mb/hd-home-applet.c (hd_home_applet_destroy): Free applet_id.
	  (hd_home_applet_init): Set applet_id to _HILDON_APPLET_ID window
	  property.
	* src/mb/hd-home-applet.h: Add applet_id argument.

2008-10-14  Marc Ordinas i Llopis <marc.ordinasillopis@collabora.co.uk>

  * src/home/hd-layout-dialog.c (hd_layout_dialog_constructed) : Scale the
  thumbnail view instead of setting its size when using fbos. Fixes: NB#88355

2008-10-13  Marc Ordinas i Llopis <marc.ordinasillopis@collabora.co.uk>

  * src/home/hd-edit-menu.c (hd_edit_menu_init) : Corrected edit menu strings.
  Fixes: NB#88317
  * src/home/hd-edit-menu.c (hd_edit_menu_constructed) : Changed tabs to spaces.

2008-10-07  Marc Ordinas i Llopis <marc.ordinasillopis@collabora.co.uk>

  * src/launcher/hd-app-launcher.c (hd_app_launcher_activate) : Added a child
  setup funcion called by g_spawn_async that sets up the correct priority and
  OOM unprotection. Fixes: NB#87443

2008-09-24  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 1:2.2.3-1

2008-09-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/mb/hd-dialog.c (hd_dialog_realize): In the case Matchbox created
	the modal blocker, select for ButtonRelease events on the window. This
	enables us to catch ButtonRelease for system-modal dialogs.

2008-09-20  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	Release 1:2.2.2-1

2008-09-15  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* configure.ac: Add gettext-related stuff from the old code.

	* src/main.c (main): Initialise locale and gettext system.

	* src/hildon-desktop.h: New file for global defines.

	* src/launcher/hd-app-launcher.c (hd_app_launcher_get_label): Use
	gettext() to get localised application name.

2008-09-09  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* src/launcher/hd-task-launcher.c
	(hd_task_launcher_get_preferred_height): Use amount of rows to
	calculate the height. Fix a one-off problem when determining start of
	a new row. Fixes: NB#88209

	* src/home/hd-home.c (hd_home_constructed): Remove obsolete code for
	adding a search path for temporary icons.

	* Debug printout adjustments here and there.

2008-09-02  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* debian/hildon-desktop.postinst: Added. Modify Gtk icon theme to
	include 48x48 icons. Update Gtk icon cache. Install the GConf schema.

	* debian/hildon-desktop.init: Added. Start and stop hildon-desktop
	using a launch wrapper.

	* src/hildon-desktop.schemas: Added. GConf schema specifying default
	background images.

	* src/Makefile.am: Add installation of the GConf schema.

	* data/icons/Makefile.am, data/icons/48x48/Makefile.am: Install the
	temporary icons to the same directory as the pre-installed ones.

2008-08-29  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* configure.ac: new output file data/themes/Makefile

	* data/Makefile.am: install also themes directory

	* data/icons/48x48/Makefile.am: use a custom icon directory for the
	temporary icons.

	* data/icons/Makefile.am: install a custom icon theme for the
	temporary icons.

	* src/home/hd-home.[ch] (hd_home_constructed): prepend a temporary icon
	directory.
	(hd_home_remove_status_area): New function to handle removal of Status
	Area. Calls corresponding function in HdSwitcher.
	(hd_home_add_status_menu): New function to handle addition of Status
	Menu. Calls corresponding function in HdSwitcher.
	(hd_home_remove_status_menu): New function to handle removal of Status
	Menu. Calls corresponding function in HdSwitcher.
	(hd_home_add_status_area): New function to handle addition of Status
	Area. Calls corresponding function in HdSwitcher.

	* src/home/hd-switcher.[ch] (launcher_back_button_clicked): Add
	controlling of Status Area's visibility.
	(hd_switcher_clicked): Hide Status Area.
	(hd_switcher_item_selected): Show Status Area if the switcher is going
	to disappear.
	(hd_switcher_add_status_menu, hd_switcher_remove_status_menu,
	hd_switcher_add_status_area, hd_switcher_remove_status_area): New
	functions to handle removal and addition of Status Area/Menu. These
	functions don't have much content yet but are later expected to have.
	(hd_switcher_remove_window_actor): Show Status Area when Switcher is
	hidden.
	(hd_switcher_get_control_area_size): Hard-code button width to keep it
	in the spec value.
	(hd_switcher_group_background_clicked): Show Status Area when the Home
	was clicked.

	* src/launcher/hd-app-launcher.c (hd_app_launcher_get_icon): Correct
	the icon size to the specified 64.
	(hd_app_launcher_get_label): Hard-code width to spec value. Disable
	line wrapping in the label.

	* src/launcher/hd-launcher-item.c (struct _HdLauncherItemPrivate): Add
	bg_tile member for the background tile.
	(hd_launcher_item_get_preferred_width,
	hd_launcher_item_get_preferred_height): Throw away fancy arithmetics
	and return the specified value instead!
	(hd_launcher_item_allocate): Use specified pixel sizes where possible.
	(hd_launcher_item_paint, hd_launcher_item_pick): Add painting of
	bg_tile.
	(hd_launcher_item_show): Add showing of bg_tile.
	(hd_launcher_item_hide): Add hiding of bg_tile.
	(hd_launcher_item_finalize): Add destruction of bg_tile.
	(hd_launcher_item_get_icon): Load bg_tile. This should be done more
	intelligently (e.g. shared) and be themeable.
	
	* src/launcher/hd-task-launcher.c (hd_task_launcher_init): Correct
	spacings to specified values.

	* src/mb/Makefile.am: Add hd-status-menu.[ch].

	* src/mb/hd-status-menu.[ch]: New files for handling the Status Menu
	window.

	* src/mb/hd-comp-mgr.c (hd_comp_mgr_unregister_client): Call
	hd_home_remove_status_area() and hd_home_remove_status_menu() for
	closed Status Area and Status Menu respectively.
	(hd_comp_mgr_map_notify): Call hd_home_add_status_area() and
	hd_home_add_status_menu() for mapped Status Area/Menu.

	* src/mb/hd-status-area.c (hd_status_area_class_init): Use new client
	type HdWmClientTypeStatusArea.
	(hd_status_area_init): Add some WM hints and make Status Area
	transient to Home.

	* src/mb/hd-wm.c (hd_wm_client_new): Call hd_status_menu_new() when
	Status Menu is about to be mapped.

	* src/mb/hd-wm.h: Define new WM client types HdWmClientTypeStatusArea
	and HdWmClientTypeStatusMenu.

2008-08-22  Kimmo Hämäläinen <kimmo.hamalainen@nokia.com>

	* Added debug printouts and some white space fixes to many different
	places to the code.

	* src/home/hd-switcher.c: Use icon qgn_general_add for the Tasks
	button in Launcher mode.
	(hd_switcher_hide_buttons): Added for hiding Tasks button when
	Launcher is visible.
	(hd_switcher_home_background_clicked): Added for handling the Home
	background clicked signal.
	(launcher_back_button_clicked): Added for handling the back button in
	the launcher. Closes the launcher and makes the Tasks button visible
	again.
	(hd_switcher_constructed): Connect
	hd_switcher_hide_launcher_after_launch to handle actions after an
	application was selected from the launcher. (This should be done with
	some more Glibbish way.) Connect launcher_back_button_clicked to the
	new back button on the launcher. Connect
	hd_switcher_home_background_clicked to handle background-clicked
	signal from the home.
	(hd_switcher_clicked): Fixed pointer grab logic: keep the pointer
	grab whenever the task switcher or task launcher is shown.
	(hd_switcher_hide_launcher_after_launch): New.
	(hd_switcher_item_selected): Ungrab and hide the switcher when an item
	was selected from the switcher. Lower the home so that the selected
	application's window is always visible (sometimes it was not). If the
	actor argument is NULL and the switcher group is empty, ungrab the
	pointer. This is used to handle the case when the last application
	in the switcher closes. (There should be some more elegant way to do
	this.)
	(hd_switcher_setup_buttons): Show the Tasks button in switcher mode
	after the launcher was closed and there are no items in the switcher.
	(hd_switcher_group_background_clicked): Ungrab the pointer if either
	the switcher or launcher was visible, and in that case, hide the
	switcher or launcher.

	* src/launcher/hd-app-launcher.c: Change text_color so that it is
	visible on the screen.
	(hd_app_launcher_get_icon): Implement icon loading using the default
	Gtk+ icon theme.
	(hd_app_launcher_activate_service): New function to implement D-Bus
	activation of applications (mostly copy & paste from the old code).
	(hd_app_launcher_activate): Call hd_app_launcher_activate_service to
	D-Bus activate.
	(hd_launcher_tree_constructor): Use hard-coded paths for now to find
	the desktop and configuration files. (Something evil forces /usr/local
	as prefix.)

	* src/launcher/hd-launcher-utils.[ch]: Add ClutterActor back_button to
	the launcher's private struct.
	(populate_top_launcher): Return FALSE if there are no launcher items.
	(create_back_button): New function to create the back button.
	(hd_launcher_group_set_back_button_cb): New function to set up a
	handler for the back button's button-release-event.
	(hd_get_application_launcher): Add two arguments for the function to
	pass a function to call when an item was selected from the launcher.
	Make the launcher full-screen size, as in the UI spec. Add the back
	button to the top-right corner, as in the UI spec.

	* src/launcher/hd-task-launcher.c: Add the switcher callback as a
	global variable (should be moved to inside an object).
	(launch_animation_complete): Call the switcher callback to cause
	closing of the launcher.
	(hd_task_launcher_init): Define larger top padding to compensate for
	the full-screen size.
	(hd_task_launcher_new): Store the switcher callback into a global
	variable for later use.

	* src/main.c: Disable fatal warnings. They are not useful in this
	development phase.

	* src/mb/Makefile.am: Add new files hd-status-area.[ch].

	* src/mb/hd-atoms.[ch]: Add new atoms for Status Area and Status Menu.

	* src/mb/hd-wm.c: Add support for new window types, corresponding to
	Status Area and Status Menu.

	* src/mb/hd-status-area.[ch]: New files for Status Area window type
	implementation.

2008-08-12  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/Makefile.am: Add defines.

	* src/launcher/hd-app-launcher.[ch]: Parse the Exec key (and remove
	trailing spaces from the service and exec keys); add an activate()
	method to HdAppLauncher that will execute the application.

	* src/launcher/hd-launcher-tree.c: Clean up.

	* src/launcher/hd-task-launcher.c (launch_item): Launch the
	application that has been tapped.

2008-08-08  Chris Lord  <chris@openedhand.com>

	* tests/Makefile.am:
	* tests/test-signals.c:
	Add a background-kill/low-memory signal test application

2008-08-08  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-launcher-utils.c:
	(lazily_populate_top_launcher),
	(lazily_populate_sub_launcher): Use a higher priority for
	populating the launchers.

	(hd_get_application_launcher): Increase the width of the launchers
	and scroll areas to 780px.

	* src/launcher/hd-task-launcher.c:
	(hd_task_launcher_init): Tweak the spacing between items and
	the padding around the launcher.

2008-08-08  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-app-launcher.[ch]: Add prestart key support
	to the AppLauncher class; read and parse the Categories key
	from the desktop entry and allow checking for a category.

2008-08-08  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-app-launcher.c: Wrap the item label and
	center the text.

	* src/launcher/hd-launcher-item.c: The preferred width is
	the width of the icon + padding.

	* src/launcher/hd-task-launcher.c: Increase the spacing and
	the left/right padding.

2008-08-08  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-app-launcher.c:
	* src/launcher/hd-launcher-item.c:
	* src/launcher/hd-launcher-tree.c:
	* src/launcher/hd-launcher-utils.c:
	* src/launcher/hd-task-launcher.c: Populate the top-level
	task launcher with the contents of the LauncherTree.

2008-08-08 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-notification.c:
	* src/home/hd-notification.h:
	Added setters for icon and text.

2008-08-08 Tomas Frydrych  <tf@o-hand.com>

	* src/tidy-frame.h:
	* src/tidy-frame.c:
	Add missing files.

2008-08-08 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-notification.c:
	Removed text color properties; use tidy-stylable API instead.

2008-08-08 Tomas Frydrych  <tf@o-hand.com>

	* configure.ac:
	* src/Makefile.am:
	* src/home/Makefile.am:
	* src/launcher/Makefile.am
	* src/tidy/Makefile.am
	* tests/Makefile.am:
	Moved tidy from src/launcher to src/

	* src/home/hd-notication.h:
	* src/home/hd-notification.c:
	Start of customized notification actor.

2008-08-08  Emmanuele Bassi  <ebassi@openedhand.com>

	* configure.ac: Check for ftw.h and its GNU extensions.

	* src/launcher/Makefile.am:
	* src/launcher/hd-launcher-tree.c:
	* src/launcher/hd-launcher-tree.h: Add a LauncherTree object, which
	will populate itself with the contents of the desktop entries
	following (a subset of) the XDG menu spec.

	* src/launcher/hd-app-launcher.c: Implement the rest of the
	LauncherItem base class methods.

	* src/launcher/hd-launcher-utils.c:
	* src/launcher/hd-launcher-utils.h: Start the launchers tree
	population when needed.

	* tests/test-launcher.c: Enable threading.

2008-08-07 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-edit-menu.c:
	Gettextized.

2008-08-07  Chris Lord  <chris@openedhand.com>

	* src/home/hd-home-view.c (hd_home_view_allocate),
	(hd_home_view_class_init), (get_bg_image_processed_name),
	(bg_image_set_idle_cb), (process_bg_image_thread),
	(hd_home_view_refresh_bg):
	Refresh the background image when the HomeView changes size

2008-08-07 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-background-dialog.c:
	Gettextized.

2008-08-07 Tomas Frydrych  <tf@o-hand.com>

	src/mb/hd-wm.c:
	Removed stale comment.

	src/home/hd-layout-dialog.c:
	(hd_layout_dialog_constructed):
	Gettextized labels.

2008-08-07 Tomas Frydrych  <tf@o-hand.com>

	* configure.ac:
	Added -Wno-format-extra-args (necessary for us to work with the
	hildon logical strings).

	src/mb/hd-wm.c:
	(hd_wm_client_hang):
	Gettextized hand dialog; changed to conform to spec.

2008-08-07 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-dialog.c:
	Implement dialog sizing and positioning logic.

2008-08-05 Robert Bragg  <bob@o-hand.com>

	* tests/test-portrait.c
	* tests/Makefile.am:
	Adds a simple portrait mode unit tests. It basically just lets you
	toggle a property (currently called "_HILDON_SUPPORTS_PORTRAIT_MODE")
	on a gtk window, and create transient dialogs with/without the same
	property set.

2008-08-04  Chris Lord  <chris@openedhand.com>

	* configure.ac:
	Add gconf-2.0 to dependencies

	* src/home/hd-background-dialog.[ch]:
	* src/home/Makefile.am:
	Add hd-background-dialog.[ch]

	* src/home/hd-edit-menu.c (hd_edit_menu_item_release):
	Create and show the background dialog when choosing the
	change-background menu option

	* src/home/hd-home-view.c (hd_home_view_class_init),
	(hd_home_view_get_gconf_path), (hd_home_view_gconf_bgcolor_notify),
	(hd_home_view_gconf_bgimage_notify),
	(hd_home_view_gconf_bgstyle_notify), (hd_home_view_constructed),
	(hd_home_view_init), (hd_home_view_dispose),
	(get_bg_image_processed_name), (bg_image_set_idle_cb),
	(process_bg_image_thread), (hd_home_view_refresh_bg),
	(hd_home_view_set_property), (hd_home_view_get_property),
	(hd_home_view_set_background_color):
	* src/home/hd-home-view.h:
	Use gconf to store background paths, display styles and colours.
	Add threaded background-image processing (resizing, cropping, etc.)

	* src/home/hd-home.c (hd_home_constructed), (hd_home_init):
	Add a gconf directory listener for the hildon-home path, remove
	setting of the background colour for workspaces (this is done by the
	workspace itself now).

	* src/home/hd-home.h:
	Define the hildon gconf root

	* src/main.c (main):
	Initialise GLib threads

2008-08-04 Robert Bragg  <bob@o-hand.com>

	* tests/Makefile.am
	* src/launcher/test-launcher.c
	* src/launcher/Makefile.am:
	Moves test-launcher up into the tests/ dir

2008-08-04 Robert Bragg  <bob@o-hand.com>

	* src/home/hd-switcher.c
	* src/home/hd-home.c
	* src/home/hd-home.h
	* src/util/hd-util.c
	* src/util/hd-util.h:
	Some re-working of the pointer grabbing. We now have just one set of
	hd_home_grub/ungrab_pointer functions (removes the util versions for
	now) It adds more debugging to identify unbalanced ungrab calls.

	Adds a grab when the launcher is run.

2008-08-04 Robert Bragg  <bob@o-hand.com>

	* home/hd-switcher.c:
	Don't use clutter_actor_{show,hide}_all to show/hide the launcher
	use clutter_actor_{show,hide}. (There is an unresloved issue where
	by using the *_all calls breaks input event handling in the
	launcher.)

2008-08-01 Robert Bragg  <bob@o-hand.com>

	* src/home/hd-switcher.c:
	Removes some fidling with the stacking of the switcher group that
	seems to fix stacking bug whereby dialogs can end up hiden below the
	home views.

2008-08-01 Robert Bragg  <bob@o-hand.com>

	* data/icons/48x48/Makefile.am
	* data/icons/48x48/qgn_home_resizer.png
	* data/icons/48x48/qgn_home_edit_mode.png
	* data/icons/48x48/qgn_home_settings.png
	* data/icons/48x48/qgn_home_close.png
	* data/icons/48x48/qgn_general_add.png:
	Adds more icons using the logical names we know of

	* data/menu-button.png:
	Resizes to 56px height to match the height of the title area as
	defined in the master layout document.

2008-08-01 Robert Bragg  <bob@o-hand.com>

	* tests/test-applet.c
	* tests/Makefile.am
	* src/hd-applet-test.c
	* Makefile.am:
	Moves hd-applet-test.c into tests/tests-applet.c and hooks into the
	build scripts.

2008-08-01 Robert Bragg  <bob@o-hand.com>

	* data/icons/48x48/bg-image-switcher.png
	* data/icons/48x48/bg-image-launcher.png:
	Removes a couple of unsed icons

2008-07-31 Robert Bragg  <bob@o-hand.com>

	* src/mb/hd-wm.c:
	Hooks up a handler for unresponsive clients that shows a gtk message
	dialog allowing the user to either wait longer or force the client
	to quit.

	* configure.ac
	* tests/Makefile.am
	* tests/test-hung-process.c:
	Adds a simple unit test to verify the dialog for handling unresponsive
	clients.

2008-07-30 Robert Bragg  <bob@o-hand.com>

	* src/mb/hd-comp-mgr.c:
	removes hd_comp_mgr_client_shutdown_timeout_cb and no longer sets up
	a timeout before calls to mb_wm_client_deliver_delete.

	I think there is no reliable metric for determining if a client has
	responded to a WM_DELETE (since the client can show the user a
	confirmation dialog and cancel any response) Instead we leave it up to
	the NET_WM_PING protocol for detecting unresponsive clients.

	Specifically: Testing if the client process was still running after
	a timeout and killing (-9) if so was particularly bad in the case that
	the client process was actually the WM process :-)

2008-07-30 Robert Bragg  <bob@o-hand.com>

	* src/main.c:
	Initialises gtk+, clutter and mbwm2 so that they behave nicely
	together. Of a few approaches tried, this has worked best. Noteably
	it gives gtk+ a seperate X connection from clutter and mbwm2 so
	that dialogs etc, appear to the window manager as a separate client.

	more rationale is in the comments, but basically trying to do client
	like things in-process with the WM turnes out to be a a Bad Idea (tm)
	not least because it breaks the SubStructureRedirect mechanism.

	NB: You must build your libmatchbox2 without passing --with-gtk !

2008-07-30 Robert Bragg  <bob@o-hand.com>

	* src/mb/hd-wm.c:
	Make sure we never interpret the window type for override redirect
	windows. (E.g. we were handling an 1px x 1px offscreen window - used
	by the gtk color selector for grabbing input - as an application
	window and creating a full screen frame and title bar etc)

	* src/home/hd-home.c:
	Don't mark the input only desktop window as override redirect; it
	is enough that it is marked as NET_WM_WINDOW_TYPE_DESKTOP.

2008-07-30  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-launcher-utils.c:
	(hd_get_application_launcher): Add padding.

	* src/launcher/test-launcher.c: Remove the positioning code,
	since the padding is done by the launcher group already.

2008-07-30  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-launcher-utils.c: Put the sub-level task
	launcher into its own FingerScroll, and animate the FingerScroll
	actor instead of directly the TaskLaunchers, when switching
	between top-level and sub-level.

	* src/launcher/hd-task-launcher.c: Take a reference on the
	members of the launcher closure, so that they won't disappear
	before the effect is complete; this fixes launching items
	from the sub-level task launcher.

2008-07-30  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-dummy-launcher.c: Use a random color for
	the dummy launcher icon; shorten the "bounce" effect duration.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-task-launcher.c (launch_item): Hardcode
	the size and position of the launcher pre-load icon.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-dummy-launcher.c: Add an animation when
	showing the launchers, as per UI spec.

2008-07-29 Robert Bragg  <bob@o-hand.com>

	* src/applet-settings-button.png
	* src/applet-resize-button.png
	* src/bg-image-switcher.png
	* src/edit-button.png
	* src/bg-image-launcher.png
	* src/back-button.png
	* src/menu-button.png
	* src/close-button.png
	* src/hibernation-icon.png:
	Removes the pngs that should have gone with my previous
	theme changes. (The equivalent images now live under
	data/ and data/icons/)

	* data/themes/FremantleDev/mbwm2/theme.xml:
	typo, change template-pad-width -> template-pad-length
	adds show-title="yes"
	Note: Currently the theme engine doesn't understand about
	the icons at the top left of the screen and tries to
	print the title aligned to the left of the screen.

	* data/themes/FremantleDev/mbwm2/template.png:
	adds a close button to the template. Note though there
	was a bug with calculating the button position in the
	png theme engine. You will need to pull the latest
	mbwm2 for the close button to work)

	* data/launcher-button-highlight.png:
	* src/home/hd-switcher.c:
	Improved compositing of the swither/launcher icons. They
	are now composed of a solid colour background, a 48x48
	icon and a light higlight texture.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/home/hd-switcher.c:
	(hd_switcher_constructed): If you don't add actors to a group
	it'll be slightly difficult for Clutter to draw them.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/Makefile.am:
	* src/home/Makefile.am:
	* src/home/hd-switcher.c: First, raw pass at integrating the
	launcher into the desktop. WARNING: might break everything.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/Makefile.am:
	* src/launcher/hd-launcher-utils.[ch]:
	* src/launcher/test-launcher.c: Prepare integration of the task
	launcher into the desktop by moving the whole build sequence of
	the launchers, animations and callbacks into a single function.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-task-launcher.c:
	(launch_item),
	(hd_task_launcher_real_item_clicked): Update the animation of
	the application launcher; now it will use the right actor as
	the starting point of the "growing" animation.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/Makefile.am:

	* src/launcher/hd-launcher-item.c: Remove unused effect template.

	* src/launcher/test-launcher.c: Move the application launcher
	animation from here...

	* src/launcher/hd-task-launcher.c: ... to here, where it belongs.

	* src/launcher/tidy/Makefile.am:
	* src/launcher/tidy/tidy-animation.[ch]:
	* src/launcher/tidy/tidy-interval.[ch]: Add tweening API for
	Tidy.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-task-launcher-private.h:
	* src/launcher/hd-task-launcher.c: Small clean ups.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/tidy/tidy-scroll-view.c:
	(tidy_stylable_iface_init): Make the scroll bars slighly less
	big.

2008-07-29  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-task-launcher.c: Update the adjustment range
	each time a launcher has been added to the HdTaskLauncher.

	* src/launcher/tidy/tidy-scroll-bar.c: Resync from tidy trunk
	to fix a segmentation fault.

2008-07-28  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/Makefile.am:
	* src/launcher/main.c:
	* src/launcher/test-launcher.c: Rename the test-launcher source
	file.

2008-07-28 Robert Bragg  <bob@o-hand.com>

	* src/launcher/tidy/Makefile.am:
	support out of tree builds

2008-07-28  Emmanuele Bassi  <ebassi@openedhand.com>

	* src/launcher/hd-task-launcher.c:
	(hd_task_launcher_get_preferred_height),
	(hd_task_launcher_class_init): Compute the preferred height for the
	task launcher.

2008-07-28  Emmanuele Bassi  <ebassi@openedhand.com>

	Integrate the launcher in SVN. This is an initial implementation
	that's useful to check the effects and the integration: the actual
	loading and saving of the launcher contents is being reworked to
	allow the user to change the layout.

	* configure.ac:
	* src/Makefile.am:
	* src/launcher/Makefile.am: Add the launcher section.

	* src/launcher/hd-launcher-item.c:
	* src/launcher/hd-launcher-item.h: Base class for the launcher items;
	actors implementing this class must provide an icon and a label for
	the TaskLauncher to lay out inside its grid.

	* src/launcher/hd-app-launcher.c:
	* src/launcher/hd-app-launcher.h: Abstraction of the KeyFile provided
	by an application.

	* src/launcher/hd-dummy-launcher.c:
	* src/launcher/hd-dummy-launcher.h: "Dummy" launcher item.

	* src/launcher/hd-task-launcher-private.h: Private declarations.

	* src/launcher/hd-task-launcher.c:
	* src/launcher/hd-task-launcher.h: Main container actor.

	* src/launcher/main.c: Test environment, to avoid breaking the desktop
	until we have the Launcher ready.

	* src/launcher/tidy: Internal copy of actors and objects from Tidy.
	We need them for the finger pannable launcher.

2008-07-24 Robert Bragg  <bob@o-hand.com>

	* configure.ac:

	make sure we link against clutter-0.8 not clutter-0.7

2008-07-21 Robert Bragg  <bob@o-hand.com>

	* src/main.c
	* src/home/hd-gtk-style.c:
	Adds code for using GtkStyle info from a number of singleton gtk
	widgets.

	* src/home/hd-gtk-utils.c
	* src/home/hd-gtk-utils.h:
	Created some utility code for loading icons into a ClutterTexture and
	having a fallback (currently just a blank ClutterRectangle) when the
	icon can't be loaded.

	* src/home/hd-layout-dialog.c
	* src/home/hd-switcher-group.c
	* src/home/hd-home.c
	* src/home/hd-switcher.c
	* src/home/hd-gtk-style.h
	* src/home/Makefile.am
	* src/mb/hd-comp-mgr.c:
	Updated various harded coded colors, fonts or clutter texture icon
	initialisations to use the above code so the values can come from
	gtk style themes and gtk icon themes.

	* configure.ac
	* Makefile.am
	* data
	* data/themes
	* data/themes/FremantleDev
	* data/themes/FremantleDev/gtk-2.0
	* data/themes/FremantleDev/gtk-2.0/gtkrc
	* data/themes/FremantleDev/mbwm2
	* data/themes/FremantleDev/mbwm2/theme.xml
	* data/themes/FremantleDev/mbwm2/template.png:
	Adds a simple initial "hildon" mbwm2 theme and simple gtk theme
	for testing with.

	NB:
	- To pick up the development gtk theme you currently need to export
	GTK2_RC_FILES=/path/to/src/data/themes/FremantleDev/gtk-2.0/gtkrc
	- To pick up the development mbwm2 theme you need to pass
	-theme /path/to/src/data/themes/FremantleDev/mbwm2/theme.xml
	on the hildon-desktop command line.

	* data/Makefile.am
	* data/icons
	* data/icons/48x48
	* data/icons/48x48/applet-settings-button.png
	* data/icons/48x48/applet-resize-button.png
	* data/icons/48x48/qgn_tswitcher_right.png
	* data/icons/48x48/bg-image-switcher.png
	* data/icons/48x48/qgn_tswitcher_back.png
	* data/icons/48x48/qgn_home_close.png
	* data/icons/48x48/qgn_tswitcher_application.png
	* data/icons/48x48/qgn_tswitcher_close.png
	* data/icons/48x48/Makefile.am
	* data/icons/48x48/bg-image-launcher.png
	* data/icons/48x48/hibernation-icon.png
	* data/icons/48x48/back-button.png
	* data/icons/48x48/qgn_tswitcher_left.png
	* data/icons/Makefile.am:
	Re-organises the .png icons to be installed under $prefix/share/icons
	to be picked up by the gtk_icon theme/cache code.

	Renames some of the .png files to their logical names.

	NB:
	You currently need to export
	XDG_DATA_DIRS="/path/to/prefix/share:/usr/local/share/:/usr/share/")
	for the icons to be found.

	* data/menu-button.png
	* data/edit-button.png:
	Installs other misc images under $prefix/share/hildon-desktop for now.
	It's no longer neccisary to run hildon-desktop in the same dir as
	the .png files

2008-07-17 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/Makefile.am:
	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	* src/mb/hd-desktop.c:
	* src/mb/hd-home-applet.c:
	* src/mb/hd-home-applet.h:
	* src/mb/hd-applet-layout-manager.c:
	* src/mb/hd-applet-layout-manager.h:
	Implemented automatic applet layout per specification.

2008-07-16 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home-view.c:
	* src/home/hd-home.c:
	* src/home/hd-switcher-group.c:
	* src/home/hd-switcher-group.h:
	* src/home/hd-switcher.c:

	Implemented panning in the switcher.

2008-07-15 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home.c:
	Disabled applet sittings button (it has been removed from the
	spec, but there is some uncertanity whether it will not come back,
	hence the #ifdefs).

2008-07-15 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home.c:
	(hd_home_add_applet):
	(hd_home_remove_applet):
	Support for sticky applets.

2008-07-04 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-layout-dialog.c:
	(hd_layout_dialog_constructed):
	Fixed bad cast.

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h:
	Support for background modes.

2008-07-04 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home-view.c:
	Split background into solid color and image.

2008-07-04 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h:
	* src/home/hd-home.c:
	* src/home/hd-home.h:
	* src/home/hd-layout-dialog.c:
	Layout managing mode: added thumbnails to dialog, connected event
	handlers.

2008-07-04 Tomas Frydrych  <tf@o-hand.com>

	* src/home/Makefile.am:
	* src/home/hd-home.c:
	* src/home/hd-layout-dialog.h:
	* src/home/hd-layout-dialog.c:
	Initial refactoring of layout managing mode to matched the updated
	spec.

2008-07-03 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home-view.c:
	* src/home/hd-home-view.h:
	* src/home/hd-home.c:
	* src/home/hd-home.h:
	Implemented moving of applets across view boundary.

2008-07-03 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home-view.c:
	* src/home/hd-home.c:
	* src/home/hd-home.h:
	Controls for switching home view while dragging an applet.

2008-07-03 Tomas Frydrych  <tf@o-hand.com>

	* configure.ac:
	Put back -Werror following fix in clutter headers.

	* src/home/hd-home.c:
	(hd_home_fixup_operator_position):
	Removed spurious line of code.

2008-07-03 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home.c:
	* src/home/hd-home.h:
	* src/home/hd-switcher.c:
	* src/home/hd-switcher.h:
	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	Added operator label and basic API for setting text and icon.

2008-07-02 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-switcher-group.c:
	( hd_switcher_group_zoom_out):
	Ensure that the actor we are zooming is topmost.

2008-07-02 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-switcher-group.c:
	Refactored zoom-out effect to match the current spec.

2008-07-01 Tomas Frydrych  <tf@o-hand.com>

	* configure.ac:
	Temporarily remove --Werror until an issue in clutter headers is
	fixed upstream.

	* src/mb/hd-comp-mgr.c:
	Shortened timeout for unmap effect.

2008-06-30 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-switcher-group.c:
	(hd_switcher_group_remove_actor):
	Reparent the actor if appropriate.

	* src/mb/hd-comp-mgr.c:
	Added a counter for running unmap effects to control stacking order
	while unmap effects are running.

2008-06-18 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home.c:
	Added background to HdHome actor.

2008-06-18 Tomas Frydrych  <tf@o-hand.com>

	* src/hd-applet-test.c:
	Added --view-id parameter.

2008-06-18 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home.c:
	* src/home/hd-home.h:
	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	* src/mb/hd-desktop.c:
	Implemented specialized HdDesktop::stack() method to handle applet
	visibility.

2008-06-16 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-theme.c:
	(construct_buttons):
	Removed some testing code.

2008-06-16 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-switcher-group.c:
	(hd_switcher_group_hide_all):
	Added explicit call to clutter_actor_show() when reparenting
	client actors back to original parent.

2008-06-16 Tomas Frydrych  <tf@o-hand.com>

	* src/home/home.c:
	(hd_home_remove_view):
	(hd_home_do_layout_contents):
	Ensure correct position of Home in layout mode when last view in
	the list is removed.

2008-06-13 Tomas Frydrych  <tf@o-hand.com>

	* src/home/hd-home.c:
	Fixed layout view when a view is removed.

2008-06-13 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/Makefile.am:
	* src/mb/hd-dialog.c:
	* src/mb/hd-dialog.h:
	* src/mb/hd-wm.c:
	Custom MBWMClientDialog subclass to handle hildon peculiarities.

2008-06-12 Tomas Frydrych  <tf@o-hand.com>

	* src/home/Makefile.am:
	* src/home/hd-home.c:
	* src/home/hd-home.h:
	* src/home/hd-switcher.c:
	* src/home/hd-edit-menu.h:
	* src/home/hd-edit-menu.c:
	* src/mb/hd-comp-mgr.c:
	* src/mb/hd-comp-mgr.h:
	Home edit menu.

2008-06-12 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-app.c:
	(hd_app_close_followers):
	Hooked into  mb_wm_client_deliver_delete() mechanism.

2008-06-12 Tomas Frydrych  <tf@o-hand.com>

	* src/main.c:
	* src/mb/Makefile.am:
	* src/mb/hd-atoms.c:
	* src/mb/hd-atoms.h:
	* src/mb/hd-wm.c:
	* src/mb/hd-wm.h:
	Custom HdAppMenu subclass of MBWMClientDialog to handle Hildon
	application menu windows.

2008-06-12 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/Makefile.am:
	* src/mb/hd-atoms.c:
	* src/mb/hd-atoms.h:
	* src/mb/hd-wm.c:
	* src/mb/hd-note.h:
	* src/mb/hd-note.c:
	Custom HdNote subclass of MBWMClientNote to handle Hildon
	notifications (banners, infos and confirmations).

2008-06-12 Tomas Frydrych  <tf@o-hand.com>

	* src/hd-applet-test.c:
	Added couple of sliders to the sample applet.

2008-06-12 Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-app.c:
	* src/mb/hd-app.h:
	* src/mb/hd-theme.c:
	More of Hildon stackable window back button code.

2008-06-11  Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-theme.c:
	Skeleton for handling presses on Hildon stackable window back
	button.

2008-06-11  Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-app.c:
	* src/mb/hd-app.h:
	* src/mb/hd-theme.c:
	Fixed handling of hildon stackable windows so that legacy
	applications continue to work as they used to.

	* src/mb/hd-atoms.c:
	* src/mb/hd-atoms.h:
	Added _HILDON_STACKABLE_WINDOW atom.

2008-06-11  Tomas Frydrych  <tf@o-hand.com>

	* src/mb/Makefile.am
	* src/mb/hd-app.h:
	* src/mb/hd-app.c:
	* src/mb/hd-theme.c
	* src/mb/hd-wm.c
	Custom MBWMClientApp subclass to allow handling of hildon views.

2008-06-11  Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-comp-mgr.h:
	Replace binary flags in HdCompMgrClientPrivate with boolean fields
	to improve clarity.

2008-06-11  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	Connect/disconnect captured-event handler selectively for
	thumbnail mode only.

2008-06-11  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	Handle thumbnail mode via capture-event signal instead of using a
	mouse trap actor.

2008-06-10  Tomas Frydrych  <tf@o-hand.com>

	* src/mb/hd-theme.c:
	* src/mb/hd-theme.h:
	Added HdThemeSimple, subclass of MBWMTheme, to simplify testing
	in the absence of real, png-based theme.

2008-06-10  Tomas Frydrych  <tf@o-hand.com>

	* src/main.c:
	* src/mb/Makefile.am:
	* src/mb/hd-theme.h:
	* src/mb/hd-theme.c:
	Start start of a customized MBWMTheme subclass.

2008-06-10  Tomas Frydrych  <tf@o-hand.com>

	Restructured source tree to improve clarity:

	* src/mb:   Matchbox subclasses,
	* src/home: Home (clutter subclasses),
	* src/util: Auxiliary stuff.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-switcher-group.c:
	(hd_switcher_group_zoom):
	Fixed group position before zoom effect.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	Correctly terminate applet resizing when release lands outside of
	the resize button.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-atoms.c:
	* src/hd-atoms.h:
	* src/hd-home.c:
	Hooked up settings button.

	* src/hd-applet-test.c:
	Added ClientMessage handler.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	Applet resizing.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	* src/hd-home.c:
	* src/hd-home.h:
	Applet dragging.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	(hd_comp_mgr_class_init):
	Fixed typo.

	* src/hd-home.c:
	Hooked up applet close button.

2008-06-09  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	* src/hd-home.c:
	* src/hd-home.h:
	Added edit mode applet decors and signal handlers.

2008-06-05  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	* src/hd-home-view.h:
	* src/hd-home.c:
	Start of Home edit mode.

2008-06-05  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-atoms.c:
	* src/hd-atoms.h:
	* src/hd-home.c:
	Added simple ClientMessage-based mechanism for applet-initiated
	home panning.

	* src/hd-applet-test.c:
	Simple Home applet.

2008-06-05  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	(hd_comp_mgr_top_home):
	(hd_comp_mgr_home_clicked):
	Implemented topping of home.

	* src/hd-home-applet.c:
	(hd_home_applet_init):
	Make transient for HdDesktop client.

	* src/hd-home.c
	(hd_home_constructed):
	Revert default mode to NORMAL.

	* src/hd-switcher.c:
	* src/hd-switcher.h:
	(hd_switcher_deactivate):
	API to deactivate switcher and restore normal stack order.

2008-06-04  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c
	* src/hd-home-view.h
	* src/hd-home.c
	* src/hd-home.h
	Refactored panning code to avoid need to do pointer grab.

	* src/hd-util.c:
	* src/hd-util.h:
	Remove unnecessary functions.

	* src/Makefile.am
	* src/hd-comp-mgr.c
	* src/hd-wm.c:
	* src/hd-desktop.h:
	* src/hd-desktop.c:
	* src/hd-home-applet.c
	Custom MBWindowManagerClient subclass for our input-only desktop
	window.

2008-06-03  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	* src/hd-home.h:
	* src/hd-home-view.c:
	* src/hd-home-view.h:
	Handle applet removal.

2008-06-03  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	* src/hd-home.h:
	* src/hd-home-view.c:
	Forwarding of events to applets.

	* src/hd-util.c:
	* src/hd-util.h:
	(hd_util_ungrab_pointer):
	Added return value.

2008-06-03  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	* src/hd-home-view.c:
	* src/hd-home-view.h:
	* src/hd-home.c:
	* src/hd-home.h:
	Attach applets to a home view.

2008-06-03  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	(hd_comp_mgr_restack):
	If only home applets are present, put home into active input mode.

2008-06-03  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-atoms.c:
	* src/hd-atoms.h:
	New atoms for home applet type.

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	(hd_comp_mgr_get_atom):
	Public accessor for the custom atom cache.

	* src/hd-home-view.c:
	* src/hd-home.c:
	Added HdHomeView::id construction property to persistently
	identify given view.

	* src/hd-wm.h:
	HdWmClientType enum for client types.

	* src/hd-wm.c
	Subclassed MBWindowManager::client_new().

	* src/Makefile.am:
	* src/hd-home-applet.h:
	* src/hd-home-applet.c:
	Start of custom client type for home applets.

2008-06-03  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	(hd_home_pan_full):
	Deal with view rollover.

2008-06-02  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	Added construction time "home" property.
	Refactored motion handling.

	* src/hd-home.c:
	* src/hd-home.h:
	Translate view motion events to panning.

	* src/hd-util.c:
	(hd_util_grab_pointer):
	Added motion event mask.

2008-06-02  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	(hd_comp_mgr_restack):
	Put Home into active input mode when no application windows are
	present.

	src/hd-home-view.c:
	src/hd-home-view.h:
	src/hd-home.c:
	src/hd-home.h:
	Added active input mode for the Home actor when Home is
	on the top (all button events are getting trapped within Home
	views and only forwarded to children when appropriate).

	Added HdHome::background-clicked signal.

2008-06-02  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c

	* src/hd-home-view.c:
	* src/hd-home-view.h:
	Added ClutterButtonEvent parameter to thumbnail-clicked and
	background-clicked signals.

	* src/hd-home.c:
	* src/hd-switcher.c:
	* src/hd-util.c:
	* src/hd-util.h:
	(hd_util_grab_pointer):
	(hd_util_ungrab_pointer):
	Extracted pointer grabbing from home/mgr.

	(hd_util_fake_button_event):
	Function to dispatch fake button events.

2008-05-30  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	* src/hd-home-view.h:
	Added background-clicked signal.

	* src/hd-home.c:
	* src/hd-home.h:
	Smooth home panning.

2008-05-30  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	(hd_home_show_view):
	Fixed handling of mode and home position.

2008-05-30  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home-view.c:
	* src/hd-home-view.h:
	* src/hd-home.c:
	Added thumbnail mode and thumbnail-clicked for home layout view.

2008-05-30  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	Added new view button; fixed return values in button click
	handlers.

	* src/hd-switcher-group.c:
	* src/hd-switcher.c:
	Fixed return values in button click handlers.

2008-05-30  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	(hd_home_do_layout_layout):
	Added zoom out effect when switching to layout mode.

2008-05-29  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	Start of edit mode.

2008-05-29  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	(hd_home_constructed):
	Removed misplaced hd_home_set_mode() call left over from testing.

2008-05-29  Tomas Frydrych  <tf@o-hand.com>

	* src/back-button.png:
	Placeholder of back button icon.

	* src/hd-home.c:
	Added close and back butttons.

2008-05-29  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-home.c:
	* src/hd-home.h:
	Infrastructure for normal/edit/layout mode; fundamentals of normal
	and layout layouts.

2008-05-29  Tomas Frydrych  <tf@o-hand.com>

	* src/Makefile.am:
	* src/hd-home.c:
	* src/hd-home.h:
	* src/hd-home-view.c:
	* src/hd-home-view.h:
	Added HdHomeView object to represent a single home view.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	(hd_comp_mgr_launch_application):
	Added available memory check; UI needed.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-switcher-group.c:
	(hd_switcher_group_show_all):
	(hd_switcher_group_hide_all):
	Setup vieport to mask out client decorations as requied by the UI
	spec.

	* src/hd-switcher.c:
	(hd_switcher_item_selected):
	* src/hd-comp-mgr.c:
	(hd_comp_mgr_unregister_client):
	Fixed incorrect GObject data key.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hibernation-icon.png:
	stub for an hibernation icon.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	* src/hd-switcher.c:
	Waking up of hibernated applications via switcher.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-dbus.c:
	* src/hd-dbus.h:
	(hd_dbus_launch_service):
	Helper method for the below.

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	(hd_comp_mgr_launch_application):
	Method to launch applications over dbus.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-switcher-group.c:
	(hd_switcher_group_show_all):
	Added TODO comment.

2008-05-28  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-atoms.c:
	* src/hd-atoms.h:
	* src/hd-comp-mgr.c:
	* src/hd-switcher-group.c:
	* src/hd-switcher-group.h:
	* src/hd-switcher.c:
	* src/hd-switcher.h:
	Handle weaking up of hibernated applications.

2008-05-27  Tomas Frydrych  <tf@o-hand.com>

	* src/Makefile.am:
	Added -D_XOPEN_SOURCE (need to access kill()).

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	* src/hd-dbus.c:
	(hd_comp_mgr_close_client):
	(hd_comp_mgr_hibernate_client):
	Made more robust by adding a timed check followed by a kill() for
	applications that refuse to die.

	(hd_comp_mgr_hibernate_client):
	(hd_comp_mgr_hibernate_all):
	Differentiate between applications that know how to hibernate and
	those that do not; added force parameter to override.

2008-05-27  Tomas Frydrych  <tf@o-hand.com>

	* configure.ac:
	Added dbus to required packages.

	* src/Makefile.am:
	Added hd-atom.[ch] hd-dbus.[ch] and hd-util.[ch] to build.

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	Added dbus hook for hibernation signal,
	Subclassed MBWMCompMgrClutterClient and moved our flags into
	HdCompMgrClientPrivate.

2008-05-23  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	* src/hd-switcher-group.c:
	Start of implementation of hibernation infrastructure.

2008-05-23  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	* src/hd-comp-mgr.h:
	* src/hd-switcher.c:
	Moved HdHome object from HdSwitcher into the CM; handle events on
	the Home actor.

2008-05-23  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-switcher-group.c:
	(hd_switcher_group_show_all):
	(hd_switcher_group_hide_all):
	Removed temporary workaround not necessary now that HdHome is
	present.

2008-05-23  Tomas Frydrych  <tf@o-hand.com>

	* src/Makefile.am:
	* src/hd-home.h:
	* src/hd-home.c:
	Initial stubs for the Home object.

	* src/hd-switcher.c:
	(hd_switcher_constructed):
	(hd_switcher_clicked):
	(hd_switcher_hide_switcher):
	Integrated HdHome object into the WM.

2008-05-22  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-mgr.c:
	(hd_comp_mgr_effect):
	Implemented TV-out style effect for application windows.

2008-05-22  Tomas Frydrych  <tf@o-hand.com>

	Cleaned up comments and code.

2008-05-22  Tomas Frydrych  <tf@o-hand.com>

	Removed stale files.

2008-05-22  Tomas Frydrych  <tf@o-hand.com>

	Simplified compositor by subclassing MBWM2's Clutter compositor.

2008-05-14  Tomas Frydrych  <tf@o-hand.com>

	* src/hd-comp-window.c:
	* src/hd-switcher.c:
	Sync up with upstream changes in clutter API.

